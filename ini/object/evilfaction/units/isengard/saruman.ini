;------------------------------------------------------------------------------
; Saruman
Object IsengardSaruman
	; *** ART Parameters ***

    ; ButtonImage for Heros is button image on Hero Select UI to select hero. HI = HeroIcon or HeroImage.
	; This is required for garrisoned objects - please put in all objects.
	ButtonImage = HISaruman

    ; SelectPortrait for Heros is portrait behind skill buttons. HP = HeroPortrait.
	SelectPortrait = HESarumanNew
	Scale		= 1.1

	DescriptionStrategic = CONTROLBAR:LW_ToolTip_Saruman

	Draw = W3DScriptedModelDraw ModuleTag_DRAW

		OkToChangeModelColor = Yes

		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD

		ExtraPublicBone = STAFFFX

		DefaultModelConditionState
			Model               = iuNsaruman_skn
			Skeleton			= IUSaruman_SKL
			WeaponLaunchBone    = PRIMARY STAFFFX
		End

		ModelConditionState		= USER_3
			Model               = iuNsaruman_skn
			WeaponLaunchBone    = PRIMARY STAFFFX
            Shadow				= SHADOW_ADDITIVE_DECAL
            ShadowSizeX			= 200;
            ShadowSizeY			= 200;
            ShadowTexture		= EXGandalfGlow;
		End

		ModelConditionState		= ONE_RING
			Model               = iuNsarumanR_skn
			WeaponLaunchBone    = PRIMARY STAFFFX
			ParticleSysBone = None SarumanSMCGlow FollowBone:Yes
		End

		; --- Idle Anims
		IdleAnimationState
			StateName = Idle
			Animation = IDLB ; Bored Idle
				AnimationName       = IUSaruman_IDLB
				AnimationMode       = ONCE
				AnimationPriority   = 20
			End

			Animation = IDLC ; Bored Idle
				AnimationName       = IUSaruman_IDLC
				AnimationMode       = ONCE
				AnimationPriority   = 3
			End

			Animation = IDLD ; Bored Fidget
				AnimationName       = IUSaruman_IDLD
				AnimationMode       = ONCE
				AnimationPriority   = 1
			End

			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Selected" then CurDrawableSetTransitionAnimState("TRANS_Selected_To_Idle") end
			EndScript
		End

		AnimationState        = STUNNED_FLAILING
			Flags               = RANDOMSTART
			Animation           = FLYA
				AnimationName     = IUSaruman_FLYA
				AnimationMode     = LOOP
			End
		End

		; --- Dying anims
		AnimationState			= DYING BURNINGDEATH
			Animation
				AnimationName	= IUSaruman_DIEB
				AnimationMode	= ONCE
				AnimationBlendTime = 10
			End
		End

		AnimationState        = DYING SPLATTED
			Animation
				AnimationName     = IUSaruman_LNDA
				AnimationMode     = ONCE
			End
		End
		AnimationState        = DYING AFLAME
			Animation = DieAflame
				AnimationName     = IUSaruman_MFDA
				AnimationMode     = LOOP
			End
		End
		AnimationState        = DYING
			Animation = DieB
				AnimationName     = IUSaruman_DIEB
				AnimationMode     = ONCE
			End
		End

		; --- Stunned anims

		AnimationState        = STUNNED_STANDING_UP
			Animation
				AnimationName     = IUSaruman_GTPA
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 1.5 1.5
			End
		End
		AnimationState        = STUNNED
			Animation
				AnimationName     = IUSaruman_LNDA
				AnimationMode     = ONCE
			End
		End

		AnimationState			= BURNINGDEATH
			Animation
				AnimationName	= IUSaruman_MFDA
				AnimationMode	= LOOP
				Distance		= 50
			End
		End

		AnimationState						= PARALYZED
			Animation
				AnimationName				= IUSaruman_IDLB
				AnimationMode				= LOOP
			End
		End

		;;; DOMINATE SPECIAL POWER ;;;
		AnimationState				= PACKING_TYPE_1
			StateName				= Dominate
			Animation
				AnimationName		= IUSaruman_TNTB
				AnimationMode		= ONCE
				AnimationBlendTime  = 5
			End
			FXEvent	= Frame:6	Name: FX_SarumanDominateAtSelf
		End

		;;; SPEECH CRAFT SPECIAL POWER ;;;
		AnimationState				= PACKING_TYPE_2
			StateName				= Spped_Craft
			Animation
				AnimationName		= IUSaruman_TNTB
				AnimationMode		= ONCE
			End
			FXEvent	= Frame:15	Name: FX_SpeechCraft
		End

		;;; DOMINATE SPECIAL POWER ;;;
		AnimationState				= PACKING_TYPE_3
			StateName				= RulingRing
			Animation
				AnimationName		= IUSaruman_TNTB
				AnimationMode		= ONCE
				AnimationBlendTime  = 5
			End
			FXEvent	= Frame:6	Name: FX_RulingRingStart
		End
		;;; SPEECH CRAFT SPECIAL POWER WITH RING ;;;
		AnimationState				= PACKING_TYPE_4
			StateName				= Spped_Craft
			Animation
				AnimationName		= IUSaruman_TNTB
				AnimationMode		= ONCE
			End
			FXEvent	= Frame:15	Name: FX_SarumanRingSpeechCraft
		End

		; --- Moving Anims


 		AnimationState = MOVING FIRING_OR_PREATTACK_A
			Animation = TrotAndFire
				AnimationName = IUSaruman_ATRA
				AnimationMode = LOOP
			End
			Flags = RANDOMSTART
			;ParticleSysBone = None InfantryDustTrails
	    End

		; This is what happens when Saruman gives uses his speech craft
 		AnimationState				= MOVING USING_SPECIAL_ABILITY
 			Flags					= RANDOMSTART
 			Animation				= IUSaruman_RUNB
 				AnimationName     = IUSaruman_RUNB
 				AnimationMode     = LOOP
 			End
 		End



 		AnimationState			= MOVING BACKING_UP
			Animation			= BackingUp
				AnimationName	= IUSaruman_BAKA
				AnimationMode	= LOOP
			End
			Flags = RANDOMSTART
		End

		AnimationState        = MOVING ATTACKING
 			Animation			  = IUSaruman_RUNB ;RUNB
 				AnimationName     = IUSaruman_RUNB
 				AnimationMode     = LOOP
 			End
		End

		AnimationState        = MOVING
 			Animation				= IUSaruman_RUNA
 				AnimationName     = IUSaruman_RUNA
 				AnimationMode     = LOOP
 			End
		End

		;;; FIRE BALL SPECIAL POWER ;;;
		AnimationState		  = SPECIAL_WEAPON_ONE
			Animation				= Throwing Fireball
				AnimationName		= IUSaruman_ATKB
				AnimationMode		= ONCE
			End
			FrameForPristineBonePositions = 27
		End

 		;;; WIZARD BLAST SPECIAL POWER ;;;
 		AnimationState        =  SPECIAL_WEAPON_TWO
			StateName = Attacking
			Animation
				AnimationName       = IUSaruman_ATKB
				AnimationMode       = ONCE
			End
			FrameForPristineBonePositions = 27
		End

		;;; LIGHTING BOLT SPECIAL POWER ;;;
		AnimationState		  = SPECIAL_WEAPON_THREE
			Animation				= Throwing Fireball
				AnimationName		= IUSaruman_SPCA
				AnimationMode		= ONCE
				UseWeaponTiming		=	Yes
			End

			FrameForPristineBonePositions = 48
		End

		; --- Attacking Anims [Weapon_A]

		;AnimationState		  = ONE_RING FIRING_OR_PREATTACK_A
		;	Animation				= Throwing Fireball
		;		AnimationName		= IUSaruman_SPCA
		;		AnimationMode		= ONCE
		;		UseWeaponTiming		=	Yes
		;	End
		;End

		AnimationState        = FIRING_OR_PREATTACK_A
			Animation           = IUSaruman_ATKC
				AnimationName     = IUSaruman_ATKC
				AnimationMode     = ONCE
				UseWeaponTiming		=	Yes
			End

			Animation           = IUSaruman_ATKD
				AnimationName     = IUSaruman_ATKD
				AnimationMode     = ONCE
				UseWeaponTiming		=	Yes
			End
		End

		AnimationState = WAR_CHANT
			;Animation = Chant
			;	AnimationName = IUSaruman_TNTA
			;	AnimationMode = ONCE
			;End
			Animation = Chant
				AnimationName = IUSaruman_TNTB
				AnimationMode = LOOP
			End
		End

		AnimationState = EMOTION_TAUNTING
			Animation = Chant
				AnimationName = IUSaruman_TNTA
				AnimationMode = ONCE
			End
			Flags						= RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
		End

		AnimationState = EMOTION_CELEBRATING
			Animation = Chant
				AnimationName = IUSaruman_TNTB
				AnimationMode = ONCE
			End
			Flags						= RANDOMSTART RESTART_ANIM_WHEN_COMPLETE
		End

		; --------- Click and Hit Reactions ------------
		AnimationState = HIT_REACTION
			Animation = Hit_Level_1_a
				AnimationName = IUSaruman_HITA
				AnimationMode = ONCE
			End
		End

		; ATTACKING
		AnimationState        = ATTACKING
			Animation           = ALERT_1
				AnimationName     = IUSaruman_IDLA
				AnimationMode     = LOOP
			End
		End

		TransitionState					=	TRANS_Idle_to_Selected
			Animation					=	ATNA
				AnimationName			=	IUSaruman_ATNA
				AnimationMode			=	ONCE
			End
		End

		TransitionState					=	TRANS_Selected_To_Idle
			Animation					=	ATND
				AnimationName			=	IUSaruman_ATND
				AnimationMode			=	ONCE
			End
		End

		; LEVEL Up Anim
		AnimationState        = LEVELED
			Animation = Yippee
				AnimationName       = IUSaruman_TNTA
				AnimationMode       = ONCE
			End
		End

 		; READY IDLE
		AnimationState        = EMOTION_ALERT
			Animation           = ALERT_1
				AnimationName     = IUSaruman_IDLA
				AnimationMode     = LOOP
			End
		End

		AnimationState = RAISING_FLAG
			Animation = Chant
				AnimationName = IUSaruman_TNTA
				AnimationMode = ONCE
			End
			Animation = Chant
				AnimationName = IUSaruman_TNTB
				AnimationMode = ONCE
			End
			Flags						= RESTART_ANIM_WHEN_COMPLETE
		End

		AnimationState				=	SELECTED
			StateName				=	Selected
			SimilarRestart			=   Yes
			Animation				=	ATNB
				AnimationName		=	IUSaruman_ATNB
				AnimationMode		=	LOOP
				AnimationBlendTime  =   15
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Idle" then CurDrawableSetTransitionAnimState("TRANS_Idle_to_Selected") end
			EndScript
		End
	End

    #include "..\..\..\includes\StunDrawModuleSmall.inc"

	; ***DESIGN parameters ***
	Side = Isengard
	EditorSorting = UNIT
	ThreatLevel = SARUMAN_THREAT_LEVEL
	ThingClass = CHARACTER_UNIT
    	BuildCost           = 4000 ;SARUMAN_BUILDCOST
   	BuildTime           = HERO_BUILDTIME_TIER_5 ;,; HERO_BUILDTIME_TIER_5 ;HERO_BUILDTIME_TIER_4 ;;,;; SARUMAN_BUILDTIME
	ShockwaveResistance = SHOCKWAVE_RESISTANCE_STRONG
	;//DisplayMeleeDamage = SARUMAN_DAMAGE

	TransportSlotCount = TRANSPORTSLOTCOUNT_HERO
	WeaponSet
		Conditions = None
		Weapon = PRIMARY    SarumanWeapon
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End
	WeaponSet
		Conditions = PLAYER_UPGRADE
		Weapon = PRIMARY    SarumanOfManyColorsLightning
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	WeaponSet
		Conditions = PLAYER_UPGRADE CLOSE_RANGE
		Weapon = PRIMARY SarumanOfManyColorsLightning
		Weapon = SECONDARY SarumanOfManyColorsWeapon
		OnlyAgainst = PRIMARY STRUCTURE
    End

	WeaponSet
		Conditions = CLOSE_RANGE
		Weapon = PRIMARY SarumanWeapon
		Weapon = SECONDARY SarumanWeapon
		OnlyAgainst = PRIMARY STRUCTURE
    End
	;------------------------------------------------
	;------------------------------------------------
	ArmorSet
		Conditions      = None
		Armor           = HeroArmor
		DamageFX        = NormalDamageFX
	End

	VisionRange = VISION_STANDARD_MELEE
    	ShroudClearingRange = SHROUD_CLEAR_HERO

    	MaxVisionBonusPercent = 300%
	VisionBonusTestRadius = 200
	VisionBonusPercentPerFoot = 1.0%

  	BountyValue     = 400
	DisplayName		= OBJECT:IsengardSaruman
	RecruitText		= CONTROLBAR:IsengardSarumanRecruit
	ReviveText		= CONTROLBAR:IsengardSarumanRevive
	Hotkey			= CONTROLBAR:IsengardSarumanHotkey
	CrushableLevel	= 2  ;What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
	CrusherLevel = 0 ;What can I crush?: 0 = small animals, 1 = infantry, 2 = trees, 3 = vehicles

	CommandSet = SarumanCommandSet
	CommandPoints = 0 ;HERO_COMMAND_POINTS_TIER_4 ;,; HERO_COMMAND_POINTS_TIER_5 ;HERO_COMMAND_POINTS_TIER_4 ;;,;; 75

	; *** AUTO RESOLVE DATA ***
	AutoResolveUnitType = AutoResolveUnit_Hero
	AutoResolveCombatChain = AutoResolve_HeroCombatChain

	AutoResolveBody = Aotr_AutoResolve_LeaderLargeHeroBody

	AutoResolveArmor
		Armor = Aotr_AutoResolve_HeroLeaderArmor
	End

	AutoResolveWeapon
		Weapon = AutoResolve_LeaderHeroStrongWeapon
	End

	AutoResolveLeadership = AutoResolve_GandalfBonus


	; *** AUDIO Parameters ***;

	VoiceAttack					= SarumanVoiceAttack
	VoiceAttackCharge			= SarumanVoiceAttackCharge
	;VoiceCreated				= CampOrcCreateSaruman		;this conflicts with his respawn dialogue line -- rehooked to spawn FX
	;VoiceFullyCreated 			= CampOrcCreateSaruman		;this conflicts with his respawn dialogue line -- rehooked to spawn FX
	VoiceFear 					= SarumanVoiceHelpMe
	VoiceGuard					= SarumanVoiceMove
	VoiceMove					= SarumanVoiceMove
	VoiceMoveWhileAttacking		= SarumanVoiceDisengage
	VoicePriority				= 92
	VoiceSelect					= SarumanVoiceSelectMS
	VoiceSelectBattle 			= SarumanVoiceSelectBattle

	SoundImpact					= ImpactHorse

	UnitSpecificSounds
		VoiceEnterUnitEvilMenTransportShip	= SarumanVoiceMove
		VoiceEnterUnitMordorMumakil			= SarumanVoiceMove
		VoiceEnterUnitSlaughterHouse		= SarumanVoiceMove
		VoiceGarrison						= SarumanVoiceMove
		VoiceInitiateCaptureBuilding		= SarumanVoiceMove
	End

	CrowdResponseKey = EvilMen1

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"
	EvaEventDieOwner			= SarumanDie		;Eva event to trigger on unit's death. NOTICE THAT this is only for permanent deaths
										;For deaths you can respawn from, use the DeathFX

	Behavior = LargeGroupAudioUpdate ModuleTag_LGAU		;Tie into LargeGroupAudio system
		Key = Humanoid_Male Man Man_Male Hero
	End

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
		AnimationSound = Sound:FootstepDirtA		Animation:IUSaruman_SKL.IUSaruman_ATKB	Frames:39 104
		AnimationSound = Sound:FootstepDirtA		Animation:IUSaruman_SKL.IUSaruman_ATKC 	Frames:43 92
		AnimationSound = Sound:FootstepDirtA		Animation:IUSaruman_SKL.IUSaruman_ATKD 	Frames:13 29 55
		AnimationSound = Sound:FootstepDirtA		Animation:IUSaruman_SKL.IUSaruman_ATRA	Frames:9 20 31 43 55 67
		AnimationSound = Sound:FootstepDirtA		Animation:IUSaruman_SKL.IUSaruman_DIEB	Frames:20
		AnimationSound = Sound:BodyFallGenericNoArmor	Animation:IUSaruman_SKL.IUSaruman_DIEB	Frames:34
		AnimationSound = Sound:FootstepDirtA		Animation:IUSaruman_SKL.IUSaruman_GTPA	Frames:51 75 113 139
		AnimationSound = Sound:FootstepDirtA		Animation:IUSaruman_SKL.IUSaruman_HITA	Frames:12
		AnimationSound = Sound:FootstepDirtA		Animation:IUSaruman_SKL.IUSaruman_IDLC	Frames:116 188
		AnimationSound = Sound:FootstepDirtA		Animation:IUSaruman_SKL.IUSaruman_IDLD	Frames:43
		AnimationSound = Sound:BodyFallGenericNoArmor	Animation:IUSaruman_SKL.IUSaruman_LNDA	Frames:4
		AnimationSound = Sound:FootstepDirtA		Animation:IUSaruman_SKL.IUSaruman_MFDA	Frames:10 19 29 39 48 57 66
		AnimationSound = Sound:FootstepDirtA		Animation:IUSaruman_SKL.IUSaruman_RUNA	Frames:11 22 34 46 57 69
		AnimationSound = Sound:FootstepDirtA		Animation:IUSaruman_SKL.IUSaruman_RUNB	Frames:10 23 36 49 62 75
		AnimationSound = Sound:FootstepDirtA		Animation:IUSaruman_SKL.IUSaruman_TNTA	Frames:36 49 103 123
		AnimationSound = Sound:FootstepDirtA		Animation:IUSaruman_SKL.IUSaruman_TNTB	Frames:24 111
	End


	; *** ENGINEERING Parameters ***

	RadarPriority = UNIT
	KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE NOTIFY_OF_PREATTACK ARMY_SUMMARY ATTACK_NEEDS_LINE_OF_SIGHT HEAVY_MELEE_HITTER COMMANDCENTER REPAIR_PAD
	PathfindDiameter = 25 ; = 40.0

	Body = RespawnBody ModuleTag_RespawnBody
		CheerRadius 			= EMOTION_CHEER_RADIUS
		MaxHealth        		= SARUMAN_HEALTH		;BALANCE Saruman Health
		MaxHealthReallyDamaged = 1800
		PermanentlyKilledByFilter	= NONE		;Who kills me permanently?
    		DodgePercent      		= HERO_DODGE_PERCENT
    	BurningDeathBehavior	= Yes
		BurningDeathFX			= FX_InfantryBurningFlame
		CheerRadius				= EMOTION_CHEER_RADIUS
	End
	Behavior = RespawnUpdate ModuleTag_RespawnUpdate
		DeathAnim				= DYING
		;DeathAnim				= STUNNED			;Model condition to play when killed-to-respawn
		DeathFX				= FX_SarumanDieToRespawn	;FXList to play when killed-to-respawn
		DeathAnimationTime		= 5500 ;1133			;How long DeathAnim will take.
		InitialSpawnFX			= FX_SarumanInitialSpawn
		RespawnAnim				= LEVELED				;Animation to play when respawning.
		RespawnFX				= FX_SarumanRespawn		;FXList to play when respawning.
		RespawnAnimationTime		= 2500				;Time it takes for respawn to play.
		AutoRespawnAtObjectFilter	= NONE +CASTLE_KEEP		;Respawn at this location -- and at it's exit production point if possible.
		ButtonImage				= HISaruman_res

		;RespawnEntries determine the ruleset for how a character can be revived. Some units may automatically respawn, others
		;may require a specific revive action performed on him. You can specify different values for each level... or use Level:Any
;;,;;		RespawnRules =			AutoSpawn:No	Cost:2250		Time:90000		Health:100%		;DEFAULT VALUES

		;RespawnRules =			AutoSpawn:No	Cost:2250		Time:HERO_RESPAWNTIME_TIER_4		Health:100%		;DEFAULT VALUES     ;;,;; Version 2.1 Respawn Rules
    ;,; RespawnRules =			AutoSpawn:No	Cost:2250		Time:HERO_RESPAWNTIME_TIER_5		Health:100%		;DEFAULT VALUES    ;;,;; Version 3.0.3 Respawn Rules
	    RespawnRules =			AutoSpawn:No	Cost:3200		Time:HERO_RESPAWNTIME_TIER_5		Health:100% ;Cost:1200
		RespawnEntry =	Level:2				Cost:3400		Time:HERO_RESPAWNTIME_TIER_5
		RespawnEntry =	Level:3				Cost:3600		Time:HERO_RESPAWNTIME_TIER_5
		RespawnEntry =	Level:4				Cost:3800		Time:HERO_RESPAWNTIME_TIER_5
		RespawnEntry =	Level:5				Cost:4000		Time:HERO_RESPAWNTIME_TIER_5
		RespawnEntry =	Level:6				Cost:4200		Time:HERO_RESPAWNTIME_TIER_5
		RespawnEntry =	Level:7				Cost:4400		Time:HERO_RESPAWNTIME_TIER_5
		RespawnEntry =	Level:8				Cost:4600		Time:HERO_RESPAWNTIME_TIER_5
		RespawnEntry =	Level:9				Cost:4800		Time:HERO_RESPAWNTIME_TIER_5
		RespawnEntry =	Level:10			Cost:5000		Time:HERO_RESPAWNTIME_TIER_5
	End

	Behavior = AutoHealBehavior ModuleTag_SarumanHealing
		StartsActive = Yes
		HealingAmount = HERO_HEAL_AMOUNT
		HealingDelay = 1000
		StartHealingDelay = HERO_HEAL_DELAY
		HealOnlyIfNotInCombat = Yes
	End

	Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End

	#include "..\..\..\includes\CaptureBuilding.inc"

	Behavior = AIUpdateInterface ModuleTag_03
		AutoAcquireEnemiesWhenIdle	= Yes ATTACK_BUILDINGS
		AttackPriority				= 	AttackPriority_Infantry
		BurningDeathTime			=	BURNINGDEATH_DURATION_INFANTRY
		AILuaEventsList			    = SarumanFunctions
	End

	Behavior = EmotionTrackerUpdate	Module_EmotionTracker
		TauntAndPointDistance				= 300
		TauntAndPointUpdateDelay			= 10000
		AddEmotion			=	Doom_Base
		//	AddEmotion			=   BraceForBeingCrushed_Base
		//	AddEmotion			=	FearIdle_Base
		//	AddEmotion			=	FearBusy_Base
		AddEmotion			=	Point_Base
		AddEmotion			=	Taunt_Base
 		AddEmotion			=	CheerIdle_Base
		AddEmotion			=	CheerBusy_Base
		//	AddEmotion			=	HeroCheerIdle_Base
		//	AddEmotion			=	HeroCheerBusy_Base
		AddEmotion			=	Alert_Base
		AddEmotion			=	CheerForAboutToCrush_Base
	End

	LocomotorSet
		Locomotor = HumanLocomotor
		Condition = SET_NORMAL
		Speed     = NORMAL_EVIL_HERO_SPEED ;;,;; NORMAL_EVIL_FAST_HERO_SPEED
	End

	LocomotorSet
		Locomotor = HumanWanderLocomotor
		Condition = SET_WANDER
		Speed     = 32
	End

	LocomotorSet
		Locomotor = BurningDeathLocomotorInfantry
		Condition = SET_BURNINGDEATH
		Speed	  = BURNINGDEATH_WANDERSPEED_INFANTRY
	End

	Behavior = PhysicsBehavior ModuleTag_04
		GravityMult = 1.0
		ShockStandingTime		= 4000 ;msec
	End

	Behavior = SlowDeathBehavior ModuleTag_05
		DeathTypes = ALL
		SinkDelay = 3000
		SinkRate = 0.40     ; in Dist/Sec
		DestructionDelay = 8000
		Sound = INITIAL SarumanVoiceDie
		ShadowWhenDead = No
	End

	Behavior = SquishCollide ModuleTag_06
		;nothing
	End

	Behavior = HitReactionBehavior HitReactionBehaviorModuleTag
		HitReactionLifeTimer1 = 3000	; level 1 (light  damage)  hit reaction animations in ms
		HitReactionThreshold1 = 5.0		; level 1 (light  damage) threshold trigger
	End

	#include "..\..\..\aicoding\autoretreat1.inc"
	;-----------------------------------------------------------------------------
	; Ring Hero Mechanic
	;-----------------------------------------------------------------------------
	Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
		PassengerFilter					= NONE
		ObjectStatusOfContained			= UNSELECTABLE ENCLOSED
		;CashBackPercent				= 200%
		;ContainMax						= 99	;// give it a huge capacity, just in case player sends his whole army in at once
		AllowEnemiesInside				= No
		AllowAlliesInside				= No
 		AllowNeutralInside				= No
 		AllowOwnPlayerInsideOverride	= Yes
		;EnterSound						= GUI_RingReturned
		EntryOffset						= X:50.0 Y:0.0 Z:0.0
		EntryPosition					= X:30.0 Y:0.0 Z:0.0		// entry position needs to be offset from the root transform, otherwise fortress obscures point.
		ExitOffset						= X:50.0 Y:0.0 Z:0.0
		StatusForRingEntry				= HOLDING_THE_RING
		UpgradeForRingEntry				= Upgrade_NecromancerRingHero
		ObjectToDestroyForRingEntry		= NONE +TheDroppedRing
		FXForRingEntry					= FX_SarumanOneRingFlare
	End

	Behavior = RemoveUpgradeUpgrade ModuleTag_RemoveRing
		TriggeredBy					= Upgrade_NecromancerRingHero
		UpgradeToRemove				= Upgrade_RingHero Upgrade_FortressRingHero
		RemoveFromAllPlayerObjects	= Yes
		SuppressEvaEventForRemoval	= Yes ; Hack -- this is to avoid the Eva event about 'Gollum stole our ring'
		                                 ; when we are actually losing the upgrade because we built the ring hero
	End

	Behavior = FXListDie ModuleTag_AnnounceWeLostTheRing
		DeathFX = AnnounceFortressDeathLostRingFX  ; FXList checks for ONE_RING model condition internally
	End

	; Spawn a dropped ring object if we have the ring hero upgrade
	Behavior = CreateObjectDie ModuleTag_DropTheRing
		CreationList	= OCL_TheOneRing

		; Needs both the player and object versions to create a ring when destroyed.
		UpgradeRequired	= Upgrade_NecromancerRingHero
	End

	Behavior = UpgradeDie ModuleTag_TheUpgradeDie
		DeathTypes = ALL
		UpgradeToRemove = Upgrade_NecromancerRingHero
	End

	Behavior = CommandSetUpgrade ModueTag_CommandSet_RingHero
        TriggeredBy              	= Upgrade_NecromancerRingHero
        CommandSet               	= SarumanCommandSet_RingHero
    End

	Behavior = ModelConditionUpgrade ModuleTag_ForFX
		TriggeredBy			= Upgrade_NecromancerRingHero
		RequiresAllTriggers	= Yes
		AddConditionFlags	= ONE_RING
	End

	;Behavior = OCLSpecialPower ModuleTag_SauronDarkness
    ;   SpecialPowerTemplate        = SpecialAbilitySauronDarkness
    ;    OCL                  		= OCL_DarknessWeatherChanger
    ;    CreateLocation            	= CREATE_AT_LOCATION
    ;    AttributeModifierWeatherBased    = Yes
    ;    WeatherDuration            	= SPELL_DARKNESS_DURATION
    ;    ChangeWeather            	= CLOUDY
    ;    AvailableAtStart        	= Yes
    ;End

	Behavior = WeaponSetUpgrade WeaponSetUpgradeModuleTag
		TriggeredBy		= Upgrade_NecromancerRingHero
	End

	Behavior = TooltipUpgrade ModuleTag_RingHeroTooltip
		TriggeredBy				= Upgrade_NecromancerRingHero
		Permanent				= No
		DisplayName				= OBJECT:IsengardSarumanRingHero
		;Description			=
	End
	;-----------------------------------------------------------------------------


	;;;	FIRE BALL SPECIAL POWER ;;;
 	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FireballEnabler
		SpecialPowerTemplate	= SpecialAbilitySarumanFireball
		TriggeredBy				= Upgrade_ObjectLevel3 ;Upgrade_SarumanFireBall
	End

	Behavior = SpecialPowerModule ModuleTag_FireballStarter
		SpecialPowerTemplate		= SpecialAbilitySarumanFireball
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
		InitiateSound			= SarumanVoiceAttackFireball
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FireballUpdate
		SpecialPowerTemplate    = SpecialAbilitySarumanFireball
		WhichSpecialWeapon		= 1
		SkipContinue			= Yes

		UnpackTime             	= 800
		PreparationTime			= 1
		PersistentPrepTime		= 1000
		PackTime				= 100

		AwardXPForTriggering    = 0

		StartAbilityRange		= SARUMAN_FIREBALL_RANGE
		MustFinishAbility		= Yes
		SpecialWeapon			= SarumanFireball
	End

	Behavior = AutoAbilityBehavior ModuleTag_FirBallAutoAbility
		SpecialAbility				= SpecialAbilitySarumanFireball
		ForbiddenStatus = INSIDE_GARRISON ;;,;; This seems to prevent the ability from being used inside a tower
		MaxScanRange				= #SUBTRACT( SARUMAN_FIREBALL_RANGE 25 )
;;,;;		Query						= 1 ALL ENEMIES -STRUCTURE
		Query						= 1 ANY ENEMIES +MordorFellBeast +MordorWitchKingOnFellBeast +GondorGwaihir +ElvenGwaihir_Summoned +GondorGwaihir_Summoned +ElvenFortressEagle +KhamulFellBeast +MorgomirFellBeast -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL -FS_BASE_DEFENSE ;;,;;
		Query						= 1 ALL ENEMIES -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL -FS_BASE_DEFENSE ;;,;;
	End


	;-----------------------------------------------------------------------------
	; Voice of Curun√≠r
	;-----------------------------------------------------------------------------
 	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DominateEnabler
		SpecialPowerTemplate		= SpecialAbilityDominateEnemy
		TriggeredBy					= Upgrade_ObjectLevel10
	End
	Behavior = SpecialPowerModule ModuleTag_DominateEnemySpecialPowerModule
		SpecialPowerTemplate		= SpecialAbilityDominateEnemy
		StartsPaused				= Yes
		UpdateModuleStartsAttack	= Yes
		InitiateSound				= SarumanVoiceDominate
	End
 	Behavior = DominateEnemySpecialPower ModuleTag_DominateEnemySpecialPower
        SpecialPowerTemplate		= SpecialAbilityDominateEnemy
		UnpackingVariation			= 1
		StartAbilityRange			= 275.0 ;;,;; 200.0

;;,;;		AttributeModifierAffects	= ALL -DOZER -HERO -STRUCTURE -ARMY_OF_DEAD -MOVE_ONLY -AngmarThrallMaster ENEMIES NEUTRAL

		AttributeModifierAffects	= ALL -DOZER -HERO -STRUCTURE -ARMY_OF_DEAD -MOVE_ONLY AOTR_NOT_HEROIC_UNITS -SUMMONED -SummonedDragon -WatcherHead -WatcherHittingArm -ElvenTransportShip -ElvenShip_Interface -InternalShipGoodArcher -EvilMenTransportShip -EvilShip_Interface -InternalShipEvilArcher ENEMIES NEUTRAL

		DominateRadius				= 85 ;100 ;;,;; 60 ;100 ;150
		DominatedFX					= FX_SarumanDominateTargets
		TriggerFX					= FX_SarumanDominateTrigger

		UnpackTime					= 1200 ;;,;; 2000
		PreparationTime				= 1
		FreezeAfterTriggerDuration	= 2500 ; Hold AI for this long after we fire.
		PermanentlyConvert	= No ;;,;; Added for 2.3
    End
	Behavior = AutoAbilityBehavior ModuleTag_DominateEnemyAutoAbility ;;,;;
		SpecialAbility				= SpecialAbilityDominateEnemy
		ForbiddenStatus = INSIDE_GARRISON ;;,;; This seems to prevent the ability from being used inside a tower
		MaxScanRange				= 200
		Query						= 10 ALL ENEMIES -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL -FS_BASE_DEFENSE ;;,;;
;;,;;		Query						= 1 ALL ENEMIES -STRUCTURE
	End
	;-----------------------------------------------------------------------------

	;;; SPEECH CRAFT LEVEL GAIN SPECIAL POWER ;;;
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KingsFavorEnabler
		SpecialPowerTemplate		= SpecialAbilityKingsFavor
		TriggeredBy					= Upgrade_ObjectLevel5 ;Upgrade_SarumanSpeechCraft
	End

 	Behavior = SpecialPowerModule ModuleTag_KingsFavorSpecialPowerModule
        SpecialPowerTemplate		= SpecialAbilityKingsFavor
        StartsPaused				= Yes
		UpdateModuleStartsAttack	= Yes
        InitiateSound				= SarumanVoiceSpeechCraft
    End

 	Behavior = LevelGrantSpecialPower ModuleTag_KingsFavor
		SpecialPowerTemplate		= SpecialAbilityKingsFavor
		UnpackingVariation			= 2
		StartAbilityRange			= 200.0
;		LevelFX = FX_PorterDeliver

		Experience					= 100 ;85 ;,; 70 ;80 ;100 ;;,;; 50
		RadiusEffect				= 150 ;;,;; 100
		AcceptanceFilter			= KINGSFAVOR_OBJECTFILTER
		LevelFX						= FX_LevelUp

		UnpackTime					= 2000
		PreparationTime				= 1
		FreezeAfterTriggerDuration	= 2500 ; Hold AI for this long after we fire.
    End

	Behavior = AutoAbilityBehavior ModuleTag_KingsFavorAutoAbility ;;,;;
		SpecialAbility	= SpecialAbilityKingsFavor
		ForbiddenStatus = INSIDE_GARRISON ;;,;; This seems to prevent the ability from being used inside a tower
		MaxScanRange	= 200
		Query		= 10 ANY +CAVALRY +INFANTRY -STRUCTURE -CASTLE_KEEP -BASE_FOUNDATION -HERO -MOVE_ONLY -DOZER -SUMMONED ALLIES
	End

	;Behavior = ProductionUpdate ProductionUpdateModuleTag
	;	GiveNoXP = Yes
	;End

	;Behavior = QueueProductionExitUpdate ModuleTag_11
	;	PlacementViewAngle  = 45
	;	UnitCreatePoint			= X:10.0 Y:0.0 Z:0.0
	;	NaturalRallyPoint		= X:20.0 Y:-20.0 Z:0.0
	;	ExitDelay			= 100 ;STANDARD_HORDE_EXIT_DELAY
	;	;NoExitPath			= Yes
	;End

	;Behavior = SpawnBehavior ModuleTag_SpawnFighters
	;	SpawnNumber = 4
	;	InitialBurst = 4
	;	SpawnTemplateName = IsengardWildmanGuard_Saruman ;IsengardFanatic_Slaved
	;	SpawnReplaceDelay = 9999999
	;	FadeInTime = 3000
	;	SpawnInsideBuilding = No
	;	CanReclaimOrphans	= Yes
	;End


;-------------------------------------------------------------------------------------------
;----------------- LEADERSHIP
;-------------------------------------------------------------------------------------------
	Behavior = AttributeModifierAuraUpdate ModuleTag_GandalfLeadership
		StartsActive	= No
		BonusName	= GandalfPassiveLeadership
		TriggeredBy	= Upgrade_ObjectLevel1
		RefreshDelay	= 2000
		Range		= 200
		ObjectFilter	= ANY +INFANTRY +CAVALRY -STRUCTURE -BASE_FOUNDATION -HERO -DOZER ALLIES
	End
	Behavior = ObjectCreationUpgrade ModuleTag_RemoveUpgrades0
		TriggeredBy = Upgrade_NecromancerRingHero
		RemoveUpgrade = Upgrade_ObjectLevel1
    End
	Behavior = AttributeModifierAuraUpdate ModuleTag_GandalfLeadership2
		StartsActive	= No
		BonusName	= SarumanRingHeroLeadership
		TriggeredBy	= Upgrade_NecromancerRingHero
		RefreshDelay	= 2000
		Range		= 200
		ObjectFilter	= ANY +INFANTRY +CAVALRY -STRUCTURE -BASE_FOUNDATION -HERO -DOZER ALLIES
	End
	;------------------------------------------------------
	Behavior = AttributeModifierAuraUpdate ModuleTag_GandalfLeadership3
		StartsActive	= No
		BonusName	= SarumanFurnaceLeadership
		TriggeredBy	= Upgrade_ObjectLevel5 Upgrade_NecromancerRingHero
		RequiresAllTriggers = Yes
		RefreshDelay	= 2000
		Range		= 300 ;200
		ObjectFilter	= ANY +IsengardFurnace +Furnace ALLIES
	End
	;--------------------------------------------------------
	Behavior = AttributeModifierAuraUpdate ModuleTag_FearMe
		StartsActive	= No										;If no, requires upgrade to turn on.
		BonusName		= SauronFear
		TriggeredBy	= Upgrade_NecromancerRingHero
		RefreshDelay	= 5000
		Range			= 250.0
		ObjectFilter	= ANY +INFANTRY +CAVALRY ENEMIES
		TargetEnemy		= Yes
		MaxActiveRank	= 10											;Only affects level 1 rank units
	End

;-------------------------------------------------------------------------------------------
;----------------- Sharkey's Ruffians
;-------------------------------------------------------------------------------------------
	Behavior = AttributeModifierAuraUpdate ModuleTag_SharkeyLeadership
		StartsActive	= Yes
		BonusName	= SharkeyRuffianLeadership
		RefreshDelay	= 2000
		Range		= 200
		ObjectFilter	= NONE +Ruffian +RuffianBow ALLIES
	End
;-------------------------------------------------------------------------------------------
;-----------------;;; WIZARD BLAST SPECIAL POWER ;;;
;-------------------------------------------------------------------------------------------
	Behavior = SpecialPowerModule ModuleTag_WizardBlastStarter
		SpecialPowerTemplate		= SpecialPowerTelekeneticPush
		UpdateModuleStartsAttack	= Yes
		InitiateSound			= SarumanVoiceAttackWizardBlast
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WizardBlastUpdate
		SpecialPowerTemplate		= SpecialPowerTelekeneticPush
		WhichSpecialWeapon		    = 2 ;
		SkipContinue				= Yes
		UnpackTime					= 700
		PreparationTime				= 1
		PersistentPrepTime			= 1000
		PackTime					= 100

		AwardXPForTriggering		= 0
		StartAbilityRange			= 80.0
		MustFinishAbility			= Yes
		SpecialWeapon				= SarumanWizardBlast
	End

	Behavior = AutoAbilityBehavior ModuleTag_WizardBlastAutoAbility
		SpecialAbility				= SpecialPowerTelekeneticPush
		ForbiddenStatus = INSIDE_GARRISON ;;,;; This seems to prevent the ability from being used inside a tower
		MaxScanRange				= #SUBTRACT( GANDALF_FORCE_ATTACK_RANGE 25 )
;;,;;		Query						= 1 ALL ENEMIES -STRUCTURE
		Query						= 10 ALL ENEMIES -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL -FS_BASE_DEFENSE ;;,;;
	End


;//---------------------------------LIGHTNING BLAST-----------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_IstariLightEnabler
		SpecialPowerTemplate = SpecialAbilityLightingBolt
		TriggeredBy = Upgrade_ObjectLevel7 ;Upgrade_SarumanThunderBolt
	End
	Behavior = SpecialPowerModule ModuleTag_IstariLightPower
		SpecialPowerTemplate		= SpecialAbilityLightingBolt
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
		InitiateSound				= SarumanVoiceAttackCharge
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_IstariLightUpdate
		SpecialPowerTemplate    = SpecialAbilityLightingBolt
		SkipContinue			= Yes
		UnpackTime              = 1500
 		PreparationTime         = 1
 		PersistentPrepTime      = 1000
 		PackTime                = 500
		AwardXPForTriggering    = 0
		StartAbilityRange		= 290; Note: This has to be smaller than the weapon range or it'll never succeed
		ApproachRequiresLOS		= Yes
		SpecialWeapon			= SarumanLightningBlastWeapon
		MustFinishAbility		= Yes
		WhichSpecialWeapon		= 3
		BusyForDuration			= 2500
	End

	Behavior = AutoAbilityBehavior ModuleTag_LighntingAutoAbility
		SpecialAbility				= SpecialAbilityLightingBolt
		ForbiddenStatus = INSIDE_GARRISON ;;,;; This seems to prevent the ability from being used inside a tower
		MaxScanRange				= #SUBTRACT( SARUMAN_LIGHTNING_RANGE 25 )
		Query						= 30 ALL ENEMIES -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL -FS_BASE_DEFENSE ;;,;;
;;,;;		Query						= 1 ALL ENEMIES -STRUCTURE
	End

;-------------------------------------------
;          SARUMAN OF MANY COLORS POWERS
;-------------------------------------------
	; Upgrade weaponset
	Behavior = WeaponSetUpgrade ModuleTag_Saruweapon
		TriggeredBy	= Upgrade_NecromancerRingHero
	End

	; Behavior = AttributeModifierUpgrade ModuleTag_saruAttrib
		; TriggeredBy	= Upgrade_NecromancerRingHero
		; AttributeModifier = IsengardSarumanOfManyColors
	; End

	; Greater Wizard Blast (enhanced wizard blast)
	; ------------------
	Behavior = SpecialPowerModule ModuleTag_SMCWizardBlastStarter
		SpecialPowerTemplate		= SpecialPowerTelekeneticPushSMC
		UpdateModuleStartsAttack	= Yes
		InitiateSound			= SarumanVoiceAttackWizardBlast
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SMCWizardBlastUpdate
		SpecialPowerTemplate		= SpecialPowerTelekeneticPushSMC
		WhichSpecialWeapon		    = 2 ;
		SkipContinue				= Yes
		UnpackTime					= 700
		PreparationTime				= 1
		PersistentPrepTime			= 1000
		PackTime					= 100

		AwardXPForTriggering		= 0
		StartAbilityRange			= 190
		MustFinishAbility			= Yes
		SpecialWeapon				= SarumanImprovedWizardBlast
	End

	;--------------------------------------------------------------------
	;              NEW VERSION OF IMPROVED WIZARD BLAST
	;-------------------------------------------------------------------

	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FloodEnabler
		SpecialPowerTemplate = SpellBookSarumanFlood
		TriggeredBy = Upgrade_ObjectLevel1
	End

	Behavior = SpecialPowerModule ModuleTag_FloodStarter
		SpecialPowerTemplate		= SpellBookSarumanFlood
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
;		InitiateSound				= ArwenVoiceFlood
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FloodUpdate
		SpecialPowerTemplate    = SpellBookSarumanFlood

		UnpackTime              = 1300
		PackTime                = 1500

		StartAbilityRange = 150.0

		SpecialWeapon = SarumanPersonalFlood
		WhichSpecialWeapon = 1
	End

    Behavior = AutoAbilityBehavior ModuleTag_ArwenFloodAutoAbility ;;,;;
		SpecialAbility			= SpellBookSarumanFlood
		ForbiddenStatus = INSIDE_GARRISON ;;,;; This seems to prevent the ability from being used inside a tower
		MaxScanRange			= 150.0
		Query						= 20 ALL ENEMIES -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL -FS_BASE_DEFENSE
		Query						= 1 ANY +STRUCTURE ENEMIES
	End
	;--------------------------------------------------------------------
	;              RUINOUS WRATH
	;-------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RuinousWrathEnabler
		SpecialPowerTemplate = SpecialAbilityRuinousWrath
		TriggeredBy = Upgrade_ObjectLevel3
	End
	; Behavior = SpecialPowerModule ModuleTag_RuinousWrathStarter
		; SpecialPowerTemplate		= SpecialAbilityRuinousWrath
		; UpdateModuleStartsAttack	= Yes
		; StartsPaused				= Yes
; ;		InitiateSound				= NecromancerVoiceDread
	; End
		Behavior = OCLSpecialPower ModuleTag_RuinousWrath
		SpecialPowerTemplate = SpecialAbilityRuinousWrath
		OCL                  = OCL_SpawnRuinousWrath
		TriggerFX			 = FX_SarumanRuinousWrath
		CreateLocation       		= CREATE_AT_LOCATION
		UpdateModuleStartsAttack	= No
		StartsPaused		 		= Yes
		; InitiateSound				= KrimpulVoiceDungeonMaster
	End
	Behavior = AutoAbilityBehavior ModuleTag_StarlightAutoAbilityBehavior
		SpecialAbility				= SpecialAbilityRuinousWrath
		ForbiddenStatus 			= INSIDE_GARRISON
		MaxScanRange				= 300  ;special power is 800
		Query						= 15 ANY ENEMIES +INFANTRY +CAVALRY -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL -FS_BASE_DEFENSE
	End
	;--------------------------------------------------------------------
	;              DARK ELOQUENCE
	;-------------------------------------------------------------------

	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DarkEloquenceEnabler
		SpecialPowerTemplate		= SpecialAbilityDarkEloquence
		TriggeredBy					= Upgrade_ObjectLevel5 ;Upgrade_SarumanSpeechCraft
	End

 	Behavior = SpecialPowerModule ModuleTag_DarkEloquenceSpecialPowerModule
        SpecialPowerTemplate		= SpecialAbilityDarkEloquence
        StartsPaused				= Yes
		UpdateModuleStartsAttack	= Yes
        InitiateSound				= SarumanVoiceSpeechCraft
    End

 	Behavior = LevelGrantSpecialPower ModuleTag_DarkEloquence
		SpecialPowerTemplate		= SpecialAbilityDarkEloquence
		UnpackingVariation			= 4
		StartAbilityRange			= 200.0
;		LevelFX = FX_PorterDeliver

		Experience					= 100 ;85 ;,; 70 ;80 ;100 ;;,;; 50
		RadiusEffect				= 150 ;;,;; 100
		AcceptanceFilter			= KINGSFAVOR_OBJECTFILTER
		LevelFX						= FX_LevelUp

		UnpackTime					= 2000
		PreparationTime				= 1
		FreezeAfterTriggerDuration	= 2500 ; Hold AI for this long after we fire.
    End

	Behavior = AutoAbilityBehavior ModuleTag_DarkEloquenceAutoAbility ;;,;;
		SpecialAbility	= SpecialAbilityDarkEloquence
		ForbiddenStatus = INSIDE_GARRISON ;;,;; This seems to prevent the ability from being used inside a tower
		MaxScanRange	= 200
		Query		= 10 ANY +CAVALRY +INFANTRY -STRUCTURE -CASTLE_KEEP -BASE_FOUNDATION -HERO -MOVE_ONLY -DOZER -SUMMONED ALLIES
	End
	;-----------------------------------------------------------------------------
	; STORM OF ORTHANC
	;-----------------------------------------------------------------------------
    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_StormofOrthanc
        SpecialPowerTemplate       = SpellBookIsengardStorm
        TriggeredBy                = Upgrade_ObjectLevel7
    End
	Behavior				 = OCLSpecialPower ModuleTag_Nastystorm
		SpecialPowerTemplate = SpellBookIsengardStorm
		OCL                  = OCL_SpawnIsengardSpellbookStorm
		CreateLocation       = CREATE_AT_LOCATION
		TriggerFX			=  FX_IsengardStormInitiate
		AvailableAtStart	 = No
		StartsPaused		 		= Yes
	End
	;-----------------------------------------------------------------------------
	; The Ruling Ring
	;-----------------------------------------------------------------------------
 	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DominateRingEnabler
		SpecialPowerTemplate		= SpecialAbilityDominateEnemyRing
		TriggeredBy					= Upgrade_ObjectLevel10
	End
	Behavior = SpecialPowerModule ModuleTag_DominateEnemyRingSpecialPowerModule
		SpecialPowerTemplate		= SpecialAbilityDominateEnemyRing
		StartsPaused				= Yes
		UpdateModuleStartsAttack	= Yes
		InitiateSound				= SarumanVoiceDominate
	End
 	Behavior = DominateEnemySpecialPower ModuleTag_DominateEnemyRingSpecialPower
        SpecialPowerTemplate		= SpecialAbilityDominateEnemyRing
		UnpackingVariation			= 3
		StartAbilityRange			= 275.0 ;;,;; 200.0

;;,;;		AttributeModifierAffects	= ALL -DOZER -HERO -STRUCTURE -ARMY_OF_DEAD -MOVE_ONLY -AngmarThrallMaster ENEMIES NEUTRAL

		AttributeModifierAffects	= ALL -DOZER -HERO -STRUCTURE -ARMY_OF_DEAD -MOVE_ONLY AOTR_NOT_HEROIC_UNITS -SUMMONED -SummonedDragon -WatcherHead -WatcherHittingArm -ElvenTransportShip -ElvenShip_Interface -InternalShipGoodArcher -EvilMenTransportShip -EvilShip_Interface -InternalShipEvilArcher ENEMIES NEUTRAL ;,; Added -SummonedDragon -WatcherHead -WatcherHittingArm -ElvenTransportShip -ElvenShip_Interface -InternalShipGoodArcher -EvilMenTransportShip -EvilShip_Interface -InternalShipEvilArcher in v5.1 ;;,;; Version 2.1

		DominateRadius				= 85 ;100 ;;,;; 60 ;100 ;150
		; DominatedFX					= FX_SarumanDominateTargets
		TriggerFX					= FX_RulingRingTrigger

		UnpackTime					= 1200 ;;,;; 2000
		PreparationTime				= 1
		FreezeAfterTriggerDuration	= 2500 ; Hold AI for this long after we fire.
		PermanentlyConvert			= Yes
    End
	Behavior = AutoAbilityBehavior ModuleTag_DominateEnemyRingAutoAbility
		SpecialAbility				= SpecialAbilityDominateEnemyRing
		ForbiddenStatus 			= INSIDE_GARRISON ;;,;; This seems to prevent the ability from being used inside a tower
		MaxScanRange				= 200
		Query						= 10 ALL ENEMIES -STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL -FS_BASE_DEFENSE
	End
	;----------------------------------------------------------------------


	;Behavior = ExperienceLevelCreate ModuleTag_LevelBonus
	;	LevelToGrant	= 5
	;	MPOnly			= Yes
	;End

	;///////////////////
	; AISpecialPowers
	;///////////////////

	Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
		CommandButtonName = Command_SetStanceBattle
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
	End

	Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive ;;,;; Changed for 3.0.1
		CommandButtonName = Command_AttackMove ;;,;; Command_SetStanceAggressive ;;,;; Changed for 3.0.1
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
	End

	Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
		CommandButtonName = Command_SetStanceHoldGround
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
	End


	Behavior = AISpecialPowerUpdate SpecialPowerSarumanGiveXPAoE ;;,;; GandalfToggleMountedAI
		CommandButtonName = Command_SpecialAbilitySpeechCraft
		SpecialPowerAIType = AI_SPECIAL_POWER_GIVEXP_AOE
		SpecialPowerRadius = 30.0
	End

	Behavior = AISpecialPowerUpdate WizardBlastAI
		CommandButtonName = Command_SpecialAbilityIsengardWizardBlast
		SpecialPowerAIType = AI_SPECIAL_POWER_GANDALF_WIZARD_BLAST
		SpecialPowerRadius = 100
	End

	Behavior = AISpecialPowerUpdate FireballAI
		CommandButtonName = Command_SarumanFireball
		SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
		SpecialPowerAIType = AI_SPECIAL_POWER_MORGUL_BLADE ;;,;; Added for 2.5
	End

	Behavior = AISpecialPowerUpdate ThunderboltAI
		CommandButtonName = Command_SarumanThunderBolt
		SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER ;;,;; AI_SPELLBOOK_ARMY_BREAKER
		SpecialPowerRadius = 125 ;;,;;
	End

	Behavior = AISpecialPowerUpdate DominateAI
		CommandButtonName = Command_SpecialAbilityDominateEnemy
		SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK ;;,;; ;;; AI_SPECIAL_POWER_DOMINATE_ENEMY
		SpecialPowerRadius = 80
	End

	Behavior = AISpecialPowerUpdate DoubtAI
		CommandButtonName = Command_SpecialAbilitySarumanImprovedWizardBlastNew
		SpecialPowerAIType = AI_SPELLBOOK_ASSIST_BATTLE_DEBUFF
		SpecialPowerRadius = 125
	End

	Behavior = AISpecialPowerUpdate DoubtAI2
		CommandButtonName = Command_SpecialAbilityRuinousWrath
		SpecialPowerAIType = AI_SPELLBOOK_ASSIST_BATTLE_DEBUFF
		SpecialPowerRadius = 125
	End

	Behavior = AISpecialPowerUpdate DoubtAI3
		CommandButtonName = Command_SpecialAbilityStormofOrthanc
		SpecialPowerAIType = AI_SPELLBOOK_ASSIST_BATTLE_DEBUFF
		SpecialPowerRadius = 125
	End

	Behavior = AISpecialPowerUpdate RingDominateAI
		CommandButtonName = Command_SpecialAbilityDominateEnemyRing
		SpecialPowerAIType = AI_SPECIAL_POWER_RANGED_AOE_ATTACK
		SpecialPowerRadius = 80
	End

;//---------------------------------------------------------------------------------------

	Geometry				= CYLINDER
	GeometryMajorRadius		= 8.0
	GeometryMinorRadius		= 8.0
	GeometryHeight			= 19.2
	GeometryIsSmall			= Yes

	Shadow					= SHADOW_DECAL
	ShadowSizeX				= 19
	ShadowSizeY				= 19
	ShadowTexture			= ShadowI
End

ChildObject IsengardSaruman_WOTR IsengardSaruman
	Behavior = ExperienceLevelCreate ModuleTag_LevelBonus
		LevelToGrant	= 1
		MPOnly			= Yes
	End
	Behavior = GrantUpgradeCreate ModuleTag_GiveUpgrade
		UpgradeToGrant			= Upgrade_WOTRHero7
	End
End

;------------------------------------------------------------------------------
;------------------------------------------------------------------------------
;Elven grove object
Object RuinousWrath_Ping

	; *** ART Parameters ***
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = NONE
			;ParticleSysBone = None TaintHCPing ;HouseColor:yes
			;ParticleSysBone = None FX_CrackOfDoom
		End

		MultiPlayerOnly = No
	End

	; *** AUDIO Parameters ***
	;SoundAmbient				= Amb_HissSteamLava1
	SoundAmbient				= LivingWorldMountDoomLoop

	; ***DESIGN parameters ***
	DisplayName     = OBJECT:ElvenGrove
	Side            = Isengard
	EditorSorting   = STRUCTURE
	ThreatLevel		= 0.5

	; *** ENGINEERING Parameters ***
	RadarPriority       = NOT_ON_RADAR
	KindOf              = NO_COLLIDE IMMOBILE UNATTACKABLE IGNORE_FOR_VICTORY IGNORE_FOR_EVA_SPEECH_POSITION MOVE_ONLY ;TAINT

	Body = ActiveBody ModuleTag_01
		MaxHealth		= 999999
		InitialHealth	= 999999
	End

	Behavior = FireWeaponUpdate ModuleTag_BURNME
			FireWeaponNugget
				WeaponName = RuinousWrathWeapon	;CrackOfDoomWeapon
				FireDelay = 0
				OneShot = No
			End
	End

	Behavior = AttributeModifierAuraUpdate ModuleTag_WeLikeSnow
		StartsActive	= Yes
		BonusName		= FrozenLandSpeedModifier
		RefreshDelay	= 2000
		Range			= SPELLBOOK_TAINT_RADIUS
		TargetEnemy		= No
		ObjectFilter	= ANGMAR_NECRO_BLACK_ICE_SPECIAL_OBJECT_FILTER
	End

	Behavior = AttributeModifierAuraUpdate ModuleTag_WeHateSnow ;;,;; added
		StartsActive	= Yes
		BonusName		= FrozenLandSpeedModifier
		RefreshDelay	= 2000
		Range			= SPELLBOOK_TAINT_RADIUS
		TargetEnemy		= Yes
		ObjectFilter	= ANGMAR_NECRO_BLACK_ICE_SPECIAL_OBJECT_FILTER
	End

	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
			MinLifetime		= 15000 ;SPELLBOOK_TAINT_TIME
			MaxLifetime		= 15000 ;SPELLBOOK_TAINT_TIME
			DeathType		= FADED
	End

	;Behavior = DeletionUpdate ModuleTag_LifeTimeUpdate
	;	MinLifetime		= SPELLBOOK_TAINT_TIME
	;	MaxLifetime		= SPELLBOOK_TAINT_TIME
	;End

	Shadow		= SHADOW_DECAL
	ShadowSizeX = 120
	ShadowSizeY = 120
End

;---------------------------------------------------------------------------------------------
;---------------------------------------------------------------------------------------------
Object IsengardSpellbookStormObject

	ButtonImage = HIIsengard_Storm
    SelectPortrait         = HPIsengard_Storm
	Scale = 0.75
	Draw = W3DTankDraw ModuleTag_01
		OkToChangeModelColor	= Yes
		ExtraPublicBone = LIGHTNING_01
		ExtraPublicBone = LIGHTNING_02
		ExtraPublicBone = LIGHTNING_03
		ExtraPublicBone = LIGHTNING_04
		ExtraPublicBone = LIGHTNING_05
		ExtraPublicBone = LIGHTNING_06
		ExtraPublicBone = LIGHTNING_07
		ExtraPublicBone = LIGHTNING_08

		DefaultModelConditionState
			;Model           = dbelderhall_d1
			Model           = iustorm_skn

		    Turret              = LIGHTNING_01
			WeaponLaunchBone = PRIMARY LIGHTNING_  ;01

			ParticleSysBone = LIGHTNING_03 dRainingCloudsHuge FollowBone:yes
			ParticleSysBone = LIGHTNING_07 dRainingCloudsNoOffset FollowBone:yes

			ParticleSysBone = LIGHTNING_05 dRainingCloudsNoOffset FollowBone:yes
			ParticleSysBone = LIGHTNING_06 dRainingCloudsNoOffset FollowBone:yes
			ParticleSysBone = LIGHTNING_06 dRainingCloudsNoOffset FollowBone:yes
			ParticleSysBone = LIGHTNING_01 dRainingCloudsNoOffset FollowBone:yes


			ParticleSysBone = LIGHTNING_07 LightingCloudFlashAmbient FollowBone:yes
			ParticleSysBone = LIGHTNING_03 LightingCloudFlashAmbient FollowBone:yes
		End


	End
	; Draw = W3DScriptedModelDraw ModuleTag_DRAW
		; DefaultModelConditionState
			; Model               = dExRainEffect
			; ParticleSysBone = NONE dRainingClouds FollowBone:yes
			;ParticleSysBone     = B_SWORDBONE LightningCharge FollowBone:Yes
		; End
	; End

	WeaponSet
        Conditions = None
        Weapon = PRIMARY IsengardLightningBolt
		; Weapon = SECONDARY IsengardLightningBolt
		; Weapon = TERTIARY IsengardLightningBolt
        AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

	; ***DESIGN parameters ***
	Side			= Isengard
	EditorSorting	= UNIT
	ThreatLevel		= 0.0
	CommandPoints	= 0
;	ImmuneToShockwave	= yes
	ShockwaveResistance = SHOCKWAVE_RESISTANCE_ALWAYS

	VisionRange		= 200.0
	DisplayName		= OBJECT:IsengardStormOfOrthanc

	CommandSet		= EmptyCommandSet

	SoundAmbient = IsengardStormAmbient

	; *** AUDIO Parameters ***

;	EvaEnemyUnitSightedEvent = None  ; Don't bother player about this object showing up over their base -- happens too much to bother
	;SoundCreated = EyeOfSauronCreated
	SoundMoveStart = EyeOfSauronMoveStart
	VoiceSelect = EyeOfSauronMoveStart


	; *** ENGINEERING Parameters ***

	RadarPriority = UNIT
	KindOf = SELECTABLE NO_COLLIDE AIRCRAFT UNATTACKABLE CLICK_THROUGH HERO IGNORE_FOR_VICTORY IGNORE_FOR_EVA_SPEECH_POSITION NOT_AUTOACQUIRABLE IGNORES_SELECT_ALL PRELOAD ;MOVE_ONLY MONSTER


	Body = ActiveBody ModuleTag_02
		MaxHealth         = 200000
		MaxHealthDamaged  = 100000
		;RecoveryTime      = 5000
	End

	Behavior = AIUpdateInterface	ModuleTag_AIUpdateInterface
		AutoAcquireEnemiesWhenIdle = Yes
		Turret
			TurretTurnRate = 360        ; turn rate, in degrees per sec
            ControlledWeaponSlots = PRIMARY
        End

		; Turret
			; TurretTurnRate = 360        ; turn rate, in degrees per sec
            ; ControlledWeaponSlots = SECONDARY
        ; End

		; Turret
			; TurretTurnRate = 360        ; turn rate, in degrees per sec
            ; ControlledWeaponSlots = TERTIARY
        ; End

	End

	Behavior = PhysicsBehavior		ModuleTag_PhysicsBehavior
	End

	LocomotorSet
		Locomotor = StormLocomotor
		Condition = SET_NORMAL
		Speed     = 50 ;200
	End

	Behavior = LifetimeUpdate ModuleTag_LifetimeUpdate
		MinLifetime		= 60000
		MaxLifetime		= 60000
	End


	  Behavior = AttributeModifierAuraUpdate ModuleTag_Stormeffect
		StartsActive	= Yes
		BonusName		= IsengardSpellbookStormModifier
		RefreshDelay	= 2500
		Range			= 175
		TargetEnemy		= Yes
		ObjectFilter		= ANY ENEMIES +INFANTRY +CAVALRY +HORDE -STRUCTURE -BASE_FOUNDATION +HERO
	End

	  Behavior = SlowDeathBehavior ModuleTag_05
		DeathTypes = ALL
	End

	Geometry = CYLINDER
	GeometryMajorRadius = 1.0
	GeometryMinorRadius = 1.0
	GeometryHeight		= 1.0
	GeometryIsSmall		= Yes

End

;----------------------------------------------------------------------------------------
;----------------------------------------------------------------------------------------
;------------------------------------------------------------------------------
Object SarumanFlood

 	Draw = W3DScriptedModelDraw ModuleTag_01
    	DefaultModelConditionState
	      	Model = None
    	End
  	End
	EditorSorting   = SYSTEM
	KindOf = NO_COLLIDE IMMOBILE UNATTACKABLE INERT
	ForceLuaRegistration = Yes ; I have no AI, but I want to send a fear message so please register me.

	; *** ENGINEERING Parameters ***
	Body = ImmortalBody ModuleTag_02
		MaxHealth = 1
		InitialHealth = 1
	End

	 SoundAmbient = TornadoLoopMS

	Behavior = DeletionUpdate ModuleTag_03 ; Not LifetimeUpdate, since I can't die.  This will DestroyObject me.
		MinLifetime = 10000
		MaxLifetime = 10000
	End

	Behavior = FloodUpdate ModuleTag_FloodCentral
		AngleOfFlow = 0	; In degrees, with 0 as screen right
		DirectionIsRelative = Yes ; If it is relative, it adds the facing of the flood object.

		FloodMember
			MemberTemplateName = FloodTelekinesis
			ControlPointOffsetOne =		X:-100 Y:10 Z:0	; Offset from center point of flood.
			ControlPointOffsetTwo =		X:0 Y:50 Z:0
			ControlPointOffsetThree =	X:0 Y:-50 Z:0
			ControlPointOffsetFour =	X:200 Y:-50 Z:0 ;X:100 Y:-50 Z:0
			MemberSpeed = 20
		End
		FloodMember
			MemberTemplateName = FloodTelekinesis
			ControlPointOffsetOne =		X:-100 Y:0 Z:0
			ControlPointOffsetTwo =		X:-50 Y:0 Z:0
			ControlPointOffsetThree =	X:50 Y:0 Z:0
			ControlPointOffsetFour =	X:200 Y:0 Z:0  ;X:100 Y:0 Z:0
			MemberSpeed = 20
		End
		FloodMember
			MemberTemplateName = FloodTelekinesis
			ControlPointOffsetOne =		X:-100 Y:-10 Z:0
			ControlPointOffsetTwo =		X:0 Y:-50 Z:0
			ControlPointOffsetThree =	X:0 Y:50 Z:0
			ControlPointOffsetFour =	X:200 Y:50 Z:0 ;X:100 Y:50 Z:0
			MemberSpeed = 20
		End
		; FloodMember                                              ;   EXPERIMENTAL MEMBER - INCREASED FINAL X FACTOR
			; MemberTemplateName = FloodTelekinesis
			; ControlPointOffsetOne =		X:-100 Y:-10 Z:0
			; ControlPointOffsetTwo =		X:0 Y:-50 Z:0
			; ControlPointOffsetThree =	X:0 Y:50 Z:0
			; ControlPointOffsetFour =	X:200 Y:50 Z:0
			; MemberSpeed = 20
		; End
	End

	Geometry            = BOX
	GeometryMajorRadius = 10.0
	GeometryMinorRadius = 1.0
	GeometryHeight      = 3.0
	GeometryIsSmall     = No
	Shadow              = NONE
End

;---------------------------------------
Object FloodTelekinesis

	Draw = W3DScriptedModelDraw ModuleTag_01
	StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
		DefaultModelConditionState
			Model = NONE
			ParticleSysBone = Bone05 CrushingBlastNGlow FollowBone:Yes
			; ParticleSysBone = Bone05 WaterHorseTrail2 FollowBone:Yes
			; ParticleSysBone = Bone05 WaterHorseTrail3 FollowBone:Yes
		End

		; IdleAnimationState
			; StateName				= STATE_Idle
			; Animation				= IDLE
				; AnimationName		= FloodHorse_SKL.FloodHorse_RUNA
				; AnimationMode		= LOOP
			; End
			; Flags					= RANDOMSTART
		; End

		; AnimationState				= MOVING
			; Animation				= RUNA
				; AnimationName		= FloodHorse_SKL.FloodHorse_RUNA
				; AnimationMode		= LOOP
			; End
			; Flags					= RANDOMSTART
		; End

	End

	EditorSorting   = SYSTEM
	KindOf = NO_COLLIDE IMMOBILE UNATTACKABLE INERT

	; *** ENGINEERING Parameters ***
	Body = HighlanderBody ModuleTag_02
		MaxHealth = 1
		InitialHealth = 1
	End

	Behavior = FireWeaponUpdate ModuleTag_WeaponFiring
		FireWeaponNugget
			WeaponName = SarumanFloodRadiusWeapon ;FloodHorseRadiusWeapon
			Offset = X:-25 Y:0 Z:0
			FireDelay = 0
			OneShot = No
		End
	End

	Behavior = SlowDeathBehavior ModuleTag_FadeOut
		DeathTypes			= ALL
		DestructionDelay	= 0
	End

	Geometry = CYLINDER
	GeometryMajorRadius = 17.6
	GeometryHeight = 32.0
	GeometryIsSmall = No
End
