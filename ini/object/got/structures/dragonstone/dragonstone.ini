;//------------------------------------------------------------------------------
;// This is the magic thing in the .bse file that tells how to center the base layout compared to the game position of the fortress
Object MordorFortressCenterGeneric

	SelectPortrait = BPMordorFortressNew

	Draw = W3DScriptedModelDraw ModuleTag_01

    	DefaultModelConditionState
      		Model = None
    	End

		ModelConditionState = WORLD_BUILDER
			Model = NBasePin
		End
	End

	Side			= Mordor
	EditorSorting	= STRUCTURE
	KindOf			= IMMOBILE BASE_FOUNDATION CASTLE_CENTER

	Behavior = CastleBehavior ModuleTag_castle
		;//Anything that does not fit this filter will be given to the neutral player, so the template can have rocks and props.
		FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER
	End
End

;//------------------------------------------------------------------------------
;// These are the four corner buildplots.  Difference is just the BuildVariation flag they give the Expansion.
Object MordorFortressExpansionPadCorner

	SelectPortrait = BPMordorFortressBuildplot

	;// *** ART Parameters ***

	Draw = W3DFloorDraw DrawFloorBase
		ModelName = MBFoundation
	End

	Draw = W3DScriptedModelDraw ModuleTag_DrawMain
		DefaultModelConditionState
			Model = WBFoundationP
		End

		;//Remove the buildplot when it's been constructed on
		ModelConditionState = CONSTRUCTION_COMPLETE
			Model = None
		End
	End

	;//PlacementViewAngle  = 0

	;// ***DESIGN parameters ***
	DisplayName         = OBJECT:MordorBuildingFoundation
	Side                = Mordor
	EditorSorting       = STRUCTURE
	ThreatLevel			= 1.0

	BuildCost           = 1
	BuildTime           = 5.0          ;// in seconds
	VisionRange         = 0.0          ;// Shroud clearing distance
	ShroudClearingRange = 0

	CommandSet			= MordorFortressExpansionPadCornerCommandSet

	;// *** AUDIO Parameters ***

	VoiceSelect			= Gui_PlotSelect2

	;// *** ENGINEERING Parameters ***
	KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION UNATTACKABLE MP_COUNT_FOR_VICTORY NO_COLLIDE DO_NOT_CLASSIFY EXPANSION_PAD

	Behavior		= FoundationAIUpdate ModuleTag_foundationAI
		BuildVariation	= 2 ;// Will give BUILD_VARIATION_TWO to anything built on it
	End

	Behavior = CastleMemberBehavior ModuleTag_CMB
	End

	Body                = ImmortalBody ModuleTag_05
		MaxHealth         = 15000.0
	End

	Geometry				= BOX
	GeometryMajorRadius		= 5.0
	GeometryMinorRadius		= 5.0
	GeometryHeight			= 0.8
	GeometryIsSmall			= No
	Shadow					= SHADOW_VOLUME
	BuildCompletion			= PLACED_BY_PLAYER
End

;//------------------------------------------------------------------------------
;//Mordor Fortress Citadel
;//This is the center part of the full Fortress.  This plus the buildplots make up the full fortress
Object MordorFortressCitadel

	SelectPortrait = BPMordorFortressNew

	Draw = W3DScriptedModelDraw ModuleTag_Draw
		ExtraPublicBone 		= ARROW_01
		ExtraPublicBone 		= ARROW_02
		ExtraPublicBone 		= ARROW_03
		ExtraPublicBone 		= ARROW_04
		ExtraPublicBone 		= ARROW_05
		ExtraPublicBone 		= ARROW_06
		ExtraPublicBone 		= ARROW_07

		OkToChangeModelColor	= Yes
		UseStandardModelNames	= Yes
		StaticModelLODMode		= Yes // Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model				= tg_dragonstone ;mbNfort_skn
	  	ParticleSysBone   	= TORCH01 OrcBarracksTorchSmoke FollowBone:Yes
			ParticleSysBone   	= TORCH01 OrcBarracksTorchFireNoSmoke FollowBone:Yes
			ParticleSysBone   	= TORCH02 OrcBarracksTorchSmoke FollowBone:Yes
			ParticleSysBone   	= TORCH02 OrcBarracksTorchFireNoSmoke FollowBone:Yes
			; ParticleSysBone   	= TORCH03 OrcBarracksTorchSmoke FollowBone:Yes
			; ParticleSysBone   	= TORCH03 OrcBarracksTorchFireNoSmoke FollowBone:Yes
			; ParticleSysBone   	= TORCH04 OrcBarracksTorchSmoke FollowBone:Yes
			; ParticleSysBone   	= TORCH04 OrcBarracksTorchFireNoSmoke FollowBone:Yes
			; ParticleSysBone   	= TORCH05 OrcBarracksTorchSmoke FollowBone:Yes
			; ParticleSysBone   	= TORCH05 OrcBarracksTorchFireNoSmoke FollowBone:Yes
			; ParticleSysBone   	= TORCH06 OrcBarracksTorchSmoke FollowBone:Yes
			; ParticleSysBone   	= TORCH06 OrcBarracksTorchFireNoSmoke FollowBone:Yes
			; ParticleSysBone   	= TORCH07 OrcBarracksTorchSmoke FollowBone:Yes
			; ParticleSysBone   	= TORCH07 OrcBarracksTorchFireNoSmoke FollowBone:Yes
			WeaponLaunchBone	= PRIMARY ARROW_
			WeaponLaunchBone	= SECONDARY EYEBONE02
		End

		; ModelConditionState = USER_2
			; FXEvent	= Name: FX_MorgulSpireSound
			; ParticleSysBone  = NONE MorgulBeaconBeam FollowBone:Yes
			; ParticleSysBone  = EYEBONE GorSpireCharge FollowBone:Yes
			; ParticleSysBone  = EYEBONE GorSpireCharge02 FollowBone:Yes
			; ParticleSysBone  = EYEBONE GorSpireCharge03 FollowBone:Yes
		; End

		;//	Animation state for build placement cursor
		AnimationState = BUILD_PLACEMENT_CURSOR
			BeginScript
				CurDrawableHideSubObject("MORGULGLOW")
				CurDrawableHideSubObject("LAVAMOATA")
				CurDrawableHideSubObject("LAVAMOATB")
				CurDrawableHideSubObject("LAVAMOATC")
				CurDrawableHideSubObject("MORGULTOWER")
				CurDrawableHideSubObject("TOWERGLOW")
				CurDrawableHideSubObject("STACKSA")
				CurDrawableHideSubObject("STACKSB")
				CurDrawableHideSubObject("BANNERS")
			EndScript
		End

		;//	Animation state for phantom structure
		AnimationState = PHANTOM_STRUCTURE
			BeginScript
				CurDrawableHideSubObject("MORGULGLOW")
				CurDrawableHideSubObject("LAVAMOATA")
				CurDrawableHideSubObject("LAVAMOATB")
				CurDrawableHideSubObject("LAVAMOATC")
				CurDrawableHideSubObject("MORGULTOWER")
				CurDrawableHideSubObject("TOWERGLOW")
				CurDrawableHideSubObject("STACKSA")
				CurDrawableHideSubObject("STACKSB")
				CurDrawableHideSubObject("BANNERS")
			EndScript
		End

		ModelConditionState = DAMAGED
			Model		= tg_dragonstone ;mbNfort_d1
			;Texture		= MBFortress.tga MBFortress_D.tga
		End

		AnimationState	= DAMAGED
			EnteringStateFX	= FX_FortressDamaged
		End

		ModelConditionState = REALLYDAMAGED
			Model		= tg_dragonstone ;mbNfort_d2
		End

		AnimationState	= REALLYDAMAGED
			EnteringStateFX	= FX_FortressReallyDamaged
		End

		ModelConditionState = RUBBLE
			Model		= tg_dragonstone ;mbNfort_d2
		End

		AnimationState	= RUBBLE
			EnteringStateFX	= FX_FortressCollapse
		End

		ModelConditionState = SNOW
			Model	  = tg_dragonstone ;mbNfort_skn
			Texture	= mbNfortress.tga mbNfortress_snow.tga
			Texture	= mbNfortressbnrs.tga mbNfortressbnrs_snow.tga
		End

		ModelConditionState = FORTRESS_IMPROVEMENT_2
			Model 					= tg_dragonstone ;mbNfort_skn
			ParticleSysBone = SMOKEFX01 GorgorothFoundrySmoke FollowBone:Yes
			ParticleSysBone = SMOKEFX02 GorgorothFoundrySmoke FollowBone:Yes
			ParticleSysBone = SMOKEFX03 GorgorothFoundrySmoke FollowBone:Yes
			ParticleSysBone = SMOKEFX01 GorgorothFoundrySmokeStack FollowBone:Yes
			ParticleSysBone = SMOKEFX02 GorgorothFoundrySmokeStack FollowBone:Yes
			ParticleSysBone = SMOKEFX03 GorgorothFoundrySmokeStack FollowBone:Yes
			ParticleSysBone = SMOKEFX01 GorgorothFoundrySparks FollowBone:Yes
			ParticleSysBone = SMOKEFX02 GorgorothFoundrySparks FollowBone:Yes
			ParticleSysBone = STACKBONE03 GorgorothFoundrySparks FollowBone:Yes
		End
	End

	//MP Banner
	;Draw = W3DScriptedModelDraw ModuleTag_Draw_HCBanner
	;	OkToChangeModelColor  = Yes
	;	DefaultModelConditionState
	;		Model = MBHCFortress
	;	End
	;	MultiPlayerOnly = Yes
	;End

	;//Fire Arrows
	Draw = W3DScriptedModelDraw ModuleTag_DrawFireArrows
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes // Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model	= None
		End

		IdleAnimationState
			StateName = NoTower
		End
	End

	;//Fortress Door
	Draw = W3DScriptedModelDraw ModuleTag_DrawDoor

		DefaultModelConditionState
			Model = mbNfortG_skn
		End

		//--normal states
		ModelConditionState   = DOOR_1_OPENING
			Model               = mbNfortG_skn
		End

		AnimationState			=	DOOR_1_OPENING
			Animation           =	DBFDoor_DRO
				AnimationName   =	mbNfortG_skn.mbNfortG_skn
				AnimationMode   =	ONCE
				AnimationBlendTime = 0
			End
		End

		ModelConditionState   = DOOR_1_CLOSING
			Model               = mbNfortG_skn
				ParticleSysBone	  = NONE trollCageDust
			End;

   			AnimationState			=	DOOR_1_CLOSING
				Animation           =	mbNfortG_skn
					AnimationName   =	mbNfortG_skn.mbNfortG_skn
					AnimationMode   =	ONCE_BACKWARDS
					AnimationBlendTime = 0
				End
				Flags = START_FRAME_LAST
		End

		ModelConditionState   = DOOR_1_WAITING_OPEN
			Model               = mbNfortG_open
		End

		AnimationState			=	DOOR_1_WAITING_OPEN
			Animation           =	dbfrtdoor_open
				AnimationName   =  none
				AnimationMode   =	ONCE
				AnimationBlendTime = 0
			End
		End

		ModelConditionState  = POST_RUBBLE
			Model         = None
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
	End

	//----------the Bib
	Draw = W3DFloorDraw ModuleTag_DrawFloor
		ModelName		= mbNfort_bib
		WeatherTexture SNOWY mbNfortress_bib_snow.tga
	End

	PlacementViewAngle = -45

	;// ***DESIGN parameters ***
	DisplayName	= OBJECT:MordorFortress
	Description = OBJECT:MordorFortressDescription

	Side              = Mordor
	EditorSorting     = STRUCTURE
	ThreatLevel				= 1.0
	CommandPointBonus	= GENERIC_FORTRESS_COMMAND_POINT_BONUS

	MaxSimultaneousOfType = 1

	CommandSet = DragonstoneFortressCommandSet

	Behavior = CommandSetUpgrade ModueTag_WOTRCommandSet
		TriggeredBy			= Upgrade_WOTRMode
		CommandSet			= MordorFortressCommandSet_WOTR
	End

	Behavior = AudioLoopUpgrade ModuleTag_AudioLoopUpgrade
		TriggeredBy = Upgrade_MordorFortressMorgulSorcery
		KillOnDeath = Yes
	End

	BuildCost           = 5000
	BuildTime           = MORDOR_FORTRESS_BUILDTIME
	BountyValue         = MORDOR_FORTRESS_BOUNTY_VALUE
	VisionRange         = MORDOR_FORTRESS_VISION_RANGE
	ShroudClearingRange = MORDOR_FORTRESS_SHROUD_CLEAR

	WeaponSet
		Weapon						= PRIMARY MordorFortressArrowTowerBow
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	ArmorSet
		Conditions = None
		Armor      = FortressArmor
		;DamageFX          = StructureDamageFXNoShake
	End

	ArmorSet
		Conditions = PLAYER_UPGRADE
		Armor      = FortressArmor_WithMoat
		;DamageFX          = StructureDamageFXNoShake
	End

	;// *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	EvaEventDieOwner = EvaFortressDie
	EvaEventDieAlly  = AllyCampDestroyed
	EvaEventDieEnemy = EnemyCampDestroyed

	VoiceSelect									 = MordorFortressSelect
	VoiceSelectUnderConstruction = BuildingEvilVoiceSelectUnderConstruction

	SoundOnDamaged			 = BuildingLightDamageStone
	SoundOnReallyDamaged = BuildingHeavyDamageStone

	UnitSpecificSounds
		UnderConstruction			= BuildingBigConstructionLoop  	;// Built first time
		UnderRepairFromRubble	= BuildingBigConstructionLoop		;// Repaired from completely destroyed (not used???)
	End

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
		AnimationSound 		= Sound:UpgradeMordorFortressGorgonothSpire	Animation:MBFEWEye_ASKL.MBFEWEye_ABLD	Frames:980
	End

	CampnessValue = CAMPNESS_FORTRESS

	;// *** ENGINEERING Parameters ***
	RadarPriority = STRUCTURE
	KindOf        = PRELOAD COMMANDCENTER VITAL_FOR_BASE_SURVIVAL STRUCTURE IMMOBILE CASTLE_KEEP MP_COUNT_FOR_VICTORY SELECTABLE FS_FACTORY AUTO_RALLYPOINT MADE_OF_WOOD SCORE DOZER_FACTORY

	Behavior = GettingBuiltBehavior GetBuiltBehaviorTag
		WorkerName = MordorFortressWorkerNoSelect
		SpawnTimer = DEFAULT_STRUCTURE_HEALDELAY
	End

	Behavior = CastleMemberBehavior ModuleTag_CMB
	End

	Body = StructureBody ModuleTag_05
		MaxHealth         		 = MORDOR_FORTRESS_HEALTH
		MaxHealthDamaged  		 = MORDOR_FORTRESS_HEALTH_DAMAGED
		MaxHealthReallyDamaged = MORDOR_FORTRESS_HEALTH_REALLY_DAMAGED
	End

	Behavior = StructureCollapseUpdate ModuleTag_06
		MinCollapseDelay      = 000
		MaxCollapseDelay      = 000
		CollapseDamping       = .5
		MaxShudder            = 0.6
		MinBurstDelay         = 250
		MaxBurstDelay         = 800
		BigBurstFrequency     = 4
		FXList                = INITIAL   FX_FortressCollapse
		DestroyObjectWhenDone	= Yes
		CollapseHeight				= 120
	End

	Behavior = ProductionUpdate ProductionUpdateModuleTag
		//Porter cost bonus
		ProductionModifier		;// An object-local discount.
			RequiredUpgrade	= Upgrade_MordorFortressDoomPyres
			CostMultiplier	= 0.80
			ModifierFilter	= NONE +MordorPorter
		End
		//Hero cost/build time bonus
		ProductionModifier
			RequiredUpgrade = Upgrade_MordorFortressDoomPyres
			CostMultiplier	= 0.90
			TimeMultiplier	= 0.90
			HeroPurchase		= Yes	// Instead of an object filter, needs to be explicitly hero-revival-system compatible
		End
		NumDoorAnimations = 1
		DoorOpeningTime   = 3000  ;in mSeconds how long you want doors to be in open state
		DoorWaitOpenTime  = 3000  ;in mSeconds time the door stays open, so units can exit
		DoorCloseTime     = 3000  ;in mSeconds how long you want doors to be in open state
	End

	;/////////////////////////////
	;/// AI FORTRESS MODIFIERS
	;///
	#include "..\..\..\Includes\AIFortressFunctions.inc"
	;///

	Behavior = CostModifierUpgrade ModuleTag_AIRingHeroDiscount
		LabelForPalantirString = GUI:Blank
		StartsActive 					 = No
		TriggeredBy 					 = Upgrade_ObjectUnderAIControl
		ObjectFilter					 = NONE +TargaryenDrogon +TargaryenRhaegal +TargaryenViserion
		Percentage						 = -50%
	End

	Behavior = QueueProductionExitUpdate QueueProductionModuleTag
		UnitCreatePoint		= X:46.0 Y:0.0 Z:0.0
		NaturalRallyPoint	= X:159.0 Y:0.0 Z:0.0
		ExitDelay					= 200
	End

	Behavior = AIUpdateInterface ModuleTag_AI
		AILuaEventsList						 = DragonstoneFortressFunctions
		AutoAcquireEnemiesWhenIdle = Yes
		MoodAttackCheckRate				 = 250
	End

	;//////
	;// LATEGAME TRIGGER
	;//////

	Behavior = ObjectCreationUpgrade ModuleTag_AILateGameTriggerEnablerHard
		TriggeredBy 				= Upgrade_MordorFaction Upgrade_HardAIMultiPlayer
		ThingToSpawn 				= LateGameUpgradeGranter
		RequiresAllTriggers = Yes
		Delay							  = 780000
	End

	Behavior = ObjectCreationUpgrade ModuleTag_AILateGameTriggerEnablerBrutal
		TriggeredBy 				= Upgrade_MordorFaction Upgrade_BrutalAIMultiPlayer
		ThingToSpawn 				= LateGameUpgradeGranter
		RequiresAllTriggers = Yes
		Delay 							= 780000
	End

	;//////

	Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
		PassengerFilter							 = ANY +INFANTRY +CAVALRY +MordorWorker AOTR_COMBO_HORDES_POS -HERO -DOZER -SUMMONED -MordorVanguardHorde_WOTR
		ObjectStatusOfContained			 = UNSELECTABLE ENCLOSED
		CashBackPercent							 = 200%
		ContainMax									 = 99
		AllowEnemiesInside					 = No
		AllowAlliesInside						 = No
 		AllowNeutralInside					 = No
 		AllowOwnPlayerInsideOverride = Yes
		EnterSound									 = GUI_RingReturned
		EntryOffset									 = X:129.0 Y:0.0 Z:0.0
		EntryPosition								 = X:100.0 Y:0.0 Z:0.0		// entry position needs to be offset from the root transform, otherwise fortress obscures point.

		ExitOffset									= X:129.0 Y:0.0 Z:0.0
		StatusForRingEntry					= HOLDING_THE_RING
		UpgradeForRingEntry					= Upgrade_RingHero Upgrade_FortressRingHero
		ObjectToDestroyForRingEntry	= NONE +TheDroppedRing
		FXForRingEntry							= FX_OneRingFlare
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowMunitions
		TriggeredBy					 = Upgrade_EvilFortressFlamingMunitions
		AddConditionFlags		 = FORTRESS_IMPROVEMENT_1
		AddTempConditionFlag = ModelConditionState:USER_1 //For buildup
		TempConditionTime		 = 7.0						 						//try to match buildup anim time
		Permanent						 = Yes
	End

	Behavior = AudioLoopUpgrade ModuleTag_FlamingMunitionsBuildLoop
		;// Play a "build loop" while the FlamingMunitions build up
		TriggeredBy	= Upgrade_EvilFortressFlamingMunitions
		SoundToPlay	= BuildingConstructionLoop
		KillOnDeath = Yes
		KillAfterMS	= 4000
	End

	;//Morgul Sorcery Upgrade
	Behavior = CastleUpgrade ModuleTag_PassOutNumenorStoneworkUpgrade
		TriggeredBy	= Upgrade_MordorFortressMorgulSorceryTrigger
		Upgrade			= Upgrade_MordorFortressMorgulSorcery
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_MordorFortressMorgulSorcery
		AttributeModifier	= MorgulSorceryKeep_Bonus
	End

	Behavior = SubObjectsUpgrade ModuleTag_ShowGlow
		TriggeredBy		 = Upgrade_MordorFortressMorgulSorcery
		ShowSubObjects = LAVAMOATC ;MORGULGLOW
	End
 	
	//--------------------------------------------------------------------------
	//	Cosmetic Dragon
	//--------------------------------------------------------------------------
	Behavior = ObjectCreationUpgrade MakeTheIdleVultures
		TriggeredBy			= Upgrade_RingHero Upgrade_FortressRingHero ;Upgrade_MordorFortressFireArrowsTrigger
		Delay						= 32.0
		DestroyWhenSold = Yes
		ThingToSpawn		= IdleDragon
		Offset					= X:0 Y:0 Z:200
		FadeInTime			= 8000
		Angle						= 240
		RequiresAllTriggers = Yes
	End
	//--------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_HeadhunterEnabler
		SpecialPowerTemplate = SpecialAbilityMountFellbeast
		TriggeredBy          = Upgrade_MordorFortressFireArrowsTrigger
	End
	Behavior = SpecialPowerModule ModuleTag_HeadhunterStarter
		SpecialPowerTemplate       = SpecialAbilityMountFellbeast
		StartsPaused               = Yes
		UpdateModuleStartsAttack   = Yes
		RequirementsFilterMPSkirmish = ANY +MordorWitchKing
	End
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_Headhunter
		SpecialPowerTemplate       = SpecialAbilityMountFellbeast
		WhichSpecialWeapon         = 1
		SkipContinue               = Yes
		FreezeAfterTriggerDuration = 100 ; Hold AI for this long after we fire.
		UnpackTime                 = 700
		PreparationTime            = 1
		PackTime                   = 100
		Instant 									 = Yes
		AwardXPForTriggering       = 0
		StartAbilityRange          = 99999999 ;400
		SpecialWeapon              = MountFellbeastWeapon
	End

	;Behavior = AttributeModifierAuraUpdate ModuleTag_MorgulSpireNa
	;	StartsActive		= No
	;	BonusName			= NazgulFellbeastEnabler
	;	TriggeredBy			= Upgrade_MordorFortressFireArrowsTrigger
	;	RefreshDelay		= 2000
	;	Range				= 9999999
	;	ObjectFilter		= NONE +MordorUvatha +MordorUvatha_WOTR +MordorAkhorahil +MordorAkhorahil_WOTR +MordorAkhorahilMounted +MordorUvathaMounted +AkhorahilFellBeast +UvathaFellBeast ALLIES SAME_PLAYER
	;End

	;-----------------------------------------------------------------------------
	;	Morgul Spire
	;-----------------------------------------------------------------------------
	Behavior = SubObjectsUpgrade ModuleTag_ShowSpire
		TriggeredBy			= Upgrade_MordorFortressGorgorothSpire
		ShowSubObjects		= MORGULTOWER TOWERGLOW
		HideSubObjects		= TOWER
	End
	Behavior = AttributeModifierAuraUpdate ModuleTag_MorgulSpireNazgulBuff
		StartsActive		= No
		BonusName			= MorgulSpireNazgulBuff
		TriggeredBy			= Upgrade_MordorFortressGorgorothSpire
		RefreshDelay		= 2000
		Range				= 999999
		ObjectFilter		= NONE +GuldurRingwraith +MordorRingwraith_Summoned +MordorUvatha +MordorUvatha_WOTR +MordorAkhorahil +MordorAkhorahil_WOTR +MordorAkhorahilMounted +MordorUvathaMounted +MordorKhamul +MordorKhamul_WOTR +MordorKhamulMounted +GuldurKhamul +GuldurKhamulMounted +GuldurKhamul_WOTR +MordorWitchKing +MordorWitchKing_WOTR +MordorAkhorahilFellBeast +MordorUvathaFellBeast +MordorWitchKingOnFellBeastUpgrade SAME_PLAYER
	End
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_MorgulSpireEnabler
		SpecialPowerTemplate = SpecialAbilityMordorFortressMorgulSpire
		TriggeredBy = Upgrade_MordorFortressGorgorothSpire
	End
	Behavior = SpecialPowerModule ModuleTag_MorgulSpire
		SpecialPowerTemplate      = SpecialAbilityMordorFortressMorgulSpire
		UpdateModuleStartsAttack  = No
		StartsPaused 			  = Yes
		AttributeModifier 		  = MordorFortressMorgulSpireOrcs
		AttributeModifierRange    = 999999
		AttributeModifierAffectsSelf = Yes
		AttributeModifierAffects = NONE +MordorBlackOrc +MordorBlackOrcHorde +MordorMorgulOrcPike +MordorMorgulOrcPikeHorde +MordorMorgulOrc +MordorMorgulOrcHorde +MordorFighter +MordorFighterHorde +MordorArcher +MordorArcherHorde +MordorPikeman +MordorPikemanHorde SAME_PLAYER
		;AttributeModifierFX = 	FX_MorgulSpireSound
		TriggerFX = FX_MorgulBeacon
		; SetModelCondition			= ModelConditionState:USER_2
		; SetModelConditionTime		= 20.0
	End
	;-----------------------------------------------------------------------------

;----------------------------------------------------------------------------------
; Adding aura behavior to pass out flaming munitions to summonded barricade
;;.;;
	Behavior = AttributeModifierAuraUpdate ModuleTag_TrollCageUpgrade
		StartsActive			= No ;If no, requires upgrade to turn on.
		BonusName			= MorgulSorceryTrollhandout
		TriggeredBy			= Upgrade_MordorFortressMorgulSorceryTrigger 
		RefreshDelay			= 2000
		Range				= 99999 ; MORDOR_FORTRESS_WALL_EFFECTIVE_RADIUS ;;,;; 99999
		ObjectFilter			= ANY +MordorTrollCage +MordorTrollCageFoundation
	End

;----------------------------------------------------------------------------------

#include "..\..\..\aicoding\airetreatbeacons.inc"

	;//Doom Pyres
	// Banners improvement, the half that gives an aura bonus, not the purchase discount part (that is in the ProductionUpdate)
	Behavior = AttributeModifierAuraUpdate ModuleTag_BannerLeadership
		StartsActive	= No ;If no, requires upgrade to turn on.
		BonusName		= MordorDoomPyresLeadership
		TriggeredBy		= Upgrade_MordorFortressDoomPyres
		RefreshDelay	= 2000
		Range			= 300
		ObjectFilter	= AOTR_GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
	End
	//Hide the pyres at the start
	Behavior = SubObjectsUpgrade ModuleTag_HidePyres
		TriggeredBy			= Upgrade_StructureLevel1
		HideSubObjects		= BANNERS MORGULGLOW MORGULTOWER TOWERGLOW STACKSA STACKSB LAVAMOATA LAVAMOATB LAVAMOATC
	End

	//Show them after we've purchased the upgrade
	Behavior = SubObjectsUpgrade ModuleTag_ShowPyres
		TriggeredBy			= Upgrade_MordorFortressDoomPyres
		ShowSubObjects		= BANNERS
	End

	;//Magma Cauldrons
	Behavior = ModelConditionUpgrade ModuleTag_Veterancy_Particles
 			TriggeredBy		= Upgrade_MordorFortressMagmaCauldrons
		AddConditionFlags		= FORTRESS_IMPROVEMENT_2
		Permanent			= Yes
	End
	Behavior = SubObjectsUpgrade ModuleTag_ShowCauldron
		TriggeredBy			= Upgrade_MordorFortressMagmaCauldrons
		ShowSubObjects		= STACKSA STACKSB
	End

	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_CauldronsEnabler
		SpecialPowerTemplate	= SpecialAbilityMordorFortressMagmaCauldrons
		TriggeredBy				= Upgrade_MordorFortressMagmaCauldrons
	End
	Behavior = SpecialPowerModule ModuleTag_CauldronStarter
		SpecialPowerTemplate      = SpecialAbilityMordorFortressMagmaCauldrons
		UpdateModuleStartsAttack  = Yes
		StartsPaused		  	  = Yes
		;InitiateSound			= MordorFortressMagmaCauldronRelease		;this didn't work
	End
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_CauldronWeaponFireUpdate
		SpecialPowerTemplate    = SpecialAbilityMordorFortressMagmaCauldrons
		WhichSpecialWeapon		= 1

		UnpackTime              = 1000
		PackTime                = 1000
		;TriggerSound			= MordorFortressMagmaCauldronRelease		;this triggers too late
		SpecialWeapon			= MordorFortressNoxiousFumes
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowTheCauldrons
		TriggeredBy				= Upgrade_MordorFortressMagmaCauldrons
		AddConditionFlags		= FORTRESS_IMPROVEMENT_3
		AddTempConditionFlag	= ModelConditionState:USER_2 //For buildup
		TempConditionTime		= 7.0						 //try to matc
		Permanent				= Yes
	End

	Behavior = AudioLoopUpgrade ModuleTag_MagmaCauldronsBuildLoop
		;// Play a "build loop" while the Cauldrons build up
		TriggeredBy			= Upgrade_MordorFortressMagmaCauldrons
		;ConflictsWith		=
		SoundToPlay			= BuildingConstructionLoop
		KillOnDeath         = Yes
		KillAfterMS			= 5800
		;RequiresAllTriggers = Yes
	End

	Behavior = AutoAbilityBehavior ModuleTag_MagmaCauldronAutoAbility ;;,;; added for 2.0 (from 2.01 DC)
		SpecialAbility		= SpecialAbilityMordorFortressMagmaCauldrons
		MaxScanRange				= 200
		Query					= 1 ALL ENEMIES
	End


	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DrumsInTheDeep
		SpecialPowerTemplate	= SpecialAbilitySummonShelob
		TriggeredBy				= Upgrade_MordorFortressShelobTerror
	End

	Behavior = OCLSpecialPower ModuleTag_SummonDrumsInTheDeep
		SpecialPowerTemplate = SpecialAbilitySummonShelob
		OCL                  = OCL_SpawnMordorShelob
		TriggerFX			 = FX_SummonWildmen
		CreateLocation       = CREATE_AT_LOCATION
		StartsPaused		  	  = Yes
	End

	;//Gorgoroth Spire
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SpireEnabler
		SpecialPowerTemplate	= SpecialAbilityGorgorothSpireFireball
		TriggeredBy				= Upgrade_MordorFortressGorgorothSpire
	End

	Behavior = AudioLoopUpgrade ModuleTag_GorgorothSpireBuildLoop
		;// Play a "build loop" while the Spire builds up
		TriggeredBy			= Upgrade_MordorFortressGorgorothSpire
		;ConflictsWith		=
		SoundToPlay			= BuildingBigConstructionLoop
		KillOnDeath         = Yes
		KillAfterMS			= 5200 ;Should match the length of the build-up animation [Or a little shorter since sounds take a little while to die]
		;RequiresAllTriggers = Yes
	End

	Behavior = SpecialPowerModule ModuleTag_SpireStarter
		SpecialPowerTemplate      = SpecialAbilityGorgorothSpireFireball
		UpdateModuleStartsAttack  = Yes
		StartsPaused		  	  = Yes
		InitiateSound			= GorgorothSpireFireballBuildUpMS	;this plays when the Eye builds up power
	End
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_SpireWeaponFireUpdate
		SpecialPowerTemplate    = SpecialAbilityGorgorothSpireFireball
		WhichSpecialWeapon		= 2

		UnpackTime              = 3000
		PackTime                = 1500

		SpecialWeapon			= MordorGorgorothSpireWeapon
		TriggerSound			= GorgorothSpireFireballLaunchMS	;this plays when Fireball launches
	End

	Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityLightningBehavior
		SpecialAbility				= SpecialAbilityGorgorothSpireFireball				// Use this ability
		Query			= 30 ANY ENEMIES +INFANTRY +CAVALRY +STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL ;;,;;
		Query			= 3 ANY ENEMIES +STRUCTURE -WALL_UPGRADE -WALL_HUB -WALL_SEGMENT -DEFENSIVE_WALL ;;,;;
		MaxScanRange	= MORDOR_GORGOROTHSPIRE_ROCK_RANGE ;;,;;
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowTheSpire
		TriggeredBy				= Upgrade_MordorFortressGorgorothSpire
		AddConditionFlags		= UPGRADE_FORTRESS_MONUMENT
		AddTempConditionFlag	= ModelConditionState:USER_3 //For buildup
		TempConditionTime		= 9.0						 //try to match buildup anim time
		Permanent				= Yes
	End

	Behavior = GeometryUpgrade TowerGeom
		TriggeredBy	 = Upgrade_MordorFortressGorgorothSpire
		ShowGeometry = HighTowerGeom
	End

	Behavior = SubObjectsUpgrade ModuleTag_ShowMoat
		TriggeredBy		 = Upgrade_MordorFortressLavaMoat
		ShowSubObjects = LAVAMOATA LAVAMOATB ;LAVAMOATC
	End

 	Behavior = ArmorUpgrade ModuleTag_ArmorUpgrade
		TriggeredBy  = Upgrade_MordorFortressLavaMoat
		ArmorSetFlag = PLAYER_UPGRADE
	End
	
	Behavior = FireWeaponUpdate ModuleTag_WeaponFiring
		FireWeaponNugget
			WeaponName = MordorMoatBasicWeapon
			Offset 		 = X:0 Y:0 Z:0
			FireDelay  = 0
			OneShot 	 = No
		End
	End

	; Behavior = ObjectCreationUpgrade CreateTheCP
		; TriggeredBy		= Upgrade_StructureLevel1
		; Delay			= 0.0
		; ThingToSpawn	= CommandPointSpawn
		; FadeInTime		= 20
	; End
	//--------------------------------------------------------------------------
	//	GAME OF THRONES SUBMOD
	//--------------------------------------------------------------------------
	Behavior = CommandSetUpgrade ModuleTag_GendryKingsBloodPowerCommandSet
		TriggeredBy	= Upgrade_BaratheonKingsBloodPowerTrigger
		CommandSet	= DragonstoneFortressCommandSet_BastardGendry
	End

	Behavior = CommandSetUpgrade ModuleTag_GendryLawfulSonCommandSet
		TriggeredBy	= Upgrade_BaratheonLawfulSonTrigger
		CommandSet	= DragonstoneFortressCommandSet_LordGendry
	End

	Behavior = RemoveUpgradeUpgrade ModuleTag_RemoveAssassinateRenly
		TriggeredBy			= Upgrade_BaratheonControlTheNarrowSeaTrigger
		UpgradeToRemove	= Upgrade_BaratheonShadowbinderAvailableIsTrue
	End

	Behavior = RemoveUpgradeUpgrade ModuleTag_RemoveControlTheNarrowSea
		TriggeredBy			= Upgrade_BaratheonShadowbinderTrigger
		UpgradeToRemove	= Upgrade_BaratheonControlTheNarrowSeaAvailableIsTrue
	End

	Behavior = RemoveUpgradeUpgrade ModuleTag_RemoveKingsBloodPower
		TriggeredBy			= Upgrade_BaratheonLawfulSonTrigger
		UpgradeToRemove	= Upgrade_BaratheonKingsBloodPowerAvailableIsTrue
	End

	Behavior = RemoveUpgradeUpgrade ModuleTag_RemoveLawfulSon
		TriggeredBy			= Upgrade_BaratheonKingsBloodPowerTrigger
		UpgradeToRemove	= Upgrade_BaratheonLawfulSonAvailableIsTrue
	End

	Behavior = RemoveUpgradeUpgrade ModuleTag_RemoveSacrificeShireen
		TriggeredBy			= Upgrade_BaratheonPrayHarderTrigger
		UpgradeToRemove	= Upgrade_BaratheonSacrificeShireenAvailableIsTrue
	End

	Behavior = RemoveUpgradeUpgrade ModuleTag_RemovePrayHarder
		TriggeredBy			= Upgrade_BaratheonSacrificeShireenTrigger
		UpgradeToRemove	= Upgrade_BaratheonPrayHarderAvailableIsTrue
	End
	//--------------------------------------------------------------------------
	//Money Maker
	Behavior = AutoDepositUpdate AutoDepositModuleTag
		DepositTiming       = GENERIC_KEEP_MONEY_TIME
		DepositAmount       = GENERIC_KEEP_MONEY_AMOUNT
		InitialCaptureBonus = 0  // no initial bonus
	End

	Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
		Radius				 = GENERIC_KEEP_MONEY_RANGE	// How far we try to claim ground
		MaxIncome			 = 0							// If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval = 999999					// How often (in msec) we give that much money
		HighPriority	 = Yes						// A high priority claim gets to pretend it was there first.
	End

	#include "..\..\..\FortressRingFunc.inc"

	#include "..\..\..\Includes\FortressEconomyBonusGrants.inc" ;;,;; Added for 2.1

	Behavior = AISpecialPowerUpdate MordorMagmacauldronAI ;;,;; added for 2.0
		CommandButtonName  = Command_FireWeaponMordorFortressMagmaCauldrons
		SpecialPowerAIType = AI_SPELLBOOK_ARMY_BREAKER
		SpecialPowerRadius = 200
	End

	Behavior = AISpecialPowerUpdate GorgorothspireAI ;;,;; added for 2.0
		CommandButtonName  = Command_SpecialAbilityMordorFortressMorgulSpire
		SpecialPowerAIType = AI_SPELLBOOK_ALWAYS_FIRE
	;	SpecialPowerRadius = MORDOR_GORGOROTHSPIRE_ROCK_RANGE ; 1000
	;	SpecialPowerRange  = 600 //NOTE!! Army Breaker uses this value as the minimum enemy threat that
					//this power can be used on
	End

	//Main
	Geometry						= CYLINDER
	GeometryName				= Geom_Orig
	GeometryMajorRadius	= 83.6
	GeometryHeight			= 55
	GeometryOffset			= X:-2.023 Y:0.082 Z:0

	
	AdditionalGeometry	= CYLINDER
	GeometryName				= Geom_V2
	GeometryMajorRadius	= 43.2
	GeometryHeight			= 81.8
	GeometryOffset			= X:-5.599 Y:0.043 Z:0

	AdditionalGeometry	= CYLINDER
	GeometryName				= Geom_V2
	GeometryMajorRadius	= 25.83
	GeometryHeight			= 180
	GeometryOffset			= X:3.08 Y:-3.404 Z:0

	AdditionalGeometry	= CYLINDER
	GeometryName				= Geom_V2
	GeometryMajorRadius	= 20.24
	GeometryHeight			= 192.333
	GeometryOffset			= X:2.176 Y:-1.741 Z:0

	AdditionalGeometry	= CYLINDER
	GeometryName				= Geom_V2
	GeometryMajorRadius	= 13.44
	GeometryHeight			= 152.615
	GeometryOffset			= X:-21.846 Y:-17.846 Z:0

	AdditionalGeometry	= CYLINDER
	GeometryName        = Geom_V2
	GeometryMajorRadius	= 9.63
 	GeometryHeight			= 112
	GeometryOffset			= X:7.692 Y:27.077 Z:0
	
	AdditionalGeometry	= CYLINDER
	GeometryName        = Geom_V2
	GeometryMajorRadius	= 12.45
 	GeometryHeight			= 102.921
	GeometryOffset			= X:20.377 Y:-49.043 Z:0
	
	AdditionalGeometry	= CYLINDER
	GeometryName        = Geom_V2
	GeometryMajorRadius	= 13.1
 	GeometryHeight			= 85
	GeometryOffset			= X:-62.025 Y:67.015 Z:0
	
	AdditionalGeometry	= CYLINDER
	GeometryName        = Geom_V2
	GeometryMajorRadius	= 12.51
 	GeometryHeight			= 67.4
	GeometryOffset			= X:-64.982 Y:-72.927 Z:0
	
	AdditionalGeometry	= CYLINDER
	GeometryName        = Geom_V2
	GeometryMajorRadius	= 12.73
 	GeometryHeight			= 78.15
	GeometryOffset			= X:82.118 Y:47.595 Z:0
	
	AdditionalGeometry	= CYLINDER
	GeometryName        = Geom_V2
	GeometryMajorRadius	= 14.22
 	GeometryHeight			= 75.218
	GeometryOffset			= X:83.9 Y:-46.48 Z:0
	
	AdditionalGeometry	= BOX
	GeometryName        = Geom_V2
	GeometryMajorRadius	= 10.7
 	GeometryMinorRadius	= 21.75
 	GeometryHeight			= 80.1
	GeometryOffset			= X:7.598 Y:-82.163 Z:0
	
	AdditionalGeometry	= BOX
	GeometryName        = Geom_V2
	GeometryMajorRadius	= 7.81
 	GeometryMinorRadius	= 25.14
 	GeometryHeight			= 55.26
	GeometryOffset			= X:10.398 Y:80.396 Z:0
	
	AdditionalGeometry	= BOX
	GeometryName        = Geom_V2
	GeometryMajorRadius	= 23.21
 	GeometryMinorRadius	= 8.08
 	GeometryHeight			= 67
	GeometryOffset			= X:-89.134 Y:0.795 Z:0

	GeometryIsSmall	= No
	Shadow					= SHADOW_VOLUME
	BuildCompletion	= PLACED_BY_PLAYER

	GeometryContactPoint = X:-58			Y:58			Z:0			Repair
	GeometryContactPoint = X:58				Y:-58			Z:0			Repair
	GeometryContactPoint = X:47.546		Y:36.435	Z:0
	GeometryContactPoint = X:-32.763	Y:-46.121	Z:0
	GeometryContactPoint = X:0				Y:0				Z:180		Swoop
End

//------------------------------------------------------------------------------
// Mordor Fortress
// This is the one object that you would place on a map and that the porter builds.
// It unpacks in to the citadel and the buildplots.  It is an old CampFlag.
Object MordorFortress

	SelectPortrait = BPMordorFortressNew

	Draw	= W3DScriptedModelDraw ModuleTag_01

		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model           = None
		End

		IdleAnimationState
		End

		//Need this since the default condition is none
		ModelConditionState = WORLD_BUILDER
			Model	= mbNfort_skn   ;MBFortress
		End

		//Phantom structure when placing a new building to be build
		ModelConditionState = BUILD_PLACEMENT_CURSOR
			Model	= None	//MBFortress
		End

		//Structure that stays where you will be building until the porter reaches the place to start building.
		ModelConditionState =  PHANTOM_STRUCTURE
			Model	= mbNfort_skn   ;MBFortress
		End

		;//	Animation state for build placement cursor
		AnimationState = BUILD_PLACEMENT_CURSOR
			BeginScript
   				CurDrawableHideSubObject("MORGULGLOW")
   				CurDrawableHideSubObject("LAVAMOATA")
   				CurDrawableHideSubObject("LAVAMOATB")
				CurDrawableHideSubObject("LAVAMOATC")
				CurDrawableHideSubObject("MORGULTOWER")
				CurDrawableHideSubObject("TOWERGLOW")
				CurDrawableHideSubObject("STACKSA")
				CurDrawableHideSubObject("STACKSB")
				CurDrawableHideSubObject("BANNERS")
			EndScript
		End

		;//	Animation state for phantom structure
		AnimationState = PHANTOM_STRUCTURE
			BeginScript
   				CurDrawableHideSubObject("MORGULGLOW")
   				CurDrawableHideSubObject("LAVAMOATA")
   				CurDrawableHideSubObject("LAVAMOATB")
				CurDrawableHideSubObject("LAVAMOATC")
				CurDrawableHideSubObject("MORGULTOWER")
				CurDrawableHideSubObject("TOWERGLOW")
				CurDrawableHideSubObject("STACKSA")
				CurDrawableHideSubObject("STACKSB")
				CurDrawableHideSubObject("BANNERS")
			EndScript
		End

		ModelConditionState = RUBBLE
			Model		= mbNfort_d2
		End

		AnimationState	= RUBBLE
;			Animation	= Fortress_Rubble
;				AnimationName		= MBFortress_D3S.MBFortress_D3A
;				AnimationMode		= ONCE
;			End
			EnteringStateFX	= FX_FortressCollapse
		End

		//-- building being constructed
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED SNOW
			Model               = mbNfort_bld
			Texture	= mbNfortress.tga mbNfortress_snow.tga
			Texture	= mbNfortressbnrs.tga mbNfortressbnrs_snow.tga
		End
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = mbNfort_bld
		End
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation           = mbNfort_bld
				AnimationName     = mbNfort_bld.mbNfort_bld
				AnimationMode     = MANUAL
			End
			ParticleSysBone   = NONE BuildingContructDustCastlesMordor
			ParticleSysBone   = NONE FortressMordor
			Flags				= START_FRAME_FIRST
			StateName			= BeingConstructed
			BeginScript
				CurDrawablePlaySound("GondorBarracksBeginConstruction")
			EndScript
		End
	End

  	ArmorSet
		Conditions        = None
  		Armor             = FortressArmor
  		//DamageFX          = StructureDamageFXNoShake
  	End

	ArmorSet
		Conditions        = PLAYER_UPGRADE
		Armor             = FortressArmor_WithMoat
		;DamageFX          = StructureDamageFXNoShake
	End

	Side                = Mordor
	EditorSorting       = STRUCTURE

	PlacementViewAngle = -45 // A -90 makes the door of the base face natural south.  0 would have it to the East.

	MaxSimultaneousOfType = 5 ;;,;; Added for 2.02e (T.C.)

	BuildCost           = 5000 ;MORDOR_FORTRESS_BUILDCOST
	BuildTime           = MORDOR_FORTRESS_BUILDTIME

	DisplayName			= OBJECT:MordorFortress

	;; AUDIO PARAMETERS

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceFullyCreated				= EVA:FortressComplete-Builder
	VoiceSelect						= MordorFortressSelect
    VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction

 	SoundOnDamaged					= BuildingLightDamageStone
 	SoundOnReallyDamaged			= BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction		= BuildingBigConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= BuildingBigConstructionLoop	; Repaired from completely destroyed (not used???)
    End

	; Just in case...
	ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
		ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
	End


	// *** AUTO RESOLVE DATA ***
	; When fighting an auto-resolve battle, a World Map castle actually becomes this unit
	AutoResolveUnitType = AutoResolveUnit_Fortress

    	AutoResolveBody = AutoResolve_MordorFortressBody

    	AutoResolveArmor
    		Armor = AutoResolve_MordorFortressArmor
    	End

    	AutoResolveWeapon
    		Weapon = AutoResolve_MordorFortressWeapon
    	End


	// *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION MP_COUNT_FOR_VICTORY BASE_SITE CAN_SEE_THROUGH_STRUCTURE LIVING_WORLD_BUILDING_MIRROR

	Body                        = StructureBody ModuleTag_05
		MaxHealth         		    = MORDOR_FORTRESS_HEALTH
	End

	Behavior = CastleBehavior ModuleTag_castle
		CastleToUnpackForFaction	= Mordor 		Fortress_Mordor
		CastleToUnpackForFaction	= Isengard 	Fortress_Mordor
		CastleToUnpackForFaction	= Men 			Fortress_Mordor
		CastleToUnpackForFaction	= Elves 		Fortress_Mordor
		CastleToUnpackForFaction	= Dwarves 	Fortress_Mordor
		CastleToUnpackForFaction	= Wild 			Fortress_Mordor
		CastleToUnpackForFaction	= Angmar 		Fortress_Mordor
		CastleToUnpackForFaction	= Arnor 		Fortress_Mordor
		CastleToUnpackForFaction	= Guldur 		Fortress_Mordor

		//Anything that does not fit this filter will be given to the neutral player, so the template can have rocks and props.
		FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER

		MaxCastleRadius 			= 130.0
		InstantUnpack				= Yes
		KeepDeathKillsEverything	= Yes

		EvaEnemyCastleSightedEvent = EnemyFortressSighted
	End

	Behavior                  = StructureCollapseUpdate ModuleTag_06
		MinCollapseDelay        = 000
		MaxCollapseDelay        = 000
		CollapseDamping         = .5
		MaxShudder              = 0.6
		MinBurstDelay           = 250
		MaxBurstDelay           = 800
		BigBurstFrequency       = 4
		FXList                  = INITIAL   FX_FortressCollapse
		;FXList                  = ALMOST_FINAL  FX_FortressCollapse
		DestroyObjectWhenDone	= Yes
		CollapseHeight			= 120
	End

	Behavior	= GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
		WorkerName	= MordorWorkerNoSelect
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
	End

	Behavior = AIUpdateInterface ModuleTag_AI
		AILuaEventsList				= FortressFunctions
	End


	//Main
	Geometry				= BOX
	GeometryName			= Geom_Orig
  	GeometryMajorRadius		= 65.0
	GeometryMinorRadius		= 65.0
	GeometryHeight			= 50.0
	GeometryOffset			= X:5 Y:0 Z:0

	//Plot locations
	AdditionalGeometry		= BOX
	GeometryName			= Plots
	GeometryMajorRadius		= 10.0
	GeometryMinorRadius		= 10.0
	GeometryHeight			= 0.8
	GeometryOffset			= X:91.15 Y:-81.15 Z:0

	AdditionalGeometry		= BOX
	GeometryName			= Plots
	GeometryMajorRadius		= 10.0
	GeometryMinorRadius		= 10.0
	GeometryHeight			= 0.8
	GeometryOffset			= X:0 Y:-114.48 Z:0

	AdditionalGeometry		= BOX
	GeometryName			= Plots
	GeometryMajorRadius		= 10.0
	GeometryMinorRadius		= 10.0
	GeometryHeight			= 0.8
	GeometryOffset			= X:-81.15 Y:-81.15 Z:0

	AdditionalGeometry		= BOX
	GeometryName			= Plots
	GeometryMajorRadius		= 10.0
	GeometryMinorRadius		= 10.0
	GeometryHeight			= 0.8
	GeometryOffset			= X:-114.48 Y:0 Z:0

	AdditionalGeometry		= BOX
	GeometryName			= Plots
	GeometryMajorRadius		= 10.0
	GeometryMinorRadius		= 10.0
	GeometryHeight			= 0.8
	GeometryOffset			= X:-81.15 Y:91.15 Z:0

	AdditionalGeometry		= BOX
	GeometryName			= Plots
	GeometryMajorRadius		= 10.0
	GeometryMinorRadius		= 10.0
	GeometryHeight			= 0.8
	GeometryOffset			= X:0 Y:114.48 Z:0

	AdditionalGeometry		= BOX
	GeometryName			= Plots
	GeometryMajorRadius		= 10.0
	GeometryMinorRadius		= 10.0
	GeometryHeight			= 0.8
	GeometryOffset			= X:91.15 Y:91.15 Z:0

	//Ramp (So units can attack it when the moat is in place)
	AdditionalGeometry		= BOX
	GeometryMajorRadius		= 26.0
 	GeometryMinorRadius		= 20.0
 	GeometryHeight			= 22.0
	GeometryOffset			= X:85 Y:0 Z:0

	GeometryIsSmall     	= No
	Shadow					= SHADOW_VOLUME

	GeometryContactPoint = X:-65	Y:65		Z:0			Repair
	GeometryContactPoint = X:65		Y:-65	Z:0			Repair
	GeometryContactPoint = X:47.546		Y:36.435	Z:0
	GeometryContactPoint = X:-32.763	Y:-46.121	Z:0
	GeometryContactPoint = X:26.753		Y:26.753	Z:67.933	Swoop
End

//------------------------------------------------------------------------------
// Mordor Fortress Lava Moat
// This is the moat around the fortress.  This is a separate object so that it can
// prevent units from being able to attack the fortress except at the ramp.
Object MordorFortressLavaMoat

	Draw	= W3DScriptedModelDraw ModuleTag_01
		OkToChangeModelColor	= Yes

		DefaultModelConditionState
			Model           = MBFLavaMoat
		End
	End

	ArmorSet
		Conditions        = None
  		Armor             = NoArmor
  		//DamageFX          = StructureDamageFXNoShake
  	End

	Side                = Mordor
	EditorSorting       = STRUCTURE
	BuildTime			= 10.0

    ;;; AUDIO PARAMETERS
	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"
	CampnessValue = 0

	// *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = STRUCTURE IMMOBILE NOT_AUTOACQUIRABLE UNATTACKABLE BASE_SITE CAN_SEE_THROUGH_STRUCTURE

	Body = HighlanderBody ModuleTag_02 //Can take damage, but won't die.  Can only die from ::kill() or other unresistable damage
		MaxHealth      = 1.0
	End

	Behavior = SlavedUpdate ModuleTag_Slave
		DieOnMastersDeath = Yes
	End

	//Main
	;Geometry              	= BOX
	;GeometryMajorRadius   	= 62
	;GeometryMinorRadius   	= 62
	;GeometryHeight      	= 10

	;GeometryIsSmall     	= No
	Shadow					= SHADOW_VOLUME
End
