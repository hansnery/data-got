;------------------------------------------------------------------------------
;Elven Mallorn Tree
Object ElvenMallornTree
	SelectPortrait = BPLorienMallornTree
  Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		StaticModelLODMode = yes
		UseStandardModelNames = Yes

		ExtraPublicBone	= ARCHER01

		DefaultModelConditionState
			Model = ebNmallorn0_skn  ;EBMalTree
			; ParticleSysBone     =  FireFlyBone FireFlies02 FollowBone:Yes
		    ;WeaponLaunchBone = PRIMARY ARCHER01
		End

		ModelConditionState = USER_28
			Model = ebNmallorn0_skn  ;EBMalTree
			WeaponLaunchBone = PRIMARY ARROW
			ParticleSysBone  = None TollKeepersAura Followbone:No
			ParticleSysBone  = None TollKeepersGold Followbone:No
			ParticleSysBone  = None TollKeepersGreen Followbone:No
		End

		ModelConditionState = USER_29
			Model = ebNmallorn0_skn  ;EBMalTree
			WeaponLaunchBone = PRIMARY ARROW
			ParticleSysBone  = None CursedTreasureAura Followbone:No
			ParticleSysBone  = None CursedTreasureGold Followbone:No
			ParticleSysBone  = None CursedTreasureGreen Followbone:No
		End

	ModelConditionState				= BUILD_PLACEMENT_CURSOR
		Shadow						= SHADOW_ALPHA_DECAL
		ShadowTexture				= decal_hero_good
		ShadowSizeX					= 385 ;ELVEN_STATUE_AOE_RADIUS_DECAL
		ShadowSizeY					= 385 ;ELVEN_STATUE_AOE_RADIUS_DECAL
		ShadowOverrideLODVisibility = Yes
	End
	;//	Animation state for build placement cursor
	AnimationState = BUILD_PLACEMENT_CURSOR
		BeginScript
			CurDrawableHideSubObject("N_Window")
			CurDrawableHideSubObject("N_Glow")
   			CurDrawableHideSubObject("V1")
   			CurDrawableHideSubObject("V1a")
			CurDrawableHideSubObject("V2")
			CurDrawableHideSubObject("V2a")
		EndScript
	End
	;//	Animation state for phantom structure
	AnimationState = PHANTOM_STRUCTURE
		BeginScript
			CurDrawableHideSubObject("N_Window")
			CurDrawableHideSubObject("N_Glow")
   			CurDrawableHideSubObject("V1")
   			CurDrawableHideSubObject("V1a")
			CurDrawableHideSubObject("V2")
			CurDrawableHideSubObject("V2a")
		EndScript
	End
    IdleAnimationState
		ParticleSysBone = NONE LorienFallingLeaves
		ParticleSysBone = NONE FireFliesLorien
	End
    ;------------ Build Up States -------
    ModelConditionState = SNOW AWAITING_CONSTRUCTION
		Model	= ebNmallorn0_bld  ;EBMalTree_ASKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
	End
    ModelConditionState   = AWAITING_CONSTRUCTION
      Model               = ebNmallorn0_bldEBMalTree_ASKN
;		ParticleSysBone	  = NONE BuildingDoughnutCloud
    End
    AnimationState        = AWAITING_CONSTRUCTION
      Animation           =  ebNmallorn0_bld  ;EBMalTree_A
        AnimationName     =  ebNmallorn0_bld.ebNmallorn0_bld  ;EBMalTree_ASKL.EBMalTree_ABLD
        AnimationMode     = MANUAL
        AnimationBlendTime = 0
      End
	  Flags				  = START_FRAME_FIRST
    End
	ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Model	= ebNmallorn0_bld   ;EBMalTree_ASKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		ParticleSysBone = NONE ExpLeavesLorien
	End
    ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
      Model               = ebNmallorn0_bld  ;EBMalTree_ASKN
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		ParticleSysBone = NONE ExpLeavesLorien
    End;
    AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Animation           = ebNmallorn0_bld  ;EBMalTree_A
			AnimationName     = ebNmallorn0_bld.ebNmallorn0_bld  ;EBMalTree_ASKL.EBMalTree_ABLD
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
		End
		Flags				  = START_FRAME_FIRST
		StateName				= BeingConstructed
		BeginScript
			CurDrawablePlaySound("GondorBarracksBeginConstruction")
			CurDrawablePlaySound("LothlorienConstructionSong")
			CurDrawablePlaySound("LothlorienConstruction")
		EndScript
    End
      ;--damaged building
		ModelConditionState     = DAMAGED
			Model               = ebNmallorn0_d1  ;EBMalTree_D1
		End
		AnimationState =	DAMAGED
			EnteringStateFX	= FX_StatueDamaged
			ParticleSysBone = NONE LorienBaseLeaves
			ParticleSysBone = NONE Maltreedust
		End
		ModelConditionState     = REALLYDAMAGED
			Model               = ebNmallorn0_d2  ;EBMalTree_D2
		End
    	AnimationState =	REALLYDAMAGED
    		Animation	= RubbleAnimation
				AnimationName		=	ebNmallorn0_d2.ebNmallorn0_d2  ;EBMalTree_D2SK.EBMalTree_D2AN
				AnimationMode		=	ONCE
	  		End
			EnteringStateFX	= FX_StatueDamaged
		End
		ModelConditionState  = RUBBLE
			Model         =  ebNmallorn0_d2    ;EBMalTree_D3
			ParticleSysBone SmokeLarge01 SmokeBuildingLarge
		End
		AnimationState = RUBBLE
			Animation	= RubbleAnimation
				AnimationName		=	ebNmallorn0_d2.ebNmallorn0_d2   ;EBMalTree_D3SK.EBMalTree_D3AN
				AnimationMode		=	ONCE
	  		End
	  		EnteringStateFX	= FX_StructureMediumCollapse
		End
		ModelConditionState  = POST_RUBBLE
			Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		ModelConditionState  = POST_COLLAPSE
			Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End

	    ModelConditionState = SNOW
			Model = ebNmallorn0_skn  ;EBMalTree
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
        End
  End

;  ; Draw module just for the hero FX.
	Draw = W3DScriptedModelDraw TheHealEffect
	    ModelConditionState  = NONE
			Model = None
	;		ParticleSysBone NONE StatueHeroFX
		End
	    ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED
			Model = None
		End
	End
  Draw = W3DFloorDraw ModuleTag_DrawFloor
		StaticModelLODMode = Yes		; THIS NEEDS TO BE COMMENTED OUT WHEN ENGINEERING ENABLES LOD'S IN THE FLOOR DRAW
     ModelName = ebNmallorn0_bib  ;EBMalTree_Bib
	WeatherTexture		= SNOWY ebNmallorn_bib_snow.tga ;eblothfort_bib_snow
  		HideIfModelConditions	=	AWAITING_CONSTRUCTION
  		HideIfModelConditions	=	PARTIALLY_CONSTRUCTED
  End
;  Draw = W3DScriptedModelDraw ModuleTag_Draw_HCBanner
;	OkToChangeModelColor  = Yes
;	DefaultModelConditionState
;		Model = EBHCMalTree
;	End
;	MultiPlayerOnly = Yes
;  End
	Draw = W3DScriptedModelDraw Draw_BonusEffects
	    DefaultModelConditionState
	      Model = None
	    End
	    AnimationState = ACTIVELY_BEING_CONSTRUCTED
	    End
		AnimationState = UPGRADE_ECONOMY_BONUS
			ParticleSysBone	= None FueltheFiresEmbers
		End
		AnimationState = USER_5 ;;,;; Added for 2.02e (T.C.) - Grand Harvest particle system
			ParticleSysBone	= None MirrorofGaladrielMallornSparkle
		End
		AnimationState = USER_5 UPGRADE_ECONOMY_BONUS ;;,;; Added for 2.02e (T.C.)
			ParticleSysBone	= None FueltheFiresEmbers
		End
		AnimationState = USER_4
			ParticleSysBone	= None StoneWorkerFX ; WellHealFX
		End
		AnimationState = USER_4 UPGRADE_ECONOMY_BONUS
			ParticleSysBone	= None FueltheFiresEmbers
		End
		AnimationState = USER_4 USER_5
			ParticleSysBone	= None FueltheFiresEmbers
		End
		AnimationState = USER_4 USER_5 UPGRADE_ECONOMY_BONUS
			ParticleSysBone	= None FueltheFiresEmbers
		End
	End
 PlacementViewAngle  = -45    ; PlacementViewAngle  = 45
  ; ***DESIGN parameters ***
  DisplayName			= OBJECT:ElvenMallornTree
  Description			= OBJECT:MallornTreeDescription
  Side					= Elves
  ;IsTrainable			= No
  EditorSorting			= STRUCTURE
  ThreatLevel			= 3.0 ; 1.0

  BuildCost           = 200 ;ELVEN_MALLORN_TREE_BUILDCOST
  BuildTime           = 10 ;ELVEN_MALLORN_TREE_BUILDTIME          ; in seconds
  VisionRange         = ELVEN_MALLORN_TREE_SHROUD_CLEAR          ; Shroud clearing distance
  ShroudClearingRange = ELVEN_MALLORN_TREE_SHROUD_CLEAR
  BountyValue         = 50
  CommandPointBonus	= 0 ; 25 ;GENERIC_ECONOMY_COMMAND_POINT_BONUS

  CommandSet = LorienMallornTreeCommandSet

  ArmorSet
    Conditions        = None
    Armor             = MallornTreeArmor ;ResourceArmor
    ;DamageFX         = StructureDamageFXNoShake
  End

   	WeaponSet
		Conditions			= None
	End

	WeaponSet
		Weapon				= PRIMARY ElvenBattleTowerBow
		Conditions			= PLAYER_UPGRADE
		AutoChooseSources		= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	Behavior = WeaponSetUpgrade ModuleTag_ThirdLevelBuildingArrows
			TriggeredBy		= Upgrade_StructureLevel3
	End

; For Testing Purposes


	; *** AUDIO Parameters ***
	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect		= ElfMallornTreeSelect				;GondorStatueSelect

	SoundOnDamaged		= BuildingLightDamageWood
	SoundOnReallyDamaged	= BuildingHeavyDamageWood

	VoiceSelectUnderConstruction	= LothlorienBuildingSelectUnderConstruction
	VoiceFullyCreated		= EVA:MallornBuildingComplete-Builder-Elf

	UnitSpecificSounds
		UnderConstruction	= LothlorienConstructionLoop  	; Built first time
		; UnderRepairFromDamage	= NoSound			; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= LothlorienConstructionLoop	; Repaired from completely destroyed (not used???)
	End

	EvaEventDamagedOwner		= MallornTreeUnderAttack ;UnderAttackResource

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
		AnimationSound = Sound:StatueHeroicBuildStoneExplode	Animation:RPHeroStat_A.RPHeroStat_A		Frames:620
		AnimationSound = Sound:StatueHeroicBuildStoneDebris1	Animation:RPHeroStat_A.RPHeroStat_A		Frames:635
		AnimationSound = Sound:StatueHeroicBuildStoneDebris2	Animation:RPHeroStat_A.RPHeroStat_A		Frames:650
	End

 	CampnessValue = CAMPNESS_RESOURCE_BUILDING

  ; *** ENGINEERING Parameters ***

	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION FS_CASH_PRODUCER MADE_OF_STONE IGNORE_FOR_VICTORY LIVING_WORLD_BUILDING_MIRROR AUTO_RALLYPOINT FS_FACTORY ECONOMY_STRUCTURE ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK ;COMMANDCENTER ;;,;; Added FS_CASH_PRODUCER

	Body                		= StructureBody ModuleTag_05
	  MaxHealth         		= 1800
	  MaxHealthDamaged        	= 1200
	  MaxHealthReallyDamaged  	= 600
	End

	Flammability   ; should be after the 'Body' statement
		Fuel          =   ELVEN_MALLORNTREE_FIRE_FUEL
		MaxBurnRate   =   ELVEN_MALLORNTREE_FIRE_MAX_BURN_RATE
		Decay         =   ELVEN_MALLORNTREE_FIRE_DECAY
		Resistance    =   ELVEN_MALLORNTREE_FIRE_RESISTANCE
    End

	Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
		DestructionDelay  = 5000
	End

	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
		AutoAcquireEnemiesWhenIdle	= Yes
		MoodAttackCheckRate			= 250
		AILuaEventsList				= MallornTreeFunctions ;MirkwoodShrineFunctions
	End

	Behavior            = GettingBuiltBehavior GetBuiltBehaviorTag
		WorkerName	= ElvenWorkerNoSelect_LorienSinger
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
	End

	Behavior = ProductionUpdate ProductionUpdateModuleTag
		GiveNoXP                       = Yes  ;disable granting xp when producing units.
		MaxQueueEntries = 1
	End

	Behavior = TerrainResourceBehavior ModuleTag_MoneyProduction
		Radius		= 240 ;ELVEN_MALLORN_TREE_MONEY_RANGE	; How far we try to claim ground
		MaxIncome	= 10 ;ELVEN_MALLORN_TREE_MONEY_AMOUNT	; If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval	= ELVEN_MALLORN_TREE_MONEY_TIME		; How often (in msec) we give that much money
	End

	ClientBehavior = TerrainResourceClientBehavior ModuleTag_MoneyProductionClient
	End

; ;-------------------------------------------------------------------------------------------------------------------

	Behavior = QueueProductionExitUpdate QueueProductionModuleTag
		UnitCreatePoint			= X:0.0 Y:0.0 Z:0.0
	;	PlacementViewAngle		= -45
		NaturalRallyPoint		= X:90.0 Y:0.0 Z:0.0
		ExitDelay				= STANDARD_HORDE_EXIT_DELAY
		UseReturnToFormation	= No
	End

	Behavior                  = StructureCollapseUpdate ModuleTag_Collapse
		MinCollapseDelay        = 000
		MaxCollapseDelay        = 000
		CollapseDamping         = .5
		MaxShudder              = 0.6
		MinBurstDelay           = 250
		MaxBurstDelay           = 800
		BigBurstFrequency       = 4
		FXList                  = INITIAL   FX_StructureMediumCollapse
		FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
		DestroyObjectWhenDone	= Yes
		CollapseHeight		= 126
	End

	Behavior = SubObjectsUpgrade ModuleTag_HideAll
		TriggeredBy		= Upgrade_StructureLevel1
		HideSubObjects		= V1 V1a V2 V2a
	End

Behavior = ReplaceSelfUpgrade ModuleTag_ReplaceWithBarracks
	TriggeredBy = Upgrade_MallornTreeBarracks; L00BE9600: List of Upgrades //Must have these upgrades
	RequiresAllTriggers = Yes; SUB_L006D3400:Boolean //All "TriggeredBy" Upgrades required! (meaning that if only one is present the module is not active)
	Permanent = Yes; SUB_L006D3400:Boolean //For ever... and ever... and ever, even if the upgrades are lost...
	ReplaceWith = ElvenBarracks
	;AndThenAddA = ObjectExtra; SUB_L006D34D0:Strings(Object)
End

Behavior = ReplaceSelfUpgrade ModuleTag_ReplaceWithPasture
	TriggeredBy = Upgrade_MallornTreePasture; L00BE9600: List of Upgrades //Must have these upgrades
	RequiresAllTriggers = Yes; SUB_L006D3400:Boolean //All "TriggeredBy" Upgrades required! (meaning that if only one is present the module is not active)
	Permanent = Yes; SUB_L006D3400:Boolean //For ever... and ever... and ever, even if the upgrades are lost...
	ReplaceWith = ElvenGreenPasture
	;AndThenAddA = ObjectExtra; SUB_L006D34D0:Strings(Object)
End

Behavior = ReplaceSelfUpgrade ModuleTag_ReplaceWithStorage
	TriggeredBy = Upgrade_MallornTreeStorage; L00BE9600: List of Upgrades //Must have these upgrades
	RequiresAllTriggers = Yes; SUB_L006D3400:Boolean //All "TriggeredBy" Upgrades required! (meaning that if only one is present the module is not active)
	Permanent = Yes; SUB_L006D3400:Boolean //For ever... and ever... and ever, even if the upgrades are lost...
	ReplaceWith = EregionForge
	;AndThenAddA = ObjectExtra; SUB_L006D34D0:Strings(Object)
End

 Behavior = ReplaceSelfUpgrade ModuleTag_ReplaceWithNiphredil
	 TriggeredBy = Upgrade_MallornTreeNiphredil; L00BE9600: List of Upgrades //Must have these upgrades
	 RequiresAllTriggers = Yes; SUB_L006D3400:Boolean //All "TriggeredBy" Upgrades required! (meaning that if only one is present the module is not active)
	 Permanent = Yes; SUB_L006D3400:Boolean //For ever... and ever... and ever, even if the upgrades are lost...
	 ReplaceWith = ElvenNiphredilMallornTree
	; ;AndThenAddA = ObjectExtra; SUB_L006D34D0:Strings(Object)
 End
;---Triggers an FX for when a structure is swapped in; can remove if not needed
Behavior = DoCommandUpgrade ModuleTag_MallornTreeFXTrigger
	TriggeredBy 				= Upgrade_MallornTreeBarracks Upgrade_MallornTreeStorage Upgrade_MallornTreePasture Upgrade_MallornTreeNiphredil
	GetUpgradeCommandButtonName = Command_SpecialAbilityMallornTreeFX
End

Behavior = SpecialPowerModule ModuleTag_MallornTreeFXStarter
	SpecialPowerTemplate		= SpecialAbilityMallornTreeReplaceFX
;	UpdateModuleStartsAttack	= Yes
	StartsPaused				= No
	;TriggerFX					= FX_WarlordTribalSummon
End

	;-----------------------------------------------------------------------------
	;	Cargast's Cursed Treasure
	;-----------------------------------------------------------------------------
    Behavior = ObjectCreationUpgrade ModuleTag_CursedTreasure1
		TriggeredBy = Upgrade_CursedTreasureActivated
		RemoveUpgrade = Upgrade_CursedTreasureDesactivated
    End
    Behavior = ObjectCreationUpgrade ModuleTag_CursedTreasure2
		TriggeredBy = Upgrade_CursedTreasureDesactivated
		RemoveUpgrade = Upgrade_CursedTreasureActivated
    End
	Behavior = AttributeModifierUpgrade ModuleTag_CursedTreasure3
		TriggeredBy = Upgrade_CursedTreasureActivated
		ConflictsWith = Upgrade_CursedTreasureDesactivated
		AttributeModifier = GuldurCursedTreasureProductionBuff
	End
	Behavior = AttributeModifierAuraUpdate ModuleTag_CursedTresureDebuff
		StartsActive	= No ;If no, requires upgrade to turn on.
		TriggeredBy		= Upgrade_CursedTreasureActivated
		BonusName		= GuldurCursedTreasureDebuff
		RefreshDelay	= 2000
		Range			= 300
		ObjectFilter	= AOTR_GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
	End
	;-----------------------------------------------------------------------------
	;-----------------------------------------------------------------------------
	;	Grimbeorn's Toll-Keepers
	;-----------------------------------------------------------------------------
	Behavior = OCLSpecialPower ModuleTag_SummonTreasureChest
		SpecialPowerTemplate = SpecialAbilityTollKeepersSummon
		OCL                  = OCL_TollKeepersTreasure
		TriggerFX			 = FX_GenericGoodSummon
		CreateLocation       = USE_OWNER_OBJECT
		StartsPaused		 = No
		UpdateModuleStartsAttack  = Yes
	End
	;-----------------------------------------------------------------------------

	Geometry              = CYLINDER
	GeometryMajorRadius   = 40
	GeometryMinorRadius   = 40
	GeometryHeight        = 10
	GeometryOffset		= X:0 Y:0 Z:0
	GeometryIsSmall       = No

	AdditionalGeometry		= CYLINDER
	GeometryName			= Geom_V1
	GeometryMajorRadius		= 45
	GeometryMinorRadius		= 45
	GeometryHeight			= 20
	GeometryOffset			= X:-10 Y:-5 Z:60

	AdditionalGeometry		= CYLINDER
	GeometryName			= Geom_V2
	GeometryMajorRadius		= 17
	GeometryHeight			= 100
	GeometryOffset			= X:-10 Y:-7 Z:0

	Shadow                = SHADOW_VOLUME
	BuildCompletion     	= PLACED_BY_PLAYER

  	GeometryContactPoint	= X:-33		Y:10		Z:0		Repair
	GeometryContactPoint	= X:30		Y:10		Z:0		Repair
End



;------------------------------------------------------------------------------
Object ElvenMallornTreeStatue

   ; *** ART Parameters ***
  Draw = W3DScriptedModelDraw ModuleTag_01
  		DefaultModelConditionState
			Model = EBMalTreeStatu
		End
  End

    ; ***DESIGN parameters ***
  DisplayName      = OBJECT:Statue
  Side = Elves
  EditorSorting   = STRUCTURE

  ; *** ENGINEERING Parameters ***
  KindOf = IMMOBILE NO_COLLIDE OPTIMIZED_PROP CLEARED_BY_BUILD
  Shadow          = SHADOW_VOLUME

End

;---------------special tree for Good Rivendell
ChildObject GoodRivIntroMallorn ElvenMallornTree
 ArmorSet
    Conditions        = None
    Armor             = GoodRivendellIntroMallornArmour
    ;DamageFX          = StructureDamageFXNoShake
  End
    Behavior            = GettingBuiltBehavior GetBuiltBehaviorTag
    End
End

Object ElvenMallornTreeNimrodelWaters

	Draw	= W3DScriptedModelDraw ModuleTag_01
		OkToChangeModelColor	= Yes

		DefaultModelConditionState
			Model           = ebNmallorn2_wat   ;ebmaltree_well
		End
	End

	ArmorSet
		Conditions        = None
  		Armor             = NoArmor
  		//DamageFX          = StructureDamageFXNoShake
  	End

	Side                = Elves
	EditorSorting       = STRUCTURE

	// *** AUDIO Parameters ***
	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"
	CampnessValue = 0


;	// *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = STRUCTURE IMMOBILE UNATTACKABLE NOT_AUTOACQUIRABLE BASE_SITE CAN_SEE_THROUGH_STRUCTURE

	Body = HighlanderBody ModuleTag_02 ;//Can take damage, but won't die.  Can only die from ::kill() or other unresistable damage
		MaxHealth      = 50.0
	End

	Behavior = SlavedUpdate ModuleTag_Slave
		DieOnMastersDeath = Yes
	End

	Geometry              	= CYLINDER
	GeometryMajorRadius   	= 50
	GeometryHeight      	= 10
	GeometryIsSmall     	= No
	Shadow					= SHADOW_VOLUME
End

ChildObject ElvenMallornTreeFoundation ElvenMallornTree
  PlacementViewAngle  = 0
	Behavior = CastleMemberBehavior ModuleTag_CMB
	End
	RemoveModule ModuleTag_MoneyProduction
	RemoveModule ModuleTag_MoneyProductionClient
	Behavior = AutoDepositUpdate AutoDepositModuleTag
		DepositTiming       = FOUNDATION_FARM_MONEY_TIME 	   ; in milliseconds
		DepositAmount       = FOUNDATION_FARM_MONEY_AMOUNT   ; cash amount to deposit every DepositTiming
		InitialCaptureBonus = 0  ; no initial bonus
	End
End

; ChildObject ElvenMallornTree_ForAI ElvenMallornTree
; 	RemoveModule ModuleTag_MoneyProduction

; 	Behavior = TerrainResourceBehavior ModuleTag_AIMoneyProduction
; 		Radius		= 150 ;ELVEN_MALLORN_TREE_MONEY_RANGE	; How far we try to claim ground
; 		MaxIncome	= 15 ;ELVEN_MALLORN_TREE_MONEY_AMOUNT	; If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
; 		IncomeInterval	= ELVEN_MALLORN_TREE_MONEY_TIME		; How often (in msec) we give that much money
; 	End
; 	;//////
; 	;// Automatic Upgrade that triggers the unpacking
; 	;//////
; 	Behavior = GrantUpgradeCreate ModuleTag_AIAutoUnpacker
; 		UpgradeToGrant = Upgrade_SwitchToRockThrowing
; 		GiveOnBuildComplete = Yes
; 	End

; 	Behavior = DoCommandUpgrade ModuleTag_UnpackNiphredilAI
; 		TriggeredBy = Upgrade_SwitchToRockThrowing ; Upgrade_ObjectUnderAIControl
; 		GetUpgradeCommandButtonName = Command_UpgradeMallornNiphredilBloom_AI
; 	End
; 	;-------------------------------------------------
; 	;--- Unique AI Mallorn
; 	;-------------------------------------------------
; 	RemoveModule ModuleTag_ReplaceWithNiphredil
; 	Behavior = ReplaceSelfUpgrade ModuleTag_ReplaceWithNiphredilAI
; 		TriggeredBy = Upgrade_MallornTreeNiphredilAI; L00BE9600: List of Upgrades //Must have these upgrades
; 		RequiresAllTriggers = Yes; SUB_L006D3400:Boolean //All "TriggeredBy" Upgrades required! (meaning that if only one is present the module is not active)
; 		Permanent = Yes; SUB_L006D3400:Boolean //For ever... and ever... and ever, even if the upgrades are lost...
; 		ReplaceWith = ElvenNiphredilMallornTree_ForAI
; 	 ; ;AndThenAddA = ObjectExtra; SUB_L006D34D0:Strings(Object)
; 	End

; 	BuildCost = 100
;   ; First four farms are half price for captain in order to help set up early base. Only first farm is discounted for Peasant/Soldier

;   Behavior = CostModifierUpgrade ModuleTag_EarlyFarmDiscount
;   LabelForPalantirString = GUI:Blank
;   StartsActive = No ; Run on build complete, not upgrade
;   TriggeredBy = Upgrade_HardAIMultiPlayer Upgrade_BrutalAIMultiPlayer
;       ObjectFilter        = ANY +ElvenMallornTree_ForAI
;       Percentage        = 0%
;       Percentage        = 0%
;       Percentage        = 0%
;       Percentage        = 200%
;   End

;   Behavior = CostModifierUpgrade ModuleTag_NoEarlyFarmDiscount
;   LabelForPalantirString = GUI:Blank
;   StartsActive = No ; Run on build complete, not upgrade
;   TriggeredBy = Upgrade_EasyAIMultiPlayer Upgrade_MediumAIMultiPlayer
;       ObjectFilter        = ANY +ElvenMallornTree_ForAI
;       Percentage        = 200%
;       Percentage        = 200%
;       Percentage        = 200%
;       Percentage        = 200%
;   End
; ;-------------------
; ;---AI Difficulty Penalities
;   Behavior = AttributeModifierUpgrade ModuleTag_EasyAIPenalty
;   	TriggeredBy				= Upgrade_EasyAIMultiPlayer
;   	AttributeModifier		= AIEasyEconomyNerf
;   End

;   Behavior = AttributeModifierUpgrade ModuleTag_MediumAIPenalty
;   	TriggeredBy				= Upgrade_MediumAIMultiPlayer
;   	AttributeModifier		= AIMediumEconomyNerf
;   End
; End

ChildObject ElvenMallornTreeBarracks_ForAI ElvenMallornTree
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		StaticModelLODMode = yes
		UseStandardModelNames = Yes

		ExtraPublicBone	= ARCHER01

		DefaultModelConditionState
			Model = ebNmallorn0_skn  ;EBMalTree
			; ParticleSysBone     =  FireFlyBone FireFlies02 FollowBone:Yes
				;WeaponLaunchBone = PRIMARY ARCHER01
		End

		ModelConditionState = USER_28
			Model = ebNmallorn0_skn  ;EBMalTree
			WeaponLaunchBone = PRIMARY ARROW
			ParticleSysBone  = None TollKeepersAura Followbone:No
			ParticleSysBone  = None TollKeepersGold Followbone:No
			ParticleSysBone  = None TollKeepersGreen Followbone:No
		End

		ModelConditionState = USER_29
			Model = ebNmallorn0_skn  ;EBMalTree
			WeaponLaunchBone = PRIMARY ARROW
			ParticleSysBone  = None CursedTreasureAura Followbone:No
			ParticleSysBone  = None CursedTreasureGold Followbone:No
			ParticleSysBone  = None CursedTreasureGreen Followbone:No
		End

	ModelConditionState				= BUILD_PLACEMENT_CURSOR
		Shadow						= SHADOW_ALPHA_DECAL
		ShadowTexture				= decal_hero_good
		ShadowSizeX					= 385 ;ELVEN_STATUE_AOE_RADIUS_DECAL
		ShadowSizeY					= 385 ;ELVEN_STATUE_AOE_RADIUS_DECAL
		ShadowOverrideLODVisibility = Yes
	End
	;//	Animation state for build placement cursor
	AnimationState = BUILD_PLACEMENT_CURSOR
		BeginScript
			CurDrawableHideSubObject("N_Window")
			CurDrawableHideSubObject("N_Glow")
				CurDrawableHideSubObject("V1")
				CurDrawableHideSubObject("V1a")
			CurDrawableHideSubObject("V2")
			CurDrawableHideSubObject("V2a")
		EndScript
	End
	;//	Animation state for phantom structure
	AnimationState = PHANTOM_STRUCTURE
		BeginScript
			CurDrawableHideSubObject("N_Window")
			CurDrawableHideSubObject("N_Glow")
				CurDrawableHideSubObject("V1")
				CurDrawableHideSubObject("V1a")
			CurDrawableHideSubObject("V2")
			CurDrawableHideSubObject("V2a")
		EndScript
	End
		IdleAnimationState
		ParticleSysBone = NONE LorienFallingLeaves
		ParticleSysBone = NONE FireFliesLorien		
	End
		;------------ Build Up States -------
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
		Model	= ebNmallorn0_bld  ;EBMalTree_ASKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
	End
		ModelConditionState   = AWAITING_CONSTRUCTION
			Model               = ebNmallorn0_bldEBMalTree_ASKN
	;		ParticleSysBone	  = NONE BuildingDoughnutCloud
		End
		AnimationState        = AWAITING_CONSTRUCTION
			Animation           =  ebNmallorn0_bld  ;EBMalTree_A
				AnimationName     =  ebNmallorn0_bld.ebNmallorn0_bld  ;EBMalTree_ASKL.EBMalTree_ABLD
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
		Flags				  = START_FRAME_FIRST
		End
	ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Model	= ebNmallorn0_bld   ;EBMalTree_ASKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		ParticleSysBone = NONE ExpLeavesLorien
	End
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = ebNmallorn0_bld  ;EBMalTree_ASKN
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		ParticleSysBone = NONE ExpLeavesLorien
		End;
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Animation           = ebNmallorn0_bld  ;EBMalTree_A
			AnimationName     = ebNmallorn0_bld.ebNmallorn0_bld  ;EBMalTree_ASKL.EBMalTree_ABLD
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
		End
		Flags				  = START_FRAME_FIRST
		StateName				= BeingConstructed
		BeginScript
			CurDrawablePlaySound("GondorBarracksBeginConstruction")
			CurDrawablePlaySound("LothlorienConstructionSong")
			CurDrawablePlaySound("LothlorienConstruction")
		EndScript
		End
			;--damaged building
		ModelConditionState     = DAMAGED
			Model               = ebNmallorn0_d1  ;EBMalTree_D1
		End
		AnimationState =	DAMAGED
			EnteringStateFX	= FX_StatueDamaged
			ParticleSysBone = NONE LorienBaseLeaves
			ParticleSysBone = NONE Maltreedust
		End
		ModelConditionState     = REALLYDAMAGED
			Model               = ebNmallorn0_d2  ;EBMalTree_D2
		End
			AnimationState =	REALLYDAMAGED
				Animation	= RubbleAnimation
				AnimationName		=	ebNmallorn0_d2.ebNmallorn0_d2  ;EBMalTree_D2SK.EBMalTree_D2AN
				AnimationMode		=	ONCE
				End
			EnteringStateFX	= FX_StatueDamaged
		End
		ModelConditionState  = RUBBLE
			Model         =  ebNmallorn0_d2    ;EBMalTree_D3
			ParticleSysBone SmokeLarge01 SmokeBuildingLarge
		End
		AnimationState = RUBBLE
			Animation	= RubbleAnimation
				AnimationName		=	ebNmallorn0_d2.ebNmallorn0_d2   ;EBMalTree_D3SK.EBMalTree_D3AN
				AnimationMode		=	ONCE
				End
				EnteringStateFX	= FX_StructureMediumCollapse
		End
		ModelConditionState  = POST_RUBBLE
			Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		ModelConditionState  = POST_COLLAPSE
			Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End

			ModelConditionState = SNOW
			Model = ebNmallorn0_skn  ;EBMalTree
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
				End

				ModelConditionState = WORLD_BUILDER
					Model = ebNmallorn1_gar
				End
	End

	RemoveModule ModuleTag_MoneyProduction
	KindOf = -ECONOMY_STRUCTURE

	Behavior = TerrainResourceBehavior ModuleTag_AIMoneyProduction
		Radius		= 150 ;ELVEN_MALLORN_TREE_MONEY_RANGE	; How far we try to claim ground
		MaxIncome	= 15 ;ELVEN_MALLORN_TREE_MONEY_AMOUNT	; If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval	= ELVEN_MALLORN_TREE_MONEY_TIME		; How often (in msec) we give that much money
	End
	;//////
	;// Automatic Upgrade that triggers the unpacking
	;//////
	Behavior = GrantUpgradeCreate ModuleTag_AIAutoUnpacker
		UpgradeToGrant = Upgrade_SwitchToRockThrowing
		GiveOnBuildComplete = Yes
	End

	Behavior = DoCommandUpgrade ModuleTag_UnpackBarracksAI
		TriggeredBy = Upgrade_SwitchToRockThrowing ; Upgrade_ObjectUnderAIControl
		GetUpgradeCommandButtonName = Command_UpgradeMallornTreeBarracks
	End
End

ChildObject ElvenMallornTreePasture_ForAI ElvenMallornTree
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		StaticModelLODMode = yes
		UseStandardModelNames = Yes

		ExtraPublicBone	= ARCHER01

		DefaultModelConditionState
			Model = ebNmallorn0_skn  ;EBMalTree
			; ParticleSysBone     =  FireFlyBone FireFlies02 FollowBone:Yes
				;WeaponLaunchBone = PRIMARY ARCHER01
		End

		ModelConditionState = USER_28
			Model = ebNmallorn0_skn  ;EBMalTree
			WeaponLaunchBone = PRIMARY ARROW
			ParticleSysBone  = None TollKeepersAura Followbone:No
			ParticleSysBone  = None TollKeepersGold Followbone:No
			ParticleSysBone  = None TollKeepersGreen Followbone:No
		End

		ModelConditionState = USER_29
			Model = ebNmallorn0_skn  ;EBMalTree
			WeaponLaunchBone = PRIMARY ARROW
			ParticleSysBone  = None CursedTreasureAura Followbone:No
			ParticleSysBone  = None CursedTreasureGold Followbone:No
			ParticleSysBone  = None CursedTreasureGreen Followbone:No
		End

	ModelConditionState				= BUILD_PLACEMENT_CURSOR
		Shadow						= SHADOW_ALPHA_DECAL
		ShadowTexture				= decal_hero_good
		ShadowSizeX					= 385 ;ELVEN_STATUE_AOE_RADIUS_DECAL
		ShadowSizeY					= 385 ;ELVEN_STATUE_AOE_RADIUS_DECAL
		ShadowOverrideLODVisibility = Yes
	End
	;//	Animation state for build placement cursor
	AnimationState = BUILD_PLACEMENT_CURSOR
		BeginScript
			CurDrawableHideSubObject("N_Window")
			CurDrawableHideSubObject("N_Glow")
				CurDrawableHideSubObject("V1")
				CurDrawableHideSubObject("V1a")
			CurDrawableHideSubObject("V2")
			CurDrawableHideSubObject("V2a")
		EndScript
	End
	;//	Animation state for phantom structure
	AnimationState = PHANTOM_STRUCTURE
		BeginScript
			CurDrawableHideSubObject("N_Window")
			CurDrawableHideSubObject("N_Glow")
				CurDrawableHideSubObject("V1")
				CurDrawableHideSubObject("V1a")
			CurDrawableHideSubObject("V2")
			CurDrawableHideSubObject("V2a")
		EndScript
	End
		IdleAnimationState
		ParticleSysBone = NONE LorienFallingLeaves
		ParticleSysBone = NONE FireFliesLorien		
	End
		;------------ Build Up States -------
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
		Model	= ebNmallorn0_bld  ;EBMalTree_ASKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
	End
		ModelConditionState   = AWAITING_CONSTRUCTION
			Model               = ebNmallorn0_bldEBMalTree_ASKN
	;		ParticleSysBone	  = NONE BuildingDoughnutCloud
		End
		AnimationState        = AWAITING_CONSTRUCTION
			Animation           =  ebNmallorn0_bld  ;EBMalTree_A
				AnimationName     =  ebNmallorn0_bld.ebNmallorn0_bld  ;EBMalTree_ASKL.EBMalTree_ABLD
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
		Flags				  = START_FRAME_FIRST
		End
	ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Model	= ebNmallorn0_bld   ;EBMalTree_ASKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		ParticleSysBone = NONE ExpLeavesLorien
	End
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = ebNmallorn0_bld  ;EBMalTree_ASKN
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		ParticleSysBone = NONE ExpLeavesLorien
		End;
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Animation           = ebNmallorn0_bld  ;EBMalTree_A
			AnimationName     = ebNmallorn0_bld.ebNmallorn0_bld  ;EBMalTree_ASKL.EBMalTree_ABLD
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
		End
		Flags				  = START_FRAME_FIRST
		StateName				= BeingConstructed
		BeginScript
			CurDrawablePlaySound("GondorBarracksBeginConstruction")
			CurDrawablePlaySound("LothlorienConstructionSong")
			CurDrawablePlaySound("LothlorienConstruction")
		EndScript
		End
			;--damaged building
		ModelConditionState     = DAMAGED
			Model               = ebNmallorn0_d1  ;EBMalTree_D1
		End
		AnimationState =	DAMAGED
			EnteringStateFX	= FX_StatueDamaged
			ParticleSysBone = NONE LorienBaseLeaves
			ParticleSysBone = NONE Maltreedust
		End
		ModelConditionState     = REALLYDAMAGED
			Model               = ebNmallorn0_d2  ;EBMalTree_D2
		End
			AnimationState =	REALLYDAMAGED
				Animation	= RubbleAnimation
				AnimationName		=	ebNmallorn0_d2.ebNmallorn0_d2  ;EBMalTree_D2SK.EBMalTree_D2AN
				AnimationMode		=	ONCE
				End
			EnteringStateFX	= FX_StatueDamaged
		End
		ModelConditionState  = RUBBLE
			Model         =  ebNmallorn0_d2    ;EBMalTree_D3
			ParticleSysBone SmokeLarge01 SmokeBuildingLarge
		End
		AnimationState = RUBBLE
			Animation	= RubbleAnimation
				AnimationName		=	ebNmallorn0_d2.ebNmallorn0_d2   ;EBMalTree_D3SK.EBMalTree_D3AN
				AnimationMode		=	ONCE
				End
				EnteringStateFX	= FX_StructureMediumCollapse
		End
		ModelConditionState  = POST_RUBBLE
			Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		ModelConditionState  = POST_COLLAPSE
			Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End

			ModelConditionState = SNOW
			Model = ebNmallorn0_skn  ;EBMalTree
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
				End

				ModelConditionState = WORLD_BUILDER
					Model = ebNmallorn1_pas
				End
	End
	RemoveModule ModuleTag_MoneyProduction

	KindOf = -ECONOMY_STRUCTURE

	Behavior = TerrainResourceBehavior ModuleTag_AIMoneyProduction
		Radius		= 150 ;ELVEN_MALLORN_TREE_MONEY_RANGE	; How far we try to claim ground
		MaxIncome	= 10 ;ELVEN_MALLORN_TREE_MONEY_AMOUNT	; If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval	= ELVEN_MALLORN_TREE_MONEY_TIME		; How often (in msec) we give that much money
	End
	;//////
	;// Automatic Upgrade that triggers the unpacking
	;//////
	Behavior = GrantUpgradeCreate ModuleTag_AIAutoUnpacker
		UpgradeToGrant = Upgrade_SwitchToRockThrowing
		GiveOnBuildComplete = Yes
	End

	Behavior = DoCommandUpgrade ModuleTag_UnpackPastureAI
		TriggeredBy = Upgrade_SwitchToRockThrowing ; Upgrade_ObjectUnderAIControl
		GetUpgradeCommandButtonName = Command_UpgradeMallornTreePasture
	End
End

ChildObject ElvenMallornTreeStoreHouse_ForAI ElvenMallornTree
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		StaticModelLODMode = yes
		UseStandardModelNames = Yes

		ExtraPublicBone	= ARCHER01

		DefaultModelConditionState
			Model = ebNmallorn0_skn  ;EBMalTree
			; ParticleSysBone     =  FireFlyBone FireFlies02 FollowBone:Yes
				;WeaponLaunchBone = PRIMARY ARCHER01
		End

		ModelConditionState = USER_28
			Model = ebNmallorn0_skn  ;EBMalTree
			WeaponLaunchBone = PRIMARY ARROW
			ParticleSysBone  = None TollKeepersAura Followbone:No
			ParticleSysBone  = None TollKeepersGold Followbone:No
			ParticleSysBone  = None TollKeepersGreen Followbone:No
		End

		ModelConditionState = USER_29
			Model = ebNmallorn0_skn  ;EBMalTree
			WeaponLaunchBone = PRIMARY ARROW
			ParticleSysBone  = None CursedTreasureAura Followbone:No
			ParticleSysBone  = None CursedTreasureGold Followbone:No
			ParticleSysBone  = None CursedTreasureGreen Followbone:No
		End

	ModelConditionState				= BUILD_PLACEMENT_CURSOR
		Shadow						= SHADOW_ALPHA_DECAL
		ShadowTexture				= decal_hero_good
		ShadowSizeX					= 385 ;ELVEN_STATUE_AOE_RADIUS_DECAL
		ShadowSizeY					= 385 ;ELVEN_STATUE_AOE_RADIUS_DECAL
		ShadowOverrideLODVisibility = Yes
	End
	;//	Animation state for build placement cursor
	AnimationState = BUILD_PLACEMENT_CURSOR
		BeginScript
			CurDrawableHideSubObject("N_Window")
			CurDrawableHideSubObject("N_Glow")
				CurDrawableHideSubObject("V1")
				CurDrawableHideSubObject("V1a")
			CurDrawableHideSubObject("V2")
			CurDrawableHideSubObject("V2a")
		EndScript
	End
	;//	Animation state for phantom structure
	AnimationState = PHANTOM_STRUCTURE
		BeginScript
			CurDrawableHideSubObject("N_Window")
			CurDrawableHideSubObject("N_Glow")
				CurDrawableHideSubObject("V1")
				CurDrawableHideSubObject("V1a")
			CurDrawableHideSubObject("V2")
			CurDrawableHideSubObject("V2a")
		EndScript
	End
		IdleAnimationState
		ParticleSysBone = NONE LorienFallingLeaves
		ParticleSysBone = NONE FireFliesLorien		
	End
		;------------ Build Up States -------
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
		Model	= ebNmallorn0_bld  ;EBMalTree_ASKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
	End
		ModelConditionState   = AWAITING_CONSTRUCTION
			Model               = ebNmallorn0_bldEBMalTree_ASKN
	;		ParticleSysBone	  = NONE BuildingDoughnutCloud
		End
		AnimationState        = AWAITING_CONSTRUCTION
			Animation           =  ebNmallorn0_bld  ;EBMalTree_A
				AnimationName     =  ebNmallorn0_bld.ebNmallorn0_bld  ;EBMalTree_ASKL.EBMalTree_ABLD
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
		Flags				  = START_FRAME_FIRST
		End
	ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Model	= ebNmallorn0_bld   ;EBMalTree_ASKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		ParticleSysBone = NONE ExpLeavesLorien
	End
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = ebNmallorn0_bld  ;EBMalTree_ASKN
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		ParticleSysBone = NONE ExpLeavesLorien
		End;
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Animation           = ebNmallorn0_bld  ;EBMalTree_A
			AnimationName     = ebNmallorn0_bld.ebNmallorn0_bld  ;EBMalTree_ASKL.EBMalTree_ABLD
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
		End
		Flags				  = START_FRAME_FIRST
		StateName				= BeingConstructed
		BeginScript
			CurDrawablePlaySound("GondorBarracksBeginConstruction")
			CurDrawablePlaySound("LothlorienConstructionSong")
			CurDrawablePlaySound("LothlorienConstruction")
		EndScript
		End
			;--damaged building
		ModelConditionState     = DAMAGED
			Model               = ebNmallorn0_d1  ;EBMalTree_D1
		End
		AnimationState =	DAMAGED
			EnteringStateFX	= FX_StatueDamaged
			ParticleSysBone = NONE LorienBaseLeaves
			ParticleSysBone = NONE Maltreedust
		End
		ModelConditionState     = REALLYDAMAGED
			Model               = ebNmallorn0_d2  ;EBMalTree_D2
		End
			AnimationState =	REALLYDAMAGED
				Animation	= RubbleAnimation
				AnimationName		=	ebNmallorn0_d2.ebNmallorn0_d2  ;EBMalTree_D2SK.EBMalTree_D2AN
				AnimationMode		=	ONCE
				End
			EnteringStateFX	= FX_StatueDamaged
		End
		ModelConditionState  = RUBBLE
			Model         =  ebNmallorn0_d2    ;EBMalTree_D3
			ParticleSysBone SmokeLarge01 SmokeBuildingLarge
		End
		AnimationState = RUBBLE
			Animation	= RubbleAnimation
				AnimationName		=	ebNmallorn0_d2.ebNmallorn0_d2   ;EBMalTree_D3SK.EBMalTree_D3AN
				AnimationMode		=	ONCE
				End
				EnteringStateFX	= FX_StructureMediumCollapse
		End
		ModelConditionState  = POST_RUBBLE
			Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		ModelConditionState  = POST_COLLAPSE
			Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End

			ModelConditionState = SNOW
			Model = ebNmallorn0_skn  ;EBMalTree
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
				End

				ModelConditionState = WORLD_BUILDER
					Model = ebNmallorn1_sto
				End
	End
	RemoveModule ModuleTag_MoneyProduction

	KindOf = -ECONOMY_STRUCTURE

	Behavior = TerrainResourceBehavior ModuleTag_AIMoneyProduction
		Radius		= 150 ;ELVEN_MALLORN_TREE_MONEY_RANGE	; How far we try to claim ground
		MaxIncome	= 10 ;ELVEN_MALLORN_TREE_MONEY_AMOUNT	; If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval	= ELVEN_MALLORN_TREE_MONEY_TIME		; How often (in msec) we give that much money
	End
	;//////
	;// Automatic Upgrade that triggers the unpacking
	;//////
	Behavior = GrantUpgradeCreate ModuleTag_AIAutoUnpacker
		UpgradeToGrant = Upgrade_SwitchToRockThrowing
		GiveOnBuildComplete = Yes
	End

	Behavior = DoCommandUpgrade ModuleTag_UnpackStorageAI
		TriggeredBy = Upgrade_SwitchToRockThrowing ; Upgrade_ObjectUnderAIControl
		GetUpgradeCommandButtonName = Command_UpgradeMallornTreeStorage
	End
End

;------------------------------------------------------
Object ElvenDummyBarracks

	Draw = W3DScriptedModelDraw ModuleTag_Draw
		DefaultModelConditionState
			Model = None ;mukhamul_skn ;None
		End
	End
	KindOf = INERT IMMOBILE UNATTACKABLE MP_COUNT_FOR_VICTORY

  Body = HighlanderBody ModuleTag_02 ;//Can take damage, but won't die.  Can only die from ::kill() or other unresistable damage
		MaxHealth      = 50.0
	End

	Behavior = SlavedUpdate ModuleTag_Slave
		DieOnMastersDeath = Yes
	End

	; Behavior = AttributeModifierAuraUpdate ModuleTag_DebuffSmallRadius
		; StartsActive		= Yes ;No ;If no, requires upgrade to turn on.
		; BonusName		= BlessedLanternsDebuffSmallRadius
; ;		TriggeredBy		= Upgrade_ObjectLevel3
		; RefreshDelay	= 2000
		; Range			= 200
		; TargetEnemy		= Yes
; ;;,;;		AntiCategory	= LEADERSHIP BUFF ; This means cancel all previous leadership bonuses
		; ObjectFilter	= AOTR_GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
	; End

;  Geometry = CYLINDER
;  GeometryMajorRadius = 13.6
;  GeometryMinorRadius = 12.0
;  GeometryHeight = 72.0
;  GeometryIsSmall = No
End

Object ElvenCommandPointDummy
; Bazaar model for testing
	; Draw = W3DScriptedModelDraw ModuleTag_Draw
	; 	DefaultModelConditionState
	; 		Model					= HBBazaar_SKN
	; 		WeaponLaunchBone = PRIMARY ARROW
	; 	End
	; End
  EvaEnemyObjectSightedEvent = None ; Not a real unit

	ArmorSet
		Conditions	  = None
		Armor		   = PingArmor
		DamageFX		= NormalDamageFX
	End

 ; ***DESIGN parameters ***

  EditorSorting   = STRUCTURE
  KindOf = PRELOAD STRUCTURE IMMOBILE IGNORE_FOR_VICTORY IGNORE_FOR_EVA_SPEECH_POSITION SUMMONED ; NO_COLLIDE CREEP SUMMONED
	CommandPointBonus = 50
	ThreatLevel			= 0.0
	VisionRange		= 0
	ShroudClearingRange	= 0

 ; *** ENGINEERING Parameters ***

	Body = StructureBody ModuleTag_Body;Can take damage, but won't die.  Can only die from ::kill() or other unresistable damage
		MaxHealth	  = 1.0
	End

	Behavior = DestroyDie ModuleTag_Die
	End

	; Behavior = LifetimeUpdate ModuleTag_HatchTrigger
	; 	MinLifetime = 15000.0
	; 	MaxLifetime = 15000.0
	; 	DeathType		= FADED
	; End

	Behavior = AttachUpdate ModuleTag_Attach
		ObjectFilter = NONE +ElvenMallornTree
		ScanRange = 20
	;	ParentStatus = HOLDING_THE_RING
		AlwaysTeleport = No
		AnchorToTopOfGeometry = No
	End

	Behavior = AIUpdateInterface	ModuleTag_AIUpdateInterface
		AutoAcquireEnemiesWhenIdle = No
		;// MoodAttackCheckRate		= 250
	End

	LocomotorSet
		Locomotor = InvisiblePingLocomotor
		Condition = SET_NORMAL
		Speed	 = 1000
	End
	Behavior = SlavedUpdate ModuleTag_Slave
		UseSlaverAsControlForEvaObjectSightedEvents = Yes
		DieOnMastersDeath	= Yes	;//Die when my master dies!
	End


End
ChildObject ElvenCommandPointDummy_25 ElvenCommandPointDummy
	CommandPointBonus = 25
End