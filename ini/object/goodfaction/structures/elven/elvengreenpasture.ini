;------------------------------------------------------------------------------
; ElvenGreenPasture aka Elven Stable
Object ElvenGreenPasture

	SelectPortrait = BPLorienPasture

  ; *** ART Parameters ***
  Draw = W3DScriptedModelDraw ModuleTag_Draw

    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
	StaticModelLODMode = yes ; If yes, will append M or L to the skin name depending on GameLOD
	DefaultModelConditionState
		Model = ebNmallorn1_pas ;EBStable_SKN
	End

	RandomTexture = ebmaltree.tga	0 ebtree.tga
	RandomTexture = eulorpsnt1.tga	0 eupeasant2_c.tga

	;//	Animation state for build placement cursor
	AnimationState = BUILD_PLACEMENT_CURSOR
		BeginScript
			; CurDrawableHideSubObject("N_Window")
			; CurDrawableHideSubObject("N_Glow")
   			; ;CurDrawableHideSubObject("V1")
   			; ;CurDrawableHideSubObject("V1a")
			; CurDrawableHideSubObject("V2")
			; CurDrawableHideSubObject("Fence")
			CurDrawableHideSubObject("PASRANK2")
			CurDrawableHideSubObject("PASRANK3A")
			CurDrawableHideSubObject("PASRANK3B")
		EndScript
	End

	;//	Animation state for phantom structure
	AnimationState = PHANTOM_STRUCTURE
		BeginScript
			; CurDrawableHideSubObject("N_Window")
			; CurDrawableHideSubObject("N_Glow")
   			; ;CurDrawableHideSubObject("V1")
   			; ;CurDrawableHideSubObject("V1a")
			; CurDrawableHideSubObject("V2")
			; CurDrawableHideSubObject("Fence")
			CurDrawableHideSubObject("PASRANK2")
			CurDrawableHideSubObject("PASRANK3A")
			CurDrawableHideSubObject("PASRANK3B")
		EndScript
	End


    	IdleAnimationState
			; StateName				=   STATE_Idle
			; Animation = IdleA
				; AnimationName		=	EBStable_SKL.EBStable_IDLA
				; AnimationMode		=	ONCE
				; AnimationPriority		=	30
			; End
			; Animation = IdleB
				; AnimationName		=	EBStable_SKL.EBStable_IDLA
				; AnimationMode		=	ONCE
				; AnimationPriority		=	10
			; End
			; Flags               = RESTART_ANIM_WHEN_COMPLETE
			
		ParticleSysBone = NONE LorienFallingLeaves
		ParticleSysBone = NONE FireFliesLorien

		End

    ;------------ New Build Up States coming soon.
   ; ModelConditionState = SNOW AWAITING_CONSTRUCTION
	;	Model	= EBStable_A
	;	Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
	;	Texture = ebNmallornA.tga ebNmallornA_snow.tga
	;End
   ; ModelConditionState   = AWAITING_CONSTRUCTION
   ;   Model               = EBStable_A
;	;	ParticleSysBone	  = NONE BuildingDoughnutCloud
   ; End;
   ; AnimationState        = AWAITING_CONSTRUCTION
   ;   Animation           =  EBStable_A
   ;     AnimationName     =  EBStable_ASKL.EBStable_ABLD
   ;     AnimationMode     = MANUAL
   ;     AnimationBlendTime = 0
  ;    End
;	  Flags				  = START_FRAME_FIRST
 ;   End

;	ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
;		Model					= EBStable_A
	;	Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
;		Texture = ebNmallornA.tga ebNmallornA_snow.tga
;	End
 ;   ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
;		Model					= EBStable_A
;		ParticleSysBone			= CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
;		ParticleSysBone = NONE ExpLeavesLorien
 ;   End;
 ;   AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
;		Animation				= EBStable_A
;			AnimationName		= EBStable_ASKL.EBStable_ABLD
;			AnimationMode		= MANUAL
;			AnimationBlendTime	= 0
;		End
;		Flags				  = START_FRAME_FIRST
;		StateName			  = BeingConstructed
	;	BeginScript
;			CurDrawablePlaySound("GondorBarracksBeginConstruction")
			;CurDrawableHideSubObjectPermanently("V1")
;			CurDrawableHideSubObjectPermanently("V1FLAG")
;			CurDrawableHideSubObjectPermanently("V2")
;		EndScript
 ;   End

    ;------------ Build Up States -------

    ModelConditionState  = DAMAGED
      Model         = ebNmal1_pas_d1

		ParticleSysBone V1 StableSmokeBuildingMedium
		ParticleSysBone V1 StableFireBuildingMedium

    End

   AnimationState = DAMAGED
		EnteringStateFX	= FX_BuildingDamaged
		ParticleSysBone = NONE LorienBaseLeaves
		ParticleSysBone = NONE Maltreedust
   End

    ModelConditionState  = REALLYDAMAGED
      Model         = ebNmal1_pas_d2
		ParticleSysBone V1 StableSmokeBuildingMedium
		ParticleSysBone V1 StableFireBuildingMedium
		ParticleSysBone V1 StableSmokeBuildingLarge
		ParticleSysBone V1 StableFireBuildingLarge
    End

;   	AnimationState = REALLYDAMAGED
 ;    	Animation				=	RubbleAnimation
;			AnimationName		=	EBStable_D2SK.EBStable_D2AN
;			AnimationMode		=	ONCE
 ; 	  	End
;		EnteringStateFX	= FX_BuildingReallyDamaged
;   	End

   	ModelConditionState  = RUBBLE
		Model         = ebNmal1_pas_d2
      	ParticleSysBone SmokeLarge01 SmokeBuildingLarge
   	End

   	AnimationState = RUBBLE
   	 	Animation				=	RubbleAnimation
			AnimationName		=	EBStable_D3SK.EBStable_D3AN
			AnimationMode		=	ONCE
  	 	End
  	 	EnteringStateFX	= FX_StructureMediumCollapse
   	End

  	ModelConditionState  = POST_RUBBLE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
	End
	ModelConditionState  = POST_COLLAPSE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
	End

    ModelConditionState = SNOW
		Model = ebNmallorn1_pas  ;EBStable_SKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
    End

  End
  
;------------Mirror Bonus---------------------- 
  Draw = W3DScriptedModelDraw Draw_BonusEffects
	    DefaultModelConditionState
	      Model = None
	    End
		AnimationState = USER_5 
			ParticleSysBone	= None MirrorofGaladrielMallornSparkle
		End
  End


	; ;----------the door
	; Draw = W3DScriptedModelDraw ModuleTag_02

		; DefaultModelConditionState
			; Model = EBStable_DRC
		; End

		; ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			; Model               = None; EBStable_DrA
		; End
		; AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
; ;			Animation           =EBStable_DrA
; ;				AnimationName     = EBStable_DrA.EBStable_DrA
; ;				AnimationMode     = MANUAL
; ;			End
; ;			Flags				  = START_FRAME_FIRST
		; End

		; ; -----opening-----------
		; ModelConditionState = DOOR_1_OPENING SNOW
			; Model = EBStable_DROA
			; Texture = EBStable.tga EBStable_Snow.tga
		; End
		; ModelConditionState   = DOOR_1_OPENING
			; Model               = EBStable_DROA
		; End
		; AnimationState			=	DOOR_1_OPENING
			; Animation           =	EBStable_DROA
				; AnimationName   =	EBStable_DROA.EBStable_DROA
				; AnimationMode   =	ONCE
			; End
		; End

		; ModelConditionState = DOOR_1_WAITING_OPEN SNOW
			; Model = EBStable_DSOP
			; Texture = EBStable.tga EBStable_Snow.tga
		; End
		; ModelConditionState   = DOOR_1_WAITING_OPEN
			; Model               = EBStable_DSOP
		; End
		; AnimationState			=	DOOR_1_WAITING_OPEN
				; Animation           =	EBStable_DSOP
					; AnimationName   =   EBStable_DSOP.EBStable_DSOP
					; AnimationMode   =	ONCE
					; AnimationBlendTime = 0
				; End
			; ;	Flags				=	START_FRAME_FIRST
		; End


		; ; -----closing-----------
		; ModelConditionState = DOOR_1_CLOSING SNOW
			; Model = EBStable_DRCA
			; Texture = EBStable.tga EBStable_Snow.tga
		; End
		; ModelConditionState   = DOOR_1_CLOSING
			; Model               = EBStable_DRCA
		; End
		; AnimationState			=	DOOR_1_CLOSING
			; Animation           =	EBStable_DRCA
				; AnimationName   =	EBStable_DRCA.EBStable_DRCA
				; AnimationMode   =	ONCE
				; AnimationBlendTime = 0
			; End
		; End

		; ModelConditionState  = RUBBLE
			; Model         = none
   		; End
   		; AnimationState = RUBBLE
   		; End
  ; End
;--------------- UPGRADES -----
 	//Mallorn Roots
	Draw = W3DScriptedModelDraw ModuleTag_DrawMallornRoots
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model           = None
		End

		//Normal
		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
			Model           = ebNmallorn2_roo  ;ebmalroots_skn
		End
	End
 	//Star-lit Lanterns
	Draw = W3DScriptedModelDraw ModuleTag_DrawStarlitLanterns
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD
		ExtraPublicBone = B_LANTERN01
		ExtraPublicBone = B_LANTERN02
		ExtraPublicBone = B_LANTERN03
		ExtraPublicBone = B_LANTERN04
		ExtraPublicBone = B_LANTERN05


		DefaultModelConditionState
			Model           = None
		End

		//Normal
		ModelConditionState = USER_3
			Model           = ebNmallorn2_lan
		End
	End
 	//Silvan Levy
	Draw = W3DScriptedModelDraw ModuleTag_DrawSilvanLevy
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model           = None
		End

		//Normal
		ModelConditionState = USER_6
			Model           = ebNmallorn2_sil
		End
	End
  ; Draw module just for the hero FX.
	Draw = W3DScriptedModelDraw TheHealEffect
	    ModelConditionState  = NONE
			Model = None
	;		ParticleSysBone NONE StatueHeroFX
		End
	    ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED
			Model = None
		End
	End

	Draw = W3DScriptedModelDraw ModuleTag_DrawArrowBones
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD
		ExtraPublicBone = MALARROW01
		ExtraPublicBone = MALARROW02
		ExtraPublicBone = MALARROW03
		ExtraPublicBone = MALARROW04

		DefaultModelConditionState
			Model           = ebNarrows_skn
			WeaponLaunchBone = PRIMARY MALARROW
		End
	End
;------------------------------
  Draw = W3DFloorDraw ModuleTag_DrawFloor
		StaticModelLODMode = Yes		; THIS NEEDS TO BE COMMENTED OUT WHEN ENGINEERING ENABLES LOD'S IN THE FLOOR DRAW
     ModelName = ebNmallorn0_bib ;EBStable_Bib
	WeatherTexture		= SNOWY ebNmallorn_bib_snow.tga ;eblothfort_bib_snow
  		;HideIfModelConditions	=	AWAITING_CONSTRUCTION
  		;HideIfModelConditions	=	PARTIALLY_CONSTRUCTED
  End

  ;Draw = W3DScriptedModelDraw ModuleTag_Draw_HCBanner
;	OkToChangeModelColor  = Yes
;	DefaultModelConditionState
;		Model = EBHCStable
;	End
;	MultiPlayerOnly = Yes
 ; End

  PlacementViewAngle  = 315

  ; ***DESIGN parameters ***
  DisplayName		= OBJECT:ElvenGreenPasture
  Side			= Elves
  EditorSorting		= STRUCTURE
  ThreatLevel		= 1.0

  CommandSet		= LorienMallornTreeCommandSetPastureLevel1 ; ElvenGreenPastureCommandSet
;  CommandPointBonus	= 25
  BuildCost           	= ELVEN_GREEN_PASTURE_BUILDCOST
  RefundValue 			= 300
  BuildTime           	= ELVEN_GREEN_PASTURE_BUILDTIME
  VisionRange         	= ELVEN_GREEN_PASTURE_VISION_RANGE
  ShroudClearingRange 	= ELVEN_GREEN_PASTURE_SHROUD_CLEAR
  BountyValue        	=	ELVEN_GREEN_PASTURE_BOUNTY_VALUE

  Description 		= OBJECT:ElvenGreenPastureDescription

  ArmorSet
    Conditions        	= None
    Armor             	= MallornTreeBarracksArmor
  End

	WeaponSet
		Conditions		= None
	End

	WeaponSet
		Weapon			= PRIMARY ElvenBattleTowerBow
		Conditions		= PLAYER_UPGRADE
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

;	VoiceFullyCreated		= EVA:GreenPastureComplete
	VoiceSelect			= ElfGreenPastureSelect				;RohanStablesSelect
	VoiceSelectUnderConstruction	= LothlorienBuildingSelectUnderConstruction

 	SoundAmbient			= BuildingRohanStableAmbience
	SoundAmbientDamaged		= BuildingDamageFireMediumLoop
	SoundAmbientReallyDamaged	= BuildingDamageFireMediumLoop
	SoundOnDamaged			= BuildingLightDamageWood
	SoundOnReallyDamaged		= BuildingHeavyDamageWood

	UnitSpecificSounds
		UnderConstruction	= LothlorienConstructionLoop  	; Built first time
		; UnderRepairFromDamage	= NoSound			; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= LothlorienConstructionLoop	; Repaired from completely destroyed (not used???)
	End

  ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
 		AnimationSound = Sound: BuildingRohanStableHammerTap Animation:RBStable_SKL.RBStable_IDLA Frames: 63 74
 		AnimationSound = Sound: BuildingRohanStableHammerHorseShoe Animation:RBStable_SKL.RBStable_IDLA Frames: 97 116 132
 		AnimationSound = Sound: BuildingRohanStableMaleYawn Animation:RBStable_SKL.RBStable_IDLB Frames: 65
  End

  ; *** ENGINEERING Parameters ***

  RadarPriority       = STRUCTURE
  KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE NEED_BASE_FOUNDATION FS_FACTORY MP_COUNT_FOR_VICTORY AUTO_RALLYPOINT ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK MADE_OF_WOOD LIVING_WORLD_BUILDING_MIRROR

	Body                      = StructureBody ModuleTag_05
		MaxHealth               = 1800
		MaxHealthDamaged        = 1200
		MaxHealthReallyDamaged  = 600
	End

	Flammability   ; should be after the 'Body' statement
			Fuel          =   ELVEN_GREENPASTURE_FIRE_FUEL
			MaxBurnRate   =   ELVEN_GREENPASTURE_FIRE_MAX_BURN_RATE
			Decay         =   ELVEN_GREENPASTURE_FIRE_DECAY
			Resistance    =   ELVEN_GREENPASTURE_FIRE_RESISTANCE
	End
	
	;fixing blue health bug
	Behavior = AttributeModifierUpgrade ModuleTag_ElvenGiftBonus
		TriggeredBy = Upgrade_ElfFaction
		RequiresAllTriggers = No
		AttributeModifier = BriefImmunity
	End
	
	Behavior = ProductionUpdate ProductionUpdateModuleTag
		ProductionModifier		; An object-local discount.
			RequiredUpgrade = Upgrade_ThingsThatWere
			CostMultiplier = 0.80
			ModifierFilter = NONE +ElvenAmrothKnightHorde
		End
		NumDoorAnimations            	= 1
		DoorOpeningTime              	= 3250  ;in mSeconds how long you want doors to be in open state
		DoorWaitOpenTime             	=13000  ;in mSeconds time the door stays open, so units can exit
		DoorCloseTime                	= 4000  ;in mSeconds how long you want doors to be in open state
		ConstructionCompleteDuration 	= 0  ;in mSeconds   wait time so if you have multiple units they don't run over each other
		GiveNoXP                       	= Yes
	End

	;----These objects generate 25 cp when upgrade is researched
	Behavior = SpawnBehavior ModuleTag_SpawnMoreCommandPoints
		TriggeredBy = Upgrade_StructureLevel1
		SpawnNumber = 1
		InitialBurst = 1
		SpawnTemplateName = ElvenCommandPointDummy_25
		SpawnReplaceDelay = 35000
		FadeInTime = 100
		OneShot = No
		SpawnInsideBuilding = No
		CanReclaimOrphans	= Yes
	End

	Behavior = TerrainResourceBehavior ModuleTag_MoneyProduction
		Radius		= 240 ;ELVEN_MALLORN_TREE_MONEY_RANGE	; How far we try to claim ground
		MaxIncome	= 15 ;ELVEN_MALLORN_TREE_MONEY_AMOUNT	; If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval	= ELVEN_MALLORN_TREE_MONEY_TIME		; How often (in msec) we give that much money
	End

	ClientBehavior = TerrainResourceClientBehavior ModuleTag_MoneyProductionClient
	End

;	Behavior = AttributeModifierAuraUpdate ModuleTag_EcoDebuff
;		StartsActive		= No
;		BonusName		= LothlorienEconomyDebuff
;		TriggeredBy		= Upgrade_ArnorWallRegularGate
;		ConflictsWith	= Upgrade_ArnorWallPosternGate
;		RefreshDelay	= 2000
;		Range			= 10
;		AllowSelf		= Yes
;		ObjectFilter	= NONE +ElvenGreenPasture ALLIES
;	End


	Behavior = QueueProductionExitUpdate QueueProductionModuleTag
		UnitCreatePoint		= X:0.0 Y:0.0 Z:0.0
		NaturalRallyPoint	= X:90.0 Y:0.0 Z:0.0
		ExitDelay		= STANDARD_HORDE_EXIT_DELAY
	End

	Behavior            = GettingBuiltBehavior GetBuiltBehaviorTag
		WorkerName	= ElvenWorkerNoSelect_LorienSinger
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
	End

	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
		AutoAcquireEnemiesWhenIdle	= Yes
		MoodAttackCheckRate		= 250
		AILuaEventsList				= GreenPastureFunctions
	End

	;////////////////////////////////
	;/// AI Upgrade Failsafe - Ensures the AI gets the barracks upgraded eventually 
	;////////////////////////////////

	Behavior = ObjectCreationUpgrade ModuleTag_AIBarracksLevel2
		TriggeredBy = Upgrade_ObjectUnderAIControl
		ConflictsWith = Upgrade_WOTRMode Upgrade_EasyAIMultiPlayer
		Permanent = Yes
		Delay = 420000
	;	ThingToSpawn = GondorStatue
		GrantUpgrade = Upgrade_ElvenGreenPastureLevel2
	End

	Behavior = ObjectCreationUpgrade ModuleTag_AIBarracksLevel3
		TriggeredBy = Upgrade_ObjectUnderAIControl
		ConflictsWith = Upgrade_WOTRMode Upgrade_EasyAIMultiPlayer
		Permanent = Yes
		Delay = 600000
	;	ThingToSpawn = GondorStatue
		GrantUpgrade = Upgrade_ElvenGreenPastureLevel3
	End

	;////////////////
	;////////////////

    Behavior = SubObjectsUpgrade ModuleTag_HideAll
		TriggeredBy			= Upgrade_StructureLevel1
		HideSubObjects			= PASRANK2 PASRANK3A PASRANK3B      ;Fence V2
	End

 	Behavior = SubObjectsUpgrade ModuleTag_ShowWalls
		TriggeredBy			= Upgrade_ElvenGreenPastureLevel2
		ShowSubObjects			= PASRANK2   ;Fence ;V1 V1a
		HideSubObjects			= PASRANK3A PASRANK3B     ;V2
	End

	Behavior = SubObjectsUpgrade ModuleTag_ShowPillars
		TriggeredBy			= Upgrade_ElvenGreenPastureLevel3
		ShowSubObjects			= PASRANK2 PASRANK3A PASRANK3B   ;Fence V1 V1a V2
	End

	Behavior = WeaponSetUpgrade ModuleTag_ThirdLevelBuildingArrows
		TriggeredBy			= Upgrade_ElvenGreenPastureLevel3
	End

	Behavior = LevelUpUpgrade ModuleTag_ElvenGreenPastureLevel2
		TriggeredBy    = Upgrade_ElvenGreenPastureLevel2
		LevelsToGain   = 1
		LevelCap       = 2
	End

	Behavior = LevelUpUpgrade ModuleTag_ElvenGreenPastureLevel3
		TriggeredBy    = Upgrade_ElvenGreenPastureLevel3
		LevelsToGain   = 1
		LevelCap       = 3
	End

	Behavior = SpawnBehavior ModuleTag_SpawnPatrols
		TriggeredBy		= Upgrade_StructureLevel1
		SpawnNumber			= 3
		InitialBurst		= 3
		SpawnTemplateName	= ElvenLorienSentry_Patrol ElvenLorienArcher_Patrol
		SpawnReplaceDelay	= 45000;
		CanReclaimOrphans	= Yes
	End

	Behavior = SpawnBehavior ModuleTag_SpawnPatrols2
		TriggeredBy		= Upgrade_ElvenGreenPastureLevel2
		SpawnNumber			= 2
		InitialBurst		= 2
		SpawnTemplateName	= ElvenLorienSentry_Patrol ElvenLorienArcher_Patrol
		SpawnReplaceDelay	= 45000;
		CanReclaimOrphans	= Yes
	End

	Behavior = SpawnBehavior ModuleTag_SpawnPatrols3
		TriggeredBy		= Upgrade_ElvenGreenPastureLevel3
		SpawnNumber			= 1
		InitialBurst		= 1
		SpawnTemplateName	= ElvenLorienSentry_Patrol
		SpawnReplaceDelay	= 45000;
		CanReclaimOrphans	= Yes
	End

	Behavior = SpawnBehavior ModuleTag_SpawnTrees
		TriggeredBy		= Upgrade_StructureLevel1
		SpawnNumber			= 1
		InitialBurst		= 1
		SpawnTemplateName	= LorienBuildingTreeBASE
		SpawnReplaceDelay	= 1450000000;
		CanReclaimOrphans	= Yes
	End

	Behavior = ObjectCreationUpgrade MakeTheFreeHorse1
		TriggeredBy		= Upgrade_StructureLevel1
		Delay			= 32.0
		DestroyWhenSold = Yes
		ThingToSpawn	= HorseGrazing_SlavedforPasture ;HorseGrazing
		;Offset			= X:49.0 Y:-7.0 Z:0
		Offset			= X:21.72 Y:32.458 Z:-0.023
		Angle			= 0 ;90
		FadeInTime		= 8200
	End

	Behavior = ObjectCreationUpgrade MakeTheFreeHorse2
		TriggeredBy		= Upgrade_StructureLevel1
		Delay			= 32.0
		DestroyWhenSold = Yes
		ThingToSpawn	= HorseGrazing_SlavedforPasture ;HorseGrazing
		;Offset			= X:49.0 Y:-7.0 Z:0
		Offset			= X:-33.401 Y:31.763 Z:-0.023
		Angle			= -45 ;0 ;90
		FadeInTime		= 8200
	End

	Behavior = ObjectCreationUpgrade MakeTheFreeHorse3
		TriggeredBy		= Upgrade_StructureLevel1
		Delay			= 32.0
		DestroyWhenSold = Yes
		ThingToSpawn	= HorseGrazing_SlavedforPasture ;HorseGrazing
		;Offset			= X:49.0 Y:-7.0 Z:0
		Offset			= X:33.401 Y:-31.763 Z:-0.023
		Angle			= 90 ;0 ;90
		FadeInTime		= 8200
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowMallornRoots
		TriggeredBy				= Upgrade_MallornTreeRoots
		AddConditionFlags		= UPGRADE_NUMENOR_STONEWORK
	End

	Behavior = CommandSetUpgrade ModueTag_ElvenGreenPastureLevel2CommandSet
	TriggeredBy      = Upgrade_ElvenGreenPastureLevel2
	ConflictsWith    = Upgrade_ElvenGreenPastureLevel3
	CommandSet       = LorienMallornTreeCommandSetPastureLevel2 ; ElvenGreenPastureCommandSetLevel2
	End

	Behavior = CommandSetUpgrade ModueTag_ElvenGreenPastureLevel3CommandSet
	TriggeredBy      = Upgrade_ElvenGreenPastureLevel3
	CommandSet       = LorienMallornTreeCommandSetPastureLevel3 ; ElvenGreenPastureCommandSetLevel3
	End


	Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
		DestructionDelay  = 6500
	End
	
	Behavior                  = StructureCollapseUpdate ModuleTag_06
		MinCollapseDelay        = 000
		MaxCollapseDelay        = 000
		CollapseDamping         = .5
		MaxShudder              = 0.6
		MinBurstDelay           = 250
		MaxBurstDelay           = 800
		BigBurstFrequency       = 4
		CollapseHeight		= 110
		FXList                  = INITIAL   FX_StructureMediumCollapse

	End

	Behavior = BuildingBehavior ModuleTag_Building
		NightWindowName	= N_WINDOW N_GLOW
		;GlowWindowName	=
		;FireWindowName	=
		;FireName		=
	End

	#include "..\..\..\goodfaction\structures\elven\lorienbuildingsubupgrades.inc"

	;-------------------------------------------------------------------------
	; Bonus to Silver Tree Sentinels
	;-------------------------------------------------------------------------
;	Behavior = GrantUpgradeCreate ModuleTag_GrantArmorBonus
;		UpgradeToGrant	= Upgrade_GondorBarracksLevel2
;	End
;	Behavior = AttributeModifierAuraUpdate ModuleTag_SilverTreeSentinels
;		StartsActive	= No
;		TriggeredBy		= Upgrade_GondorBarracksLevel2
;;;		BonusName		= BuildingsSilverTreeLeadership
;		RefreshDelay	= 2000
;		Range			= 200
;		ObjectFilter	= NONE +LorienSilverTreeSentinel +LorienSilverTreeSentinelHorde
;	End
 	;-------------------------------------------------------------------------

	;Behavior = GeometryUpgrade Geom_ModuleTag_HideAll
	;	TriggeredBy		= Upgrade_StructureLevel1
	;	ShowGeometry		= Geom_Orig Geom_So_Weapon_Can_Hit_Us
	;	HideGeometry		= Geom_V1 Geom_V2
	;End
	;Behavior = GeometryUpgrade Geom_ModuleTag_ShowWalls
	;	TriggeredBy		= Upgrade_ElvenGreenPastureLevel2
	;	ShowGeometry		= Geom_Orig Geom_V1
	;	HideGeometry		= Geom_V2 Geom_So_Weapon_Can_Hit_Us
	;End
  	;Behavior = GeometryUpgrade Geom_ModuleTag_ShowFlagsAndTower
	;	TriggeredBy		= Upgrade_ElvenGreenPastureLevel3
	;	ShowGeometry		= Geom_Orig Geom_V1 Geom_V2 Geom_So_Weapon_Can_Hit_Us
	;End

	;// This building is messed up because its extents don't enclose the actual center point of the building.
  	;// Suppose the distance from the center to the closest point on the bounding box 'D'. If a weapon with a damage nugget
  	;// radius smaller than 'D' tries to attack, the partition check in DamageNugget::doEffectPosition will fail because
  	;// it's a strict extent-collison check.
  	;// To get around this, enclose the center point with a 1x1x1 box to guarantee that the object will always be found by the
  	;// partition check.

	Geometry              = CYLINDER
	GeometryMajorRadius   = 70
	GeometryMinorRadius   = 70
	GeometryHeight        = 10
	GeometryOffset		= X:0 Y:0 Z:0
	GeometryIsSmall       = No

	AdditionalGeometry		= CYLINDER
	GeometryName			= Geom_V1
	GeometryMajorRadius		= 45
	GeometryMinorRadius		= 45
	GeometryHeight			= 20
	GeometryOffset			= X:-10 Y:-5 Z:60

	AdditionalGeometry		= CYLINDER
	GeometryName			= Geom_V2
	GeometryMajorRadius		= 17
	GeometryHeight			= 100
	GeometryOffset			= X:-10 Y:-7 Z:0

	Shadow                = SHADOW_VOLUME
	BuildCompletion     	= PLACED_BY_PLAYER

  	GeometryContactPoint	= X:-33		Y:10		Z:0		Repair
	GeometryContactPoint	= X:30		Y:10		Z:0		Repair

End

ChildObject ElvenGreenPastureFoundation ElvenGreenPasture
  Draw = W3DScriptedModelDraw ModuleTag_Draw

    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
	StaticModelLODMode = yes ; If yes, will append M or L to the skin name depending on GameLOD
	DefaultModelConditionState
		Model = ebNmallorn1_pas ;EBStable_SKN
	End

	RandomTexture = ebmaltree.tga	0 ebtree.tga
	RandomTexture = eulorpsnt1.tga	0 eupeasant2_c.tga

	;//	Animation state for build placement cursor
	AnimationState = BUILD_PLACEMENT_CURSOR
		BeginScript
			CurDrawableHideSubObject("PASRANK2")
			CurDrawableHideSubObject("PASRANK3A")
			CurDrawableHideSubObject("PASRANK3B")
		EndScript
	End

	;//	Animation state for phantom structure
	AnimationState = PHANTOM_STRUCTURE
		BeginScript
			CurDrawableHideSubObject("PASRANK2")
			CurDrawableHideSubObject("PASRANK3A")
			CurDrawableHideSubObject("PASRANK3B")
		EndScript
	End


    	IdleAnimationState
			; StateName				=   STATE_Idle
			; Animation = IdleA
				; AnimationName		=	EBStable_SKL.EBStable_IDLA
				; AnimationMode		=	ONCE
				; AnimationPriority		=	30
			; End
			; Animation = IdleB
				; AnimationName		=	EBStable_SKL.EBStable_IDLA
				; AnimationMode		=	ONCE
				; AnimationPriority		=	10
			; End
			; Flags               = RESTART_ANIM_WHEN_COMPLETE
			
		ParticleSysBone = NONE LorienFallingLeaves
		ParticleSysBone = NONE FireFliesLorien

		End

    ;------------ New Build Up States coming soon.
    ModelConditionState = SNOW AWAITING_CONSTRUCTION
		Model	= ebNmallorn0_bld  ;EBMalTree_ASKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
	End
    ModelConditionState   = AWAITING_CONSTRUCTION
      Model               = ebNmallorn0_bldEBMalTree_ASKN
;		ParticleSysBone	  = NONE BuildingDoughnutCloud
    End
    AnimationState        = AWAITING_CONSTRUCTION
      Animation           =  ebNmallorn0_bld  ;EBMalTree_A
        AnimationName     =  ebNmallorn0_bld.ebNmallorn0_bld  ;EBMalTree_ASKL.EBMalTree_ABLD
        AnimationMode     = MANUAL
        AnimationBlendTime = 0
      End
	  Flags				  = START_FRAME_FIRST
    End
	ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Model	= ebNmallorn0_bld   ;EBMalTree_ASKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
	End
    ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
      Model               = ebNmallorn0_bld  ;EBMalTree_ASKN
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		ParticleSysBone = NONE ExpLeavesLorien
    End;
    AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Animation           = ebNmallorn0_bld  ;EBMalTree_A
			AnimationName     = ebNmallorn0_bld.ebNmallorn0_bld  ;EBMalTree_ASKL.EBMalTree_ABLD
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
		End
		Flags				  = START_FRAME_FIRST
		StateName				= BeingConstructed
		BeginScript
			CurDrawablePlaySound("GondorBarracksBeginConstruction")
			CurDrawablePlaySound("LothlorienConstructionSong")
			CurDrawablePlaySound("LothlorienConstruction")
		EndScript
    End

    ;------------ Build Up States -------

    ModelConditionState  = DAMAGED
      Model         = ebNmal1_pas_d1

		ParticleSysBone V1 StableSmokeBuildingMedium
		ParticleSysBone V1 StableFireBuildingMedium

    End

   AnimationState = DAMAGED
		EnteringStateFX	= FX_BuildingDamaged
		ParticleSysBone = NONE LorienBaseLeaves
		ParticleSysBone = NONE Maltreedust
   End

    ModelConditionState  = REALLYDAMAGED
      Model         = ebNmal1_pas_d2
		ParticleSysBone V1 StableSmokeBuildingMedium
		ParticleSysBone V1 StableFireBuildingMedium
		ParticleSysBone V1 StableSmokeBuildingLarge
		ParticleSysBone V1 StableFireBuildingLarge
    End

   	ModelConditionState  = RUBBLE
		Model         = ebNmal1_pas_d2
      	ParticleSysBone SmokeLarge01 SmokeBuildingLarge
   	End

   	AnimationState = RUBBLE
   	 	Animation				=	RubbleAnimation
			AnimationName		=	EBStable_D3SK.EBStable_D3AN
			AnimationMode		=	ONCE
  	 	End
  	 	EnteringStateFX	= FX_StructureMediumCollapse
   	End

  	ModelConditionState  = POST_RUBBLE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
	End
	ModelConditionState  = POST_COLLAPSE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
	End

    ModelConditionState = SNOW
		Model = ebNmallorn1_pas  ;EBStable_SKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
    End

  End
  
;------------Mirror Bonus---------------------- 
  Draw = W3DScriptedModelDraw Draw_BonusEffects
	    DefaultModelConditionState
	      Model = None
	    End
		AnimationState = USER_5 
			ParticleSysBone	= None MirrorofGaladrielMallornSparkle
		End
  End
;--------------- UPGRADES -----
 	//Mallorn Roots
	Draw = W3DScriptedModelDraw ModuleTag_DrawMallornRoots
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model           = None
		End

		//Normal
		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
			Model           = ebNmallorn2_roo  ;ebmalroots_skn
		End
	End
 	//Star-lit Lanterns
	Draw = W3DScriptedModelDraw ModuleTag_DrawStarlitLanterns
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD
		ExtraPublicBone = B_LANTERN01
		ExtraPublicBone = B_LANTERN02
		ExtraPublicBone = B_LANTERN03
		ExtraPublicBone = B_LANTERN04
		ExtraPublicBone = B_LANTERN05


		DefaultModelConditionState
			Model           = None
		End

		//Normal
		ModelConditionState = USER_3
			Model           = ebNmallorn2_lan
		End
	End
 	//Silvan Levy
	Draw = W3DScriptedModelDraw ModuleTag_DrawSilvanLevy
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model           = None
		End

		//Normal
		ModelConditionState = USER_6
			Model           = ebNmallorn2_sil
		End
	End
	Draw = W3DScriptedModelDraw ModuleTag_DrawArrowBones
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD
		ExtraPublicBone = MALARROW01
		ExtraPublicBone = MALARROW02
		ExtraPublicBone = MALARROW03
		ExtraPublicBone = MALARROW04

		DefaultModelConditionState
			Model           = ebNarrows_skn
			WeaponLaunchBone = PRIMARY MALARROW
		End
	End	
  ; Draw module just for the hero FX.
	Draw = W3DScriptedModelDraw TheHealEffect
	    ModelConditionState  = NONE
			Model = None
		End
	    ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED
			Model = None
		End
	End
;------------------------------
  Draw = W3DFloorDraw ModuleTag_DrawFloor
		StaticModelLODMode = Yes		; THIS NEEDS TO BE COMMENTED OUT WHEN ENGINEERING ENABLES LOD'S IN THE FLOOR DRAW
     ModelName = ebNmallorn0_bib ;EBStable_Bib
	WeatherTexture		= SNOWY ebNmallorn_bib_snow.tga ;eblothfort_bib_snow
  End
  PlacementViewAngle  = 0 ;225
  VoiceFullyCreated		= EVA:MallornPasture
	Behavior = CastleMemberBehavior ModuleTag_CMB
	End
	RemoveModule ModuleTag_MoneyProduction
	RemoveModule ModuleTag_MoneyProductionClient
	Behavior = AutoDepositUpdate AutoDepositModuleTag
		DepositTiming       = FOUNDATION_FARM_MONEY_TIME 	   ; in milliseconds
		DepositAmount       = 10   ; cash amount to deposit every DepositTiming
		InitialCaptureBonus = 0  ; no initial bonus
	End		
End



;------------------------------------------------------------------------------
; ElvenGreenPasture aka Elven Stable
ObjectReskin ElvenGreenPasture_Snow ElvenGreenPasture

	SelectPortrait = BPLorienPasture

  ; *** ART Parameters ***
  Draw = W3DScriptedModelDraw ModuleTag_Draw

	ExtraPublicBone = ARROW_01

    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
	StaticModelLODMode = no ; If yes, will append M or L to the skin name depending on GameLOD
	DefaultModelConditionState
		Model = EBStable_S
;		WeaponLaunchBone = PRIMARY ARROW_
	End

    	IdleAnimationState
			StateName			=   STATE_Idle
			Animation = IdleA
				AnimationName		=	EBStable_SKL.EBStable_IDLA
				AnimationMode		=	ONCE
				AnimationPriority	=	30
			End
			Animation = IdleB
				AnimationName		=	EBStable_SKL.EBStable_IDLA
				AnimationMode		=	ONCE
				AnimationPriority	=	10
			End
			Flags               = RESTART_ANIM_WHEN_COMPLETE

		End

	;------------ Build Up States -------
    ModelConditionState   = AWAITING_CONSTRUCTION
      Model               = EBStable_A
;		ParticleSysBone	  = NONE BuildingDoughnutCloud
    End;
    AnimationState        = AWAITING_CONSTRUCTION
      Animation           =  EBStable_A
        AnimationName     =  EBStable_ASKL.EBStable_ABLD
        AnimationMode     = MANUAL
        AnimationBlendTime = 0
      End
	  Flags				  = START_FRAME_FIRST
    End

    ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
      Model               = EBStable_A
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		ParticleSysBone = NONE ExpLeavesLorien
    End;
    AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Animation           = EBStable_A
			AnimationName     = EBStable_ASKL.EBStable_ABLD
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
		End
		Flags				  = START_FRAME_FIRST
		StateName			  = BeingConstructed
    End

    ModelConditionState  = DAMAGED
      Model         = EBStable_D1
		ParticleSysBone FireSmall01 FireBuildingLarge
		ParticleSysBone FireSmall02 FireBuildingMedium
		ParticleSysBone FireSmall03 FireBuildingMedium
		ParticleSysBone FireSmall04 SmokeBuildingLarge
		ParticleSysBone FireSmall05 FireBuildingMedium
		ParticleSysBone FireSmall06 FireBuildingMedium
		ParticleSysBone FireSmall07 SmokeBuildingLarge
    End

   AnimationState = DAMAGED
	EnteringStateFX	= FX_BuildingDamaged
   End

    ModelConditionState  = REALLYDAMAGED
      Model         = EBStable_D2
		ParticleSysBone FireSmall01 FireBuildingLarge
		ParticleSysBone FireSmall02 FireBuildingMedium
		ParticleSysBone FireSmall03 FireBuildingLarge
		ParticleSysBone FireSmall04 FireBuildingLarge
		ParticleSysBone FireSmall05 FireBuildingLarge
		ParticleSysBone FireSmall06 FireBuildingMedium
		ParticleSysBone FireSmall07 SmokeBuildingLarge
		ParticleSysBone FireSmall01 SmokeBuildingLarge
    End

   AnimationState = REALLYDAMAGED
	EnteringStateFX	= FX_BuildingReallyDamaged
   End

    ModelConditionState  = RUBBLE
      Model         = EBStable_D2
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End


  	ModelConditionState  = POST_RUBBLE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
	End
	ModelConditionState  = POST_COLLAPSE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
	End

  End



	; ;----------the door
	; Draw = W3DScriptedModelDraw ModuleTag_02

		; DefaultModelConditionState
			; Model = EBStable_DRC
		; End

		; ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			; Model               = EBStable_DrA
		; End
		; AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			; Animation           =EBStable_DrA
				; AnimationName     = EBStable_DrA.EBStable_DrA
				; AnimationMode     = MANUAL
			; End
			; Flags				  = START_FRAME_FIRST
		; End

		; ; -----opening-----------
		; ModelConditionState   = DOOR_1_OPENING
			; Model               = EBStable_DROA
; ;			ParticleSysBone	  = NONE BuildingDoughnutCloud
		; End
		; AnimationState			=	DOOR_1_OPENING
			; Animation           =	EBStable_DROA
				; AnimationName   =	EBStable_DROA.EBStable_DROA
				; AnimationMode   =	ONCE
; ;				AnimationBlendTime = 0
			; End
		; End
		; ModelConditionState   = DOOR_1_WAITING_OPEN
			; Model               = EBStable_DSOP
; ;			ParticleSysBone	  = NONE BuildingDoughnutCloud
		; End
		; AnimationState			=	DOOR_1_WAITING_OPEN
				; Animation           =	EBStable_DSOP
					; AnimationName   =   EBStable_DSOP.EBStable_DSOP
					; AnimationMode   =	ONCE
					; AnimationBlendTime = 0
				; End
			; ;	Flags				=	START_FRAME_FIRST
		; End


		; ; -----closing-----------
		; ModelConditionState   = DOOR_1_CLOSING
			; Model               = EBStable_DRCA
; ;			ParticleSysBone	  = NONE BuildingDoughnutCloud
		; End;
		; AnimationState			=	DOOR_1_CLOSING
			; Animation           =	EBStable_DRCA
				; AnimationName   =	EBStable_DRCA.EBStable_DRCA
				; AnimationMode   =	ONCE
				; AnimationBlendTime = 0
			; End
		; End


  ; End

	Draw = W3DFloorDraw ModuleTag_DrawFloor
		StaticModelLODMode = No		; THIS NEEDS TO BE COMMENTED OUT WHEN ENGINEERING ENABLES LOD'S IN THE FLOOR DRAW
		ModelName = NONE
  		HideIfModelConditions	=	AWAITING_CONSTRUCTION
  		HideIfModelConditions	=	PARTIALLY_CONSTRUCTED
	End


  ;PlacementViewAngle  = -90

End


ChildObject ElvenGreenPasture_WotR ElvenGreenPasture
  Draw = W3DScriptedModelDraw ModuleTag_Draw

    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
	StaticModelLODMode = yes ; If yes, will append M or L to the skin name depending on GameLOD
	DefaultModelConditionState
		Model = ebNmallorn1_pas ;EBStable_SKN
	End

	RandomTexture = ebmaltree.tga	0 ebtree.tga
	RandomTexture = eulorpsnt1.tga	0 eupeasant2_c.tga

	;//	Animation state for build placement cursor
	AnimationState = BUILD_PLACEMENT_CURSOR
		BeginScript
			CurDrawableHideSubObject("PASRANK2")
			CurDrawableHideSubObject("PASRANK3A")
			CurDrawableHideSubObject("PASRANK3B")
		EndScript
	End

	;//	Animation state for phantom structure
	AnimationState = PHANTOM_STRUCTURE
		BeginScript
			CurDrawableHideSubObject("PASRANK2")
			CurDrawableHideSubObject("PASRANK3A")
			CurDrawableHideSubObject("PASRANK3B")
		EndScript
	End


    	IdleAnimationState
			; StateName				=   STATE_Idle
			; Animation = IdleA
				; AnimationName		=	EBStable_SKL.EBStable_IDLA
				; AnimationMode		=	ONCE
				; AnimationPriority		=	30
			; End
			; Animation = IdleB
				; AnimationName		=	EBStable_SKL.EBStable_IDLA
				; AnimationMode		=	ONCE
				; AnimationPriority		=	10
			; End
			; Flags               = RESTART_ANIM_WHEN_COMPLETE
			
		ParticleSysBone = NONE LorienFallingLeaves
		ParticleSysBone = NONE FireFliesLorien

		End

    ;------------ New Build Up States coming soon.
    ModelConditionState = SNOW AWAITING_CONSTRUCTION
		Model	= ebNmallorn0_bld  ;EBMalTree_ASKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
	End
    ModelConditionState   = AWAITING_CONSTRUCTION
      Model               = ebNmallorn0_bldEBMalTree_ASKN
;		ParticleSysBone	  = NONE BuildingDoughnutCloud
    End
    AnimationState        = AWAITING_CONSTRUCTION
      Animation           =  ebNmallorn0_bld  ;EBMalTree_A
        AnimationName     =  ebNmallorn0_bld.ebNmallorn0_bld  ;EBMalTree_ASKL.EBMalTree_ABLD
        AnimationMode     = MANUAL
        AnimationBlendTime = 0
      End
	  Flags				  = START_FRAME_FIRST
    End
	ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Model	= ebNmallorn0_bld   ;EBMalTree_ASKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
	End
    ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
      Model               = ebNmallorn0_bld  ;EBMalTree_ASKN
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		ParticleSysBone = NONE ExpLeavesLorien
    End;
    AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Animation           = ebNmallorn0_bld  ;EBMalTree_A
			AnimationName     = ebNmallorn0_bld.ebNmallorn0_bld  ;EBMalTree_ASKL.EBMalTree_ABLD
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
		End
		Flags				  = START_FRAME_FIRST
		StateName				= BeingConstructed
		BeginScript
			CurDrawablePlaySound("GondorBarracksBeginConstruction")
			CurDrawablePlaySound("LothlorienConstructionSong")
			CurDrawablePlaySound("LothlorienConstruction")
		EndScript
    End

    ;------------ Build Up States -------

    ModelConditionState  = DAMAGED
      Model         = ebNmal1_pas_d1

		ParticleSysBone V1 StableSmokeBuildingMedium
		ParticleSysBone V1 StableFireBuildingMedium

    End

   AnimationState = DAMAGED
		EnteringStateFX	= FX_BuildingDamaged
		ParticleSysBone = NONE LorienBaseLeaves
		ParticleSysBone = NONE Maltreedust
   End

    ModelConditionState  = REALLYDAMAGED
      Model         = ebNmal1_pas_d2
		ParticleSysBone V1 StableSmokeBuildingMedium
		ParticleSysBone V1 StableFireBuildingMedium
		ParticleSysBone V1 StableSmokeBuildingLarge
		ParticleSysBone V1 StableFireBuildingLarge
    End

   	ModelConditionState  = RUBBLE
		Model         = ebNmal1_pas_d2
      	ParticleSysBone SmokeLarge01 SmokeBuildingLarge
   	End

   	AnimationState = RUBBLE
   	 	Animation				=	RubbleAnimation
			AnimationName		=	EBStable_D3SK.EBStable_D3AN
			AnimationMode		=	ONCE
  	 	End
  	 	EnteringStateFX	= FX_StructureMediumCollapse
   	End

  	ModelConditionState  = POST_RUBBLE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
	End
	ModelConditionState  = POST_COLLAPSE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
	End

    ModelConditionState = SNOW
		Model = ebNmallorn1_pas  ;EBStable_SKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
    End

  End
  
;------------Mirror Bonus---------------------- 
  Draw = W3DScriptedModelDraw Draw_BonusEffects
	    DefaultModelConditionState
	      Model = None
	    End
		AnimationState = USER_5 
			ParticleSysBone	= None MirrorofGaladrielMallornSparkle
		End
  End
;--------------- UPGRADES -----
 	//Mallorn Roots
	Draw = W3DScriptedModelDraw ModuleTag_DrawMallornRoots
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model           = None
		End

		//Normal
		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
			Model           = ebNmallorn2_roo  ;ebmalroots_skn
		End
	End
 	//Star-lit Lanterns
	Draw = W3DScriptedModelDraw ModuleTag_DrawStarlitLanterns
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD
		ExtraPublicBone = B_LANTERN01
		ExtraPublicBone = B_LANTERN02
		ExtraPublicBone = B_LANTERN03
		ExtraPublicBone = B_LANTERN04
		ExtraPublicBone = B_LANTERN05


		DefaultModelConditionState
			Model           = None
		End

		//Normal
		ModelConditionState = USER_3
			Model           = ebNmallorn2_lan
		End
	End
 	//Silvan Levy
	Draw = W3DScriptedModelDraw ModuleTag_DrawSilvanLevy
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model           = None
		End

		//Normal
		ModelConditionState = USER_6
			Model           = ebNmallorn2_sil
		End
	End
	Draw = W3DScriptedModelDraw ModuleTag_DrawArrowBones
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD
		ExtraPublicBone = MALARROW01
		ExtraPublicBone = MALARROW02
		ExtraPublicBone = MALARROW03
		ExtraPublicBone = MALARROW04

		DefaultModelConditionState
			Model           = ebNarrows_skn
			WeaponLaunchBone = PRIMARY MALARROW
		End
	End	
  ; Draw module just for the hero FX.
	Draw = W3DScriptedModelDraw TheHealEffect
	    ModelConditionState  = NONE
			Model = None
		End
	    ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED
			Model = None
		End
	End
;------------------------------
  Draw = W3DFloorDraw ModuleTag_DrawFloor
		StaticModelLODMode = Yes		; THIS NEEDS TO BE COMMENTED OUT WHEN ENGINEERING ENABLES LOD'S IN THE FLOOR DRAW
     ModelName = ebNmallorn0_bib ;EBStable_Bib
	WeatherTexture		= SNOWY ebNmallorn_bib_snow.tga ;eblothfort_bib_snow
  End
;	RemoveModule ModuleTag_SoWeCanUseWeapon
	CommandSet =  LorienMallornTreeCommandSetPastureWotR
	Behavior = CommandSetUpgrade ModuleTag_SerfActivation
		TriggeredBy		= Upgrade_MenWallRegularGate
		CommandSet		= LorienMallornTreeCommandSetPastureWotR_NCS
	End
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
		SpecialPowerTemplate = SpecialAbilityForcedSerivce
		TriggeredBy = Upgrade_StructureLevel1
	End
	BuildCost				= 500
	MaxSimultaneousOfType		= 1
	VoiceFullyCreated		= EVA:MallornPasture
	RemoveModule ModuleTag_MoneyProduction
	RemoveModule ModuleTag_MoneyProductionClient
	RemoveModule ModuleTag_ElvenGiftBonus
	RemoveModule ModuleTag_SpawnMoreCommandPoints
	Body                = StructureBody ModuleTag_05
		MaxHealth         = GONDOR_BARRACKS_HEALTH
		MaxHealthDamaged  = GONDOR_BARRACKS_HEALTH_DAMAGED
		MaxHealthReallyDamaged = GONDOR_BARRACKS_HEALTH_REALLY_DAMAGED

		DamageCreationList = OCL_BuildingDamageList01 CATAPULT_ROCK

		; DamageCreationList = OCL_RBBarracks_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
		; DamageCreationList = OCL_RBBarracks_Chunk2 CATAPULT_ROCK BACK_DESTROYED
		; DamageCreationList = OCL_RBBarracks_Chunk3 CATAPULT_ROCK RIGHT_DESTROYED
		; DamageCreationList = OCL_RBBarracks_Chunk4 CATAPULT_ROCK LEFT_DESTROYED

	End
	
	ArmorSet
		Conditions        = None
		Armor             = FactoryArmor
	End

End

ChildObject ElvenGreenPastureFoundation_WotR ElvenGreenPasture
  Draw = W3DScriptedModelDraw ModuleTag_Draw

    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes
	StaticModelLODMode = yes ; If yes, will append M or L to the skin name depending on GameLOD
	DefaultModelConditionState
		Model = ebNmallorn1_pas ;EBStable_SKN
	End

	RandomTexture = ebmaltree.tga	0 ebtree.tga
	RandomTexture = eulorpsnt1.tga	0 eupeasant2_c.tga

	;//	Animation state for build placement cursor
	AnimationState = BUILD_PLACEMENT_CURSOR
		BeginScript
			CurDrawableHideSubObject("PASRANK2")
			CurDrawableHideSubObject("PASRANK3A")
			CurDrawableHideSubObject("PASRANK3B")
		EndScript
	End

	;//	Animation state for phantom structure
	AnimationState = PHANTOM_STRUCTURE
		BeginScript
			CurDrawableHideSubObject("PASRANK2")
			CurDrawableHideSubObject("PASRANK3A")
			CurDrawableHideSubObject("PASRANK3B")
		EndScript
	End


    	IdleAnimationState
			; StateName				=   STATE_Idle
			; Animation = IdleA
				; AnimationName		=	EBStable_SKL.EBStable_IDLA
				; AnimationMode		=	ONCE
				; AnimationPriority		=	30
			; End
			; Animation = IdleB
				; AnimationName		=	EBStable_SKL.EBStable_IDLA
				; AnimationMode		=	ONCE
				; AnimationPriority		=	10
			; End
			; Flags               = RESTART_ANIM_WHEN_COMPLETE
			
		ParticleSysBone = NONE LorienFallingLeaves
		ParticleSysBone = NONE FireFliesLorien

		End

    ;------------ New Build Up States coming soon.
    ModelConditionState = SNOW AWAITING_CONSTRUCTION
		Model	= ebNmallorn0_bld  ;EBMalTree_ASKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
	End
    ModelConditionState   = AWAITING_CONSTRUCTION
      Model               = ebNmallorn0_bldEBMalTree_ASKN
;		ParticleSysBone	  = NONE BuildingDoughnutCloud
    End
    AnimationState        = AWAITING_CONSTRUCTION
      Animation           =  ebNmallorn0_bld  ;EBMalTree_A
        AnimationName     =  ebNmallorn0_bld.ebNmallorn0_bld  ;EBMalTree_ASKL.EBMalTree_ABLD
        AnimationMode     = MANUAL
        AnimationBlendTime = 0
      End
	  Flags				  = START_FRAME_FIRST
    End
	ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Model	= ebNmallorn0_bld   ;EBMalTree_ASKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
	End
    ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
      Model               = ebNmallorn0_bld  ;EBMalTree_ASKN
		ParticleSysBone   = CONSTDUSTBONE01 BuildingContructDust FollowBone:Yes
		ParticleSysBone = NONE ExpLeavesLorien
    End;
    AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Animation           = ebNmallorn0_bld  ;EBMalTree_A
			AnimationName     = ebNmallorn0_bld.ebNmallorn0_bld  ;EBMalTree_ASKL.EBMalTree_ABLD
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
		End
		Flags				  = START_FRAME_FIRST
		StateName				= BeingConstructed
		BeginScript
			CurDrawablePlaySound("GondorBarracksBeginConstruction")
			CurDrawablePlaySound("LothlorienConstructionSong")
			CurDrawablePlaySound("LothlorienConstruction")
		EndScript
    End

    ;------------ Build Up States -------

    ModelConditionState  = DAMAGED
      Model         = ebNmal1_pas_d1

		ParticleSysBone V1 StableSmokeBuildingMedium
		ParticleSysBone V1 StableFireBuildingMedium

    End

   AnimationState = DAMAGED
		EnteringStateFX	= FX_BuildingDamaged
		ParticleSysBone = NONE LorienBaseLeaves
		ParticleSysBone = NONE Maltreedust
   End

    ModelConditionState  = REALLYDAMAGED
      Model         = ebNmal1_pas_d2
		ParticleSysBone V1 StableSmokeBuildingMedium
		ParticleSysBone V1 StableFireBuildingMedium
		ParticleSysBone V1 StableSmokeBuildingLarge
		ParticleSysBone V1 StableFireBuildingLarge
    End

   	ModelConditionState  = RUBBLE
		Model         = ebNmal1_pas_d2
      	ParticleSysBone SmokeLarge01 SmokeBuildingLarge
   	End

   	AnimationState = RUBBLE
   	 	Animation				=	RubbleAnimation
			AnimationName		=	EBStable_D3SK.EBStable_D3AN
			AnimationMode		=	ONCE
  	 	End
  	 	EnteringStateFX	= FX_StructureMediumCollapse
   	End

  	ModelConditionState  = POST_RUBBLE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
	End
	ModelConditionState  = POST_COLLAPSE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
	End

    ModelConditionState = SNOW
		Model = ebNmallorn1_pas  ;EBStable_SKN
		Texture = ebNgoldtree.tga ebNgoldtree_snow.tga
		Texture = ebNmallornA.tga ebNmallornA_snow.tga
    End

  End
  
;------------Mirror Bonus---------------------- 
  Draw = W3DScriptedModelDraw Draw_BonusEffects
	    DefaultModelConditionState
	      Model = None
	    End
		AnimationState = USER_5 
			ParticleSysBone	= None MirrorofGaladrielMallornSparkle
		End
  End
;--------------- UPGRADES -----
 	//Mallorn Roots
	Draw = W3DScriptedModelDraw ModuleTag_DrawMallornRoots
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model           = None
		End

		//Normal
		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
			Model           = ebNmallorn2_roo  ;ebmalroots_skn
		End
	End
 	//Star-lit Lanterns
	Draw = W3DScriptedModelDraw ModuleTag_DrawStarlitLanterns
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD
		ExtraPublicBone = B_LANTERN01
		ExtraPublicBone = B_LANTERN02
		ExtraPublicBone = B_LANTERN03
		ExtraPublicBone = B_LANTERN04
		ExtraPublicBone = B_LANTERN05


		DefaultModelConditionState
			Model           = None
		End

		//Normal
		ModelConditionState = USER_3
			Model           = ebNmallorn2_lan
		End
	End
 	//Silvan Levy
	Draw = W3DScriptedModelDraw ModuleTag_DrawSilvanLevy
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model           = None
		End

		//Normal
		ModelConditionState = USER_6
			Model           = ebNmallorn2_sil
		End
	End
	Draw = W3DScriptedModelDraw ModuleTag_DrawArrowBones
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD
		ExtraPublicBone = MALARROW01
		ExtraPublicBone = MALARROW02
		ExtraPublicBone = MALARROW03
		ExtraPublicBone = MALARROW04

		DefaultModelConditionState
			Model           = ebNarrows_skn
			WeaponLaunchBone = PRIMARY MALARROW
		End
	End	
  ; Draw module just for the hero FX.
	Draw = W3DScriptedModelDraw TheHealEffect
	    ModelConditionState  = NONE
			Model = None
		End
	    ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED
			Model = None
		End
	End
;------------------------------
  Draw = W3DFloorDraw ModuleTag_DrawFloor
		StaticModelLODMode = Yes		; THIS NEEDS TO BE COMMENTED OUT WHEN ENGINEERING ENABLES LOD'S IN THE FLOOR DRAW
     ModelName = ebNmallorn0_bib ;EBStable_Bib
	WeatherTexture		= SNOWY ebNmallorn_bib_snow.tga ;eblothfort_bib_snow
  End
	PlacementViewAngle  = 0 ;225
	VoiceFullyCreated		= EVA:MallornPasture
	Behavior = CastleMemberBehavior ModuleTag_CMB
	End
	CommandSet =  LorienMallornTreeCommandSetPastureWotR
	Behavior = CommandSetUpgrade ModuleTag_SerfActivation
		TriggeredBy		= Upgrade_MenWallRegularGate
		CommandSet		= LorienMallornTreeCommandSetPastureWotR_NCS
	End
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
		SpecialPowerTemplate = SpecialAbilityForcedSerivce
		TriggeredBy = Upgrade_StructureLevel1
	End
	BuildCost				= 500
	MaxSimultaneousOfType		= 1
	RemoveModule ModuleTag_MoneyProduction
	RemoveModule ModuleTag_MoneyProductionClient
	RemoveModule ModuleTag_ElvenGiftBonus
	RemoveModule ModuleTag_SpawnMoreCommandPoints
	Body                = StructureBody ModuleTag_05
		MaxHealth         = GONDOR_BARRACKS_HEALTH
		MaxHealthDamaged  = GONDOR_BARRACKS_HEALTH_DAMAGED
		MaxHealthReallyDamaged = GONDOR_BARRACKS_HEALTH_REALLY_DAMAGED

		DamageCreationList = OCL_BuildingDamageList01 CATAPULT_ROCK

		; DamageCreationList = OCL_RBBarracks_Chunk1 CATAPULT_ROCK FRONT_DESTROYED
		; DamageCreationList = OCL_RBBarracks_Chunk2 CATAPULT_ROCK BACK_DESTROYED
		; DamageCreationList = OCL_RBBarracks_Chunk3 CATAPULT_ROCK RIGHT_DESTROYED
		; DamageCreationList = OCL_RBBarracks_Chunk4 CATAPULT_ROCK LEFT_DESTROYED

	End
	
	ArmorSet
		Conditions        = None
		Armor             = FactoryArmor
	End

End