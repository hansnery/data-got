//------------------------------------------------------------------------------
// This is the magic thing in the .bse file that tells how to center the base layout compared to the game position of the fortress
Object ArnorFortressCenterGeneric	
	
	SelectPortrait = uparthedainfortress ;BPGFortress
	
	Draw = W3DScriptedModelDraw ModuleTag_01

    	DefaultModelConditionState
      		Model = None
    	End
    	
		ModelConditionState = WORLD_BUILDER
			Model = NBasePin
		End
	End
	
	
	Side = Arnor
	EditorSorting = STRUCTURE
	KindOf = IMMOBILE BASE_FOUNDATION CASTLE_CENTER ;;,;; Removed CAN_CAST_REFLECTIONS CAN_CAST_REFLECTIONS
  
	Behavior = CastleBehavior ModuleTag_castle
		FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER		;Anything that does not fit this filter will be given to the neutral player, so the template can have rocks and props.
	End  
End

//------------------------------------------------------------------------------
// These are the four corner buildplots.  Difference is just the BuildVariation flag they give the Expansion.
Object ArnorFortressExpansionPadCorner
	
	SelectPortrait = uparthedainbuildplot ;BPGFortress_BuildPlot
	
	// *** ART Parameters ***
	Draw = W3DFloorDraw DrawFloorBase  
		ModelName = abafoundationb
	End
		
	Draw = W3DScriptedModelDraw ModuleTag_DrawMain
		DefaultModelConditionState
			Model = WBFoundationP
		End
		;//Remove the buildplot when it's been constructed on
		ModelConditionState = CONSTRUCTION_COMPLETE
			Model = None
		End	
	End

	//PlacementViewAngle  = 0

	// ***DESIGN parameters ***
	DisplayName         = OBJECT:ArthedainBuildingFoundation
	Side                = Arnor
	EditorSorting       = STRUCTURE
	ThreatLevel			= 1.0

	BuildCost           = 1
	BuildTime           = 5.0          // in seconds
	VisionRange         = 0.0          // Shroud clearing distance
	ShroudClearingRange = 0

	CommandSet = ArnorFortressExpansionPadCornerCommandSet

	// *** AUDIO Parameters ***
	VoiceSelect = Gui_PlotSelect	;GondorCitadelSelect	;MenFortressSelect


	// *** ENGINEERING Parameters ***	
	KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION UNATTACKABLE MP_COUNT_FOR_VICTORY NO_COLLIDE DO_NOT_CLASSIFY EXPANSION_PAD ;;,;; Removed CAN_CAST_REFLECTIONS

	Behavior            = FoundationAIUpdate ModuleTag_foundationAI
		BuildVariation = 2 // Will give BUILD_VARIATION_TWO to anything built on it
	End

	Behavior = CastleMemberBehavior ModuleTag_CMB
	End 

	Body                = ImmortalBody ModuleTag_05
		MaxHealth         = 15000.0
	End

	Geometry              = BOX
	GeometryMajorRadius   = 5.0
	GeometryMinorRadius   = 5.0
	GeometryHeight        = 0.8
	GeometryIsSmall       = No
	Shadow                = SHADOW_VOLUME
	BuildCompletion		= PLACED_BY_PLAYER
End


//------------------------------------------------------------------------------
// And these are the 2 on the sides.
ChildObject ArnorFortressExpansionPadSide ArnorFortressExpansionPadCorner 

;	Draw = W3DScriptedModelDraw ModuleTag_DrawMain
;		DefaultModelConditionState
;			Model = GBFoundationB //GBFoundationA
;		End
;	End

	CommandSet = ArnorFortressExpansionPadSideCommandSet

	Behavior            = FoundationAIUpdate ModuleTag_foundationAI
		BuildVariation = 1 // Will give BUILD_VARIATION_ONE to anything built on it
	End
End

//------------------------------------------------------------------------------
// This is the center part of the full Fortress.  This plus the buildplots make up the full fortress
Object ArnorFortressCitadel			
	
	// *** ART Parameters ***  
	ButtonImage		= uiarthedfortress ;BGFortress
	SelectPortrait  = uparthedainfortress ;BPGFortress

	Draw = W3DScriptedModelDraw ModuleTag_MainDraw
		ExtraPublicBone 		= ARROW01
		ExtraPublicBone 		= ARROW02
		ExtraPublicBone 		= ARROW03
		ExtraPublicBone 		= ARROW04
		ExtraPublicBone 		= ARROW05
		ExtraPublicBone 		= ARROW06
		ExtraPublicBone 		= ARROW07
		ExtraPublicBone 		= ARROW08
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes // Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model				= abarnorfort_skn ;GBFortress
			WeaponLaunchBone	= PRIMARY ARROW
		End
		
		;//	Animation state for build placement cursor
		AnimationState = BUILD_PLACEMENT_CURSOR
			BeginScript
   				CurDrawableHideSubObject("ELENDILI")
   				CurDrawableHideSubObject("KEEPERS")
				CurDrawableHideSubObject("PALANTIRI")
   				CurDrawableHideSubObject("MUSTER")
   				CurDrawableHideSubObject("STARS")
			EndScript
		End
		
		;//	Animation state for phantom structure
		AnimationState = PHANTOM_STRUCTURE
			BeginScript
   				CurDrawableHideSubObject("ELENDILI")
   				CurDrawableHideSubObject("KEEPERS")
   				CurDrawableHideSubObject("MUSTER")
   				CurDrawableHideSubObject("STARS")
				CurDrawableHideSubObject("PALANTIRI")
			EndScript
		End
		
    IdleAnimationState	
	End		
		
		//--Damage States---
		ModelConditionState  = DAMAGED USER_10
			Model		= abarnorfort_d1 ;GBFortress
	  	ParticleSysBone   	= TORCH01 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH01 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH02 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH02 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH03 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH03 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH04 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH04 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH05 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH05 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH06 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH06 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH07 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH07 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH08 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH08 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		End
		
		AnimationState = DAMAGED USER_10
			EnteringStateFX	= FX_FortressDamaged			
		End

		ModelConditionState  = REALLYDAMAGED USER_10
			Model         = abarnorfort_d2 ;GBFortress_D2
	  	ParticleSysBone   	= TORCH01 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH01 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH02 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH02 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH03 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH03 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH04 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH04 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH05 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH05 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH06 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH06 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH07 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH07 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH08 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH08 OrcBarracksTorchFireNoSmoke FollowBone:Yes			
		End

		AnimationState	= REALLYDAMAGED USER_10
			EnteringStateFX	= FX_FortressReallyDamaged
		End

		ModelConditionState  = RUBBLE USER_10
			Model         = abarnorfort_d2 ;GBFortress_D3
		ParticleSysBone   	= TORCH01 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH01 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH02 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH02 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH03 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH03 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH04 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH04 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH05 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH05 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH06 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH06 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH07 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH07 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH08 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH08 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		End
    
		AnimationState	= RUBBLE USER_10
			EnteringStateFX	= FX_FortressCollapse		
		End
		
		ModelConditionState  = DAMAGED
			Model		= abarnorfort_d1 ;GBFortress
		End
		
		AnimationState = DAMAGED
			EnteringStateFX	= FX_FortressDamaged			
		End

		ModelConditionState  = REALLYDAMAGED
			Model         = abarnorfort_d2 ;GBFortress_D2			
		End

		AnimationState	= REALLYDAMAGED		
			EnteringStateFX	= FX_FortressReallyDamaged
		End

		ModelConditionState  = RUBBLE
			Model         = abarnorfort_d2 ;GBFortress_D3
		End
    
		AnimationState	= RUBBLE
			EnteringStateFX	= FX_FortressCollapse		
		End
    ModelConditionState = USER_10 SNOW
		Model				= abarnorfort_skn ;GBFortress
		WeaponLaunchBone	= PRIMARY ARROW_
		Texture = abarnor01.tga abarnor01_snow.tga
	  	ParticleSysBone   	= TORCH01 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH01 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH02 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH02 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH03 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH03 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH04 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH04 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH05 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH05 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH06 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH06 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH07 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH07 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH08 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH08 OrcBarracksTorchFireNoSmoke FollowBone:Yes		
	End			

    ModelConditionState = USER_10
		Model				= abarnorfort_skn ;GBFortress
		WeaponLaunchBone	= PRIMARY ARROW_
	  	ParticleSysBone   	= TORCH01 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH01 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH02 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH02 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH03 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH03 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH04 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH04 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH05 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH05 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH06 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH06 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH07 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH07 OrcBarracksTorchFireNoSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH08 OrcBarracksTorchSmoke FollowBone:Yes
		ParticleSysBone   	= TORCH08 OrcBarracksTorchFireNoSmoke FollowBone:Yes		
	End		
		
		//---Snow---
		ModelConditionState = SNOW
			Model			= abarnorfort_skn ;GBFortress
			Texture = abarnor01.tga abarnor01_snow.tga
	    End

	End
	
	;//Fortress Door
	Draw = W3DScriptedModelDraw ModuleTag_DrawDoor

		DefaultModelConditionState
			Model = abfortg_skn
		End
;
		//--normal states
		ModelConditionState   = DOOR_1_OPENING SNOW
			Model               = abfortg_skn
			Texture = abarnor01.tga abarnor01_snow.tga
		End
		ModelConditionState   = DOOR_1_OPENING
			Model               = abfortg_skn
		End

		AnimationState			=	DOOR_1_OPENING
			Animation           =	DBFDoor_DRO
				AnimationName   =	abfortg_skn.abfortg_skn
				AnimationMode   =	ONCE
				AnimationBlendTime = 0
			End
		End

		ModelConditionState   = DOOR_1_CLOSING SNOW
			Model               = abfortg_skn
			Texture = abarnor01.tga abarnor01_snow.tga
				ParticleSysBone	  = NONE trollCageDust
			End
		ModelConditionState   = DOOR_1_CLOSING
			Model               = abfortg_skn
				ParticleSysBone	  = NONE trollCageDust
			End;

   			AnimationState			=	DOOR_1_CLOSING
				Animation           =	abfortg_skn
					AnimationName   =	abfortg_skn.abfortg_skn
					AnimationMode   =	ONCE_BACKWARDS
					AnimationBlendTime = 0
				End
				Flags = START_FRAME_LAST
		End


		ModelConditionState   = DOOR_1_WAITING_OPEN SNOW
		Model               = abfortg_open
		Texture = abarnor01.tga abarnor01_snow.tga
		End

		ModelConditionState   = DOOR_1_WAITING_OPEN
		Model               = abfortg_open
		End

		AnimationState			=	DOOR_1_WAITING_OPEN
				Animation           =	abfortg_open
					AnimationName   =  none
					AnimationMode   =	ONCE
					AnimationBlendTime = 0
				End
		End

		ModelConditionState  = POST_RUBBLE
			Model         = None
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
		
		ModelConditionState = SNOW
			Model			= abfortg_skn ;GBFortress
			Texture = abarnor01.tga abarnor01_snow.tga
	    End		
		
	End	

	//----------the Bib
    Draw = W3DFloorDraw ModuleTag_DrawFloor    
  		ModelName		= abarnorfort_bib
  		WeatherTexture SNOWY abfortress_bib_snow.tga
	End

	// ***DESIGN parameters ***
	DisplayName         = OBJECT:MenFortress
	Side                = Arnor
	EditorSorting       = STRUCTURE
	ThreatLevel			= 1.0
	CommandPointBonus	= GENERIC_FORTRESS_COMMAND_POINT_BONUS
	
	MaxSimultaneousOfType = 5 ;;,;; Added for 2.02

	BuildCost           = 5000 ;MEN_FORTRESS_BUILDCOST
	BuildTime           = MEN_FORTRESS_BUILDTIME
	BountyValue	    	= MEN_FORTRESS_BOUNTY_VALUE ;;,;; added for 2.02
	VisionRange         = MEN_FORTRESS_VISION_RANGE      
	ShroudClearingRange = MEN_FORTRESS_SHROUD_CLEAR

	WeaponSet
		Weapon				= PRIMARY FortressArrowTowerBow
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End 

	ArmorSet
		Conditions        = None
		Armor             = FortressArmor
	;	DamageFX          = StructureDamageFXNoShake
	End

	CommandSet				= ArthedainFortressCommandSet

 
	; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	EvaEventDieOwner 				= EvaFortressDie
	EvaEventDieAlly                 = AllyCampDestroyed ;,; Added in v5.1
    EvaEventDieEnemy                = EnemyCampDestroyed ;,; Added in v5.1


	VoiceSelect         			= MenFortressSelect
	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

	UnitSpecificSounds
		UnderConstruction			= BuildingBigConstructionLoop	;// Built first time
		;//UnderRepairFromDamage	= NoSound						;// Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble		= BuildingBigConstructionLoop	;// Repaired from completely destroyed (not used???)
	End

	CampnessValue = CAMPNESS_FORTRESS

	; *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
 	KindOf				= PRELOAD COMMANDCENTER VITAL_FOR_BASE_SURVIVAL STRUCTURE IMMOBILE CASTLE_KEEP MP_COUNT_FOR_VICTORY SELECTABLE FS_FACTORY AUTO_RALLYPOINT MADE_OF_WOOD SCORE DOZER_FACTORY ;;,;; Removed CAN_CAST_REFLECTIONS

	Behavior            = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
		WorkerName	= GondorFortressWorkerNoSelect ;;,;; GondorWorkerNoSelect
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
	End

     Behavior = CastleMemberBehavior ModuleTag_CMB
		BeingBuiltSound = BuildingBigConstructionLoop
     End 

	;-----------------------------------------------
	;Used for hero revival and initial construction 

	Behavior = SubObjectsUpgrade ModuleTag_ShowBanners
		TriggeredBy		= Upgrade_ArnorFortressBanners
		ShowSubObjects	= ELENDILI
	End 
	// Banners improvement, the half that gives an aura bonus, not the purchase discount part (that is in the ProductionUpdate)
	Behavior = AttributeModifierAuraUpdate ModuleTag_BannerDebuff
		StartsActive	= No ;If no, requires upgrade to turn on.
		BonusName		= GenericDebuff
		TriggeredBy		= Upgrade_ArnorFortressBanners
		RefreshDelay	= 2000
		Range			= 300
		TargetEnemy		= Yes
		ObjectFilter	= AOTR_GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
	End	
	Behavior = ProductionUpdate ProductionUpdateModuleTag
		ProductionModifier		; An object-local discount.  
			RequiredUpgrade = Upgrade_ArnorFortressBanners 
			CostMultiplier = 0.80
			ModifierFilter = NONE +MenPorter
		End
		ProductionModifier		
			RequiredUpgrade = Upgrade_ArnorFortressBanners 
			CostMultiplier = 0.90
			TimeMultiplier = 0.90
			HeroPurchase = Yes	; Instead of an object filter, needs to be explicitly hero-revival-system compatible
			ModifierFilter = NONE +HERO
		End

  		NumDoorAnimations            = 1
		DoorOpeningTime              = 3000  ;in mSeconds how long you want doors to be in open state
		DoorWaitOpenTime             = 3000  ;in mSeconds time the door stays open, so units can exit
		DoorCloseTime                = 3000  ;in mSeconds how long you want doors to be in open state		
	End
	Behavior = QueueProductionExitUpdate ModuleTag_QueuePEU
		UnitCreatePoint   = X:0.0 Y:0.0 Z:0.0
		NaturalRallyPoint = X:80.0 Y:0.0 Z:0.0;NaturalRallyPointX must always match GeometryMajorRadius!
		ExitDelay = 400 ; Mainly for the multiple produced Red Guard.  Make them come out one at a time.
	End  
	;-----------------------------------------------

	Body                = StructureBody ModuleTag_05
		MaxHealth         = MEN_FORTRESS_HEALTH
		MaxHealthDamaged        = MEN_FORTRESS_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= MEN_FORTRESS_HEALTH_REALLY_DAMAGED
	End
 
	Behavior                  = StructureCollapseUpdate ModuleTag_08
		MinCollapseDelay        = 000
		MaxCollapseDelay        = 000
		CollapseDamping         = .5
		MaxShudder              = 0.6
		MinBurstDelay           = 250
		MaxBurstDelay           = 800
		BigBurstFrequency       = 4
		FXList                  = INITIAL   FX_FortressCollapse
		;FXList                  = ALMOST_FINAL  FX_FortressCollapse
		DestroyObjectWhenDone	= Yes
		CollapseHeight			= 155
	End

	Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
		PassengerFilter						= GENERIC_FACTION_SLAUGHTERABLE
		ObjectStatusOfContained				= UNSELECTABLE ENCLOSED
		CashBackPercent						= 200%		
		ContainMax              			= 99; give it a huge capacity, just in case player sends his whole army in at once
		AllowEnemiesInside					= No
		AllowAlliesInside					= No
 		AllowNeutralInside					= No
 		AllowOwnPlayerInsideOverride		= Yes
		EnterSound							= MordorSlaughterhouseEnterSound
		EntryOffset							= X:125.0 Y:0.0 Z:0.0
		EntryPosition						= X:30.0 Y:0.0 Z:0.0		// entry position needs to be offset from the root transform, otherwise fortress obscures point.

		ExitOffset							= X:125.0 Y:0.0 Z:0.0
		StatusForRingEntry					= HOLDING_THE_RING
		;StatusForRingEntry				= USER_DEFINED_2		
		UpgradeForRingEntry					= Upgrade_RingHero Upgrade_FortressRingHero ;;,;; CE graphics fix
		ObjectToDestroyForRingEntry			= NONE +TheDroppedRing
		FXForRingEntry						= FX_OneRingFlare
	End

	// Hide all the Improvements by default
	Behavior = SubObjectsUpgrade ModuleTag_HideAll
		TriggeredBy		= Upgrade_StructureLevel1
		HideSubObjects	= ELENDILI KEEPERS PALANTIRI MUSTER TORCH01 TORCH02 TORCH03 TORCH04 TORCH05 TORCH06 TORCH07 TORCH08 STARS LINE04 LINE05
	End
	;-----------------------------------------------
	Behavior = ModelConditionUpgrade ModuleTag_ShowWeaponRacksStewardNew
		TriggeredBy				= Upgrade_DwarvenFortressSiegeKegs
		AddConditionFlags		= USER_10
		AddTempConditionFlag	= ModelConditionState:USER_11 //For buildup
		TempConditionTime		= 7.0						 //try to matc
		Permanent			= Yes
	End
	Behavior = SubObjectsUpgrade ModuleTag_ShowMuster
		TriggeredBy		= Upgrade_DwarvenFortressSiegeKegs
		ShowSubObjects	= MUSTER TORCH01 TORCH02 TORCH03 TORCH04 TORCH05 TORCH06 TORCH07 TORCH08
	End
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_MusteringGroundsEnabler
		SpecialPowerTemplate	= SpecialAbilityMordorFortressMorgulSpireStructure
		TriggeredBy				= Upgrade_DwarvenFortressSiegeKegs
	End	
	Behavior = SpecialPowerModule ModuleTag_DraftSummonStarter
		SpecialPowerTemplate		= SpecialAbilityMordorFortressMorgulSpireStructure
		StartsPaused			= Yes
		UpdateModuleStartsAttack	= Yes
	End
	Behavior = ActivateModuleSpecialPower ModuleTag_DraftSummonCaster
		SpecialPowerTemplate		= SpecialAbilityMordorFortressMorgulSpireStructure
		TriggerSpecialPower		= ModuleTag_MusteringGrounds_OCL
		TriggerSpecialPower		= ModuleTag_TheodenGloriousChargeUpdate3
	End
	Behavior = OCLSpecialPower ModuleTag_MusteringGrounds_OCL
		SpecialPowerTemplate = SpecialAbilityActivateeDummy5
		OCL                  = OCL_MusteringGrounds
		CreateLocation       = USE_OWNER_OBJECT
		StartsPaused		 = Yes	
	End	
	Behavior = SpecialPowerModule ModuleTag_TheodenGloriousChargeUpdate3
		SpecialPowerTemplate	= SpecialAbilityActivateeDummy2
		AttributeModifier = GandalfRecruitSpeedBuff
		AttributeModifierRange = 99999
		AttributeModifierAffects = NONE +FornostGarrison SAME_PLAYER
;		AttributeModifierFX = FX_HalbaradPerseverance
	End
	
	Behavior = AudioLoopUpgrade ModuleTag_BoilingOilBuildLoop
		; Play a "build loop" while the BoilingOil is building up
		TriggeredBy			= Upgrade_DwarvenFortressSiegeKegs
		;ConflictsWith		= Upgrade_PosternGate Upgrade_WallBanner
		SoundToPlay			= WallConstructionLoop
		KillOnDeath         = Yes
		KillAfterMS			= 4000  ; Should match the length of the build-up animation [Or a little shorter since sounds take a little while to die]
	End
	;-----------------------------------------------	
	// Numeror Stonework improvement, just an upgrade
	Behavior = CastleUpgrade ModuleTag_PassOutNumenorStoneworkUpgrade
		TriggeredBy	= Upgrade_ArnorFortressNumenorStoneworkTrigger
		Upgrade		= Upgrade_ArnorFortressNumenorStonework
		WallUpgradeRadius = MEN_FORTRESS_WALL_EFFECTIVE_RADIUS
	End
	
	Behavior = SubObjectsUpgrade ModuleTag_ShowStars
		TriggeredBy		= Upgrade_ArnorFortressNumenorStonework
		ShowSubObjects	= STARS
	End
	Behavior = AttributeModifierAuraUpdate ModuleTag_BannerLeadership
		StartsActive	= No ;If no, requires upgrade to turn on.
		BonusName		= ArthedainFortressStars
		TriggeredBy		= Upgrade_ArnorFortressNumenorStonework
		RefreshDelay	= 2000
		Range			= 999999
		ObjectFilter	= AOTR_GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
	End
    Behavior = UnpauseSpecialPowerUpgrade ModuleTag_FaramirRangersEnabler1
        SpecialPowerTemplate = ElrondRingOfAir
        TriggeredBy = Upgrade_ArnorFortressNumenorStonework ;Upgrade_AragornOathbreakers
    End
    Behavior = OCLSpecialPower ModuleTag_OCLSpecialPower1
        SpecialPowerTemplate    = ElrondRingOfAir
		StartsPaused                = Yes
        OCL                        = OCL_TowerOfStarsHeal
        CreateLocation       = USE_OWNER_OBJECT
		TriggerFX				= FX_TowerofStars
    End	
;----------------------------------------------------------------------------------

	
	// House of Healing improvement, Purchase discount is in ProductionUpdate
	Behavior = SubObjectsUpgrade ModuleTag_ShowKeepers
		TriggeredBy		= Upgrade_ArnorFortressHouseOfHealing
		ShowSubObjects	= KEEPERS PALANTIRI
	End 
	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_ArnorFortressHouseOfHealing
		AttributeModifier		= NumenorStoneworkKeep_Bonus
	End	
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LordOfWolvesEnabler
		SpecialPowerTemplate	= SpecialAbilityEowynReadiness
		TriggeredBy				= Upgrade_ArnorFortressHouseOfHealing
	End
	Behavior = OCLSpecialPower ModuleTag_LordOfWolves_OCL
		SpecialPowerTemplate = SpecialAbilityEowynReadiness
		InitiateSound = SpellFarsight
		OCL                  = OCL_KeepersSeeingStone
		CreateLocation       = USE_OWNER_OBJECT
		StartsPaused		 = Yes	
		TriggerFX				= FX_ArthedainFortPalantir
	End	
	Behavior = AudioLoopUpgrade ModuleTag_HouseOfHealingBuildLoop
		// Play a "build loop" while the House of Healing is building up
		TriggeredBy			= Upgrade_ArnorFortressHouseOfHealing
		//ConflictsWith		= Upgrade_PosternGate Upgrade_WallBanner
		SoundToPlay			= BuildingConstructionLoop
		KillOnDeath         = Yes
		KillAfterMS			= 5000  ; Should match the length of the build-up animation [Or a little shorter since sounds take a little while to die]
	End

	Behavior = CastleUpgrade ModuleTag_PassOutHouseOfHealingUpgrade
		TriggeredBy	= Upgrade_ArnorFortressHouseOfHealing
		Upgrade		= Upgrade_ArnorFortressHouseOfHealing
	End
	
	#include "..\..\..\FortressRingFunc.inc"
	
	#include "..\..\..\Includes\FortressEconomyBonusGrants.inc" ;;,;; Added
	
	Behavior = AISpecialPowerUpdate MordorMagmacauldronAI ;;,;; added
		CommandButtonName = Command_FireWeaponArnorFortressBoilingOil
		SpecialPowerAIType = AI_SPELLBOOK_ARMY_BREAKER
		SpecialPowerRadius = 200
	End

	Behavior = AISpecialPowerUpdate IvoryTowerAI ;;,;; added
		CommandButtonName = Command_SpecialAbilityIvoryTowerVision
		SpecialPowerAIType = AI_SPELLBOOK_ARMY_BREAKER ; Guess, not sure what to use to make this work best.
		SpecialPowerRadius = 200
	End
	
	Behavior = AIUpdateInterface ModuleTag_AI
		AILuaEventsList				= FortressFunctions
		AutoAcquireEnemiesWhenIdle	= Yes
		MoodAttackCheckRate			= 250
	End

	//Money Maker
	Behavior = AutoDepositUpdate AutoDepositModuleTag
		DepositTiming       	= GENERIC_KEEP_MONEY_TIME
		DepositAmount       	= GENERIC_KEEP_MONEY_AMOUNT 
		InitialCaptureBonus 	= 0  // no initial bonus
	End

	Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
		Radius			= GENERIC_KEEP_MONEY_RANGE	// How far we try to claim ground
		MaxIncome		= 0							// If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval	= 999999					// How often (in msec) we give that much money
		HighPriority	= Yes						// A high priority claim gets to pretend it was there first.
	End
	
	GeometryIsSmall       = No
	
	
	Geometry              = BOX						// Main body
	GeometryMajorRadius   = 49
	GeometryMinorRadius   = 49
	GeometryHeight        = 50
	
	AdditionalGeometry	= BOX						// 4 towers
	GeometryMajorRadius	= 12.0
	GeometryMinorRadius	= 12.0
	GeometryHeight		= 100.0
	GeometryOffset		= X:-40 Y:-40 Z:0
	
	AdditionalGeometry	= BOX
	GeometryMajorRadius	= 12.0
	GeometryMinorRadius	= 12.0
	GeometryHeight		= 100.0
	GeometryOffset		= X:-40 Y:40 Z:0
	
	AdditionalGeometry	= BOX
	GeometryMajorRadius	= 12.0
	GeometryMinorRadius	= 12.0
	GeometryHeight		= 100.0
	GeometryOffset		= X:40 Y:-40 Z:0	
	
	AdditionalGeometry	= BOX
	GeometryMajorRadius	= 12.0
	GeometryMinorRadius	= 12.0
	GeometryHeight		= 100.0
	GeometryOffset		= X:40 Y:40 Z:0
	
	AdditionalGeometry		= BOX
	GeometryName			= HighTowerGeom
	GeometryMajorRadius   	= 12
	GeometryMinorRadius   	= 12
	GeometryHeight        	= 175
	GeometryOffset			= X:0 Y:0 Z:0
	GeometryUsedForHealthBox = No
	
	GeometryContactPoint = X:-57		Y:57		Z:0			Repair
	GeometryContactPoint = X:57			Y:-57		Z:0			Repair
	GeometryContactPoint = X:49			Y:36.435	Z:0
	GeometryContactPoint = X:-32.763	Y:-46.121	Z:0
	GeometryContactPoint = X:0			Y:0			Z:180		Swoop
	
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
End

//------------------------------------------------------------------------------
// This is the one object that you would place on a map and that the porter builds.
// It unpacks in to the citadel and the buildplots.  It's an old CampFlag.
Object ArnorFortress											
	
	SelectPortrait = uparthedainfortress ;BPGFortress
	
	Draw                = W3DScriptedModelDraw ModuleTag_01
		OkToChangeModelColor	= Yes
		StaticModelLODMode		= Yes ;// Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model           = None
		End

		IdleAnimationState
		End

		;//Need this since the default condition is none
		ModelConditionState = WORLD_BUILDER
			Model	= abarnorfort_skn
		End

		;//Phantom structure when placing a new building to be build
		ModelConditionState = BUILD_PLACEMENT_CURSOR
			Model	= None	//GBFortress
		End

		;//Structure that stays where you will be building until the porter reaches the place to start building.
		ModelConditionState =  PHANTOM_STRUCTURE
			Model	= abarnorfort_skn
		End		

		;//	Animation state for build placement cursor
		AnimationState = BUILD_PLACEMENT_CURSOR
			BeginScript
   				CurDrawableHideSubObject("ELENDILI")
   				CurDrawableHideSubObject("KEEPERS")
   				CurDrawableHideSubObject("MUSTER")
   				CurDrawableHideSubObject("STARS")
				CurDrawableHideSubObject("PALANTIRI")
			EndScript
		End
		
		;//	Animation state for phantom structure
		AnimationState = PHANTOM_STRUCTURE
			BeginScript
   				CurDrawableHideSubObject("ELENDILI")
   				CurDrawableHideSubObject("KEEPERS")
   				CurDrawableHideSubObject("MUSTER")
   				CurDrawableHideSubObject("STARS")
				CurDrawableHideSubObject("PALANTIRI")
			EndScript
		End

		ModelConditionState  = RUBBLE
			Model         = abarnorfort_d2
		End
    
		AnimationState	= RUBBLE
			EnteringStateFX	= FX_FortressCollapse		
		End

		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED SNOW ;//UNPACKING
			Model			= abarnorfort_bld	
			Texture = abarnor01.tga abarnor01_snow.tga
		End
		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED ;//UNPACKING
			Model			= abarnorfort_bld			
		End

		AnimationState = ACTIVELY_BEING_CONSTRUCTED
			Animation					= UpAndStill
				AnimationName			= abarnorfort_bld.abarnorfort_bld
				AnimationMode			= MANUAL
			End
			BeginScript
				CurDrawablePlaySound("GondorBarracksBeginConstruction")
			EndScript
			ParticleSysBone = NONE BuildingContructDustCastles FollowBone:YES
			StateName = BeingConstructed
		End
	End

	ArmorSet
		Conditions     = None
  		Armor           = FortressArmor
		DamageFX        = EmptyDamageFX   ; just to avoid an assert
	End

	Side                = Arnor
	EditorSorting       = STRUCTURE

	PlacementViewAngle = -45 ; A -90 makes the door of the base face natural south.  0 would have it to the East.
	
	BuildCost           = 5000 ;MEN_FORTRESS_BUILDCOST
	BuildTime           = MEN_FORTRESS_BUILDTIME

	MaxSimultaneousOfType = 5 ;;,;; Added

	DisplayName         = OBJECT:MenFortress

	// *** AUTO RESOLVE DATA ***
	; When fighting an auto-resolve battle, a World Map castle actually becomes this unit
	AutoResolveUnitType = AutoResolveUnit_Fortress
    
    	AutoResolveBody = AutoResolve_MenFortressBody
    
    	AutoResolveArmor
    		Armor = AutoResolve_MenFortressArmor
    	End

    	AutoResolveWeapon
    		Weapon = AutoResolve_MenFortressWeapon
    	End

	; *** AUDIO Paraeters ***
	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceFullyCreated				= EVA:FortressComplete-Builder
	VoiceSelect         			= MenFortressSelect
	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

	UnitSpecificSounds
		UnderConstruction			= BuildingBigConstructionLoop	;// Built first time
		;//UnderRepairFromDamage	= NoSound						;// Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble		= BuildingBigConstructionLoop	;// Repaired from completely destroyed (not used???)
	End

	ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
		ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
	End

	; *** ENGINEERING Parameters ***  
	RadarPriority       = STRUCTURE
	KindOf              = STRUCTURE SELECTABLE IMMOBILE BASE_FOUNDATION MP_COUNT_FOR_VICTORY BASE_SITE CAN_SEE_THROUGH_STRUCTURE LIVING_WORLD_BUILDING_MIRROR ;;,;; Removed CAN_CAST_REFLECTIONS	
	
	Body                = StructureBody ModuleTag_05
		MaxHealth         = MEN_FORTRESS_HEALTH	
	End
	  
	Behavior = CastleBehavior ModuleTag_castle
		CastleToUnpackForFaction	= Arnor fortress_arnor
		CastleToUnpackForFaction	= Arthedain fortress_arnor
		CastleToUnpackForFaction	= Men fortress_arnor
		CastleToUnpackForFaction	= Elves fortress_arnor
		CastleToUnpackForFaction	= Dwarves fortress_arnor	
		CastleToUnpackForFaction	= Wild fortress_arnor
		CastleToUnpackForFaction	= Isengard fortress_arnor
		CastleToUnpackForFaction	= Mordor fortress_arnor
		CastleToUnpackForFaction	= Angmar fortress_arnor


		FilterValidOwnedEntries = ANY +STRUCTURE +WALK_ON_TOP_OF_WALL +BASE_FOUNDATION +TACTICAL_MARKER		;Anything that does not fit this filter will be given to the neutral player, so the template can have rocks and props.

		MaxCastleRadius				= 130.0
		InstantUnpack				= Yes		
		KeepDeathKillsEverything	= Yes

		EvaEnemyCastleSightedEvent = EnemyFortressSighted
	End 
 
	Behavior                  = StructureCollapseUpdate ModuleTag_08
		MinCollapseDelay        = 000
		MaxCollapseDelay        = 000
		CollapseDamping         = .5
		MaxShudder              = 0.6
		MinBurstDelay           = 250
		MaxBurstDelay           = 800
		BigBurstFrequency       = 4
		FXList                  = INITIAL   FX_FortressCollapse
		;FXList                  = ALMOST_FINAL  FX_FortressCollapse
		DestroyObjectWhenDone	= Yes
		CollapseHeight			= 155
	End
  
	Behavior            = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior
		WorkerName	= GondorWorkerNoSelect
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
	End

	Behavior = AIUpdateInterface ModuleTag_AI
		AILuaEventsList				= FortressFunctions	
	End
	
	//Main
	Geometry              	= BOX
	GeometryMajorRadius   	= 64
	GeometryMinorRadius   	= 64
	GeometryHeight        	= 50

	//Plot locations
	AdditionalGeometry		= BOX
	GeometryName			= Plots
	GeometryMajorRadius		= 10.0
	GeometryMinorRadius		= 10.0
	GeometryHeight			= 0.8
	GeometryOffset			= X:64.0 Y:-64.0 Z:0	

	AdditionalGeometry		= BOX
	GeometryName			= Plots
	GeometryMajorRadius		= 10.0
	GeometryMinorRadius		= 10.0
	GeometryHeight			= 0.8
	GeometryOffset			= X:00 Y:-62.0 Z:0	

	AdditionalGeometry		= BOX
	GeometryName			= Plots
	GeometryMajorRadius		= 10.0
	GeometryMinorRadius		= 10.0
	GeometryHeight			= 0.8
	GeometryOffset			= X:-64.0 Y:-64.0 Z:0	

	AdditionalGeometry		= BOX
	GeometryName			= Plots
	GeometryMajorRadius		= 10.0
	GeometryMinorRadius		= 10.0
	GeometryHeight			= 0.8
	GeometryOffset			= X:-64.0 Y:64.0 Z:0

	AdditionalGeometry		= BOX
	GeometryName			= Plots
	GeometryMajorRadius		= 10.0
	GeometryMinorRadius		= 10.0
	GeometryHeight			= 0.8
	GeometryOffset			= X:0 Y:62.0 Z:0

	AdditionalGeometry		= BOX
	GeometryName			= Plots
	GeometryMajorRadius		= 10.0
	GeometryMinorRadius		= 10.0
	GeometryHeight			= 0.8
	GeometryOffset			= X:64.0 Y:64.0 Z:0

	GeometryIsSmall			= No
	Shadow					= SHADOW_VOLUME

	GeometryContactPoint = X:-90		Y:82		Z:0			Repair
	GeometryContactPoint = X:84		Y:-79		Z:0			Repair
	GeometryContactPoint = X:5.576		Y:44.987	Z:0
	GeometryContactPoint = X:-38.348	Y:-42.113	Z:0
	GeometryContactPoint = X:-28.448	Y:-0.003	Z:75.14		Swoop

End

//------------------------------------------------------------------------------
ChildObject	ArnorFortressDarkEye ArnorFortress

		Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
			PassengerFilter					= GENERIC_FACTION_SLAUGHTERABLE
			ObjectStatusOfContained				= UNSELECTABLE ENCLOSED
			CashBackPercent					= 200%		
			ContainMax						= 99	// give it a huge capacity, just in case player sends his whole army in at once
			AllowEnemiesInside				= No
			AllowAlliesInside				= No
	 		AllowNeutralInside				= No
	 		AllowOwnPlayerInsideOverride	= Yes
			EnterSound						= GUI_RingReturned
			EntryOffset						= X:125.0 Y:0.0 Z:0.0
			EntryPosition					= X:30.0 Y:0.0 Z:0.0
			
			ExitOffset						= X:125.0 Y:0.0 Z:0.0
			StatusForRingEntry				= HOLDING_THE_RING
			;StatusForRingEntry				= USER_DEFINED_2			
;			UpgradeForRingEntry				= Upgrade_RingHero Upgrade_FortressRingHero
			ObjectToDestroyForRingEntry		= NONE +PalantirShard
;			FXForRingEntry					= FX_OneRingFlare
		End

End

Object KeepersSeeingStonePing  
  
  	; Draw module just for the heal FX.
	Draw = W3DScriptedModelDraw TheHealEffect
		ModelConditionState = NONE
			Model					= None
		End
		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
			Model					= None
		End
	End
  
  ; SoundAmbient = RainStereoAmbientLoop  ;,; <------- really important and you will see why


  ; ***DESIGN parameters ***
  EditorSorting     = SYSTEM
  ArmorSet
    Armor = NoArmor
  End
  VisionRange = 0.0


  ; *** ENGINEERING Parameters ***
  KindOf = IMMOBILE UNATTACKABLE INERT
 
  Body = ActiveBody ModuleTag_01
    MaxHealth = 99999.0
  End

	Behavior = AttributeModifierAuraUpdate ModuleTag_DarkPresenceBuff
		StartsActive	= Yes
		BonusName		= ArthedainSeeingStonesLeadership
		RefreshDelay	= 2000
		Range			= 999999
		ObjectFilter	= ANY +HERO ALLIES
	End

    Behavior = LifetimeUpdate ModuleTag_02
        MinLifetime =  60000 ;SPELL_FREEZINGRAIN_DURATION  (180000)
        MaxLifetime =  60000 ;SPELL_FREEZINGRAIN_DURATION  (180000)
    End
    
    Behavior = AIUpdateInterface ModuleTag_03    
        AILuaEventsList                = None
    End

  Geometry = BOX
  GeometryMajorRadius = 50.0
  GeometryMinorRadius = 50.0
  GeometryHeight = 100.0
  GeometryIsSmall = No    
End

Object MusteringGroundsPing  
  
  	; Draw module just for the heal FX.
	Draw = W3DScriptedModelDraw TheHealEffect
		ModelConditionState = NONE
			Model					= None
		End
		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
			Model					= None
		End
	End
  
  ; SoundAmbient = RainStereoAmbientLoop  ;,; <------- really important and you will see why


  ; ***DESIGN parameters ***
  EditorSorting     = SYSTEM
  ArmorSet
    Armor = NoArmor
  End
  VisionRange = 0.0


  ; *** ENGINEERING Parameters ***
  KindOf = IMMOBILE UNATTACKABLE INERT
 
  Body = ActiveBody ModuleTag_01
    MaxHealth = 99999.0
  End
  
  	Behavior = CostModifierUpgrade ModuleTag_CostModifier
		LabelForPalantirString = GUI:CultureDiscount
		StartsActive = Yes ; Run on build complete, not upgrade
		ObjectFilter		= ANY +INFANTRY +CAVALRY -AnnuminasKingsguardHorde -HERO
		Percentage		=  -25%		;; 1 DwarvenHearth
	End

    Behavior = LifetimeUpdate ModuleTag_02
        MinLifetime =  60000 ;SPELL_FREEZINGRAIN_DURATION  (180000)
        MaxLifetime =  60000 ;SPELL_FREEZINGRAIN_DURATION  (180000)
    End
    
    Behavior = AIUpdateInterface ModuleTag_03    
        AILuaEventsList                = None
    End

  Geometry = BOX
  GeometryMajorRadius = 50.0
  GeometryMinorRadius = 50.0
  GeometryHeight = 100.0
  GeometryIsSmall = No    
End

Object TowerOfStarsHealPing

    EvaEnemyObjectSightedEvent = None
  
    ; ***DESIGN parameters ***
    EditorSorting   = SYSTEM
    KindOf = NO_COLLIDE IMMOBILE UNATTACKABLE IGNORE_FOR_VICTORY IGNORE_FOR_EVA_SPEECH_POSITION ;INERT

    ; *** ENGINEERING Parameters ***
    Body = ImmortalBody ModuleTag_01
        MaxHealth = 10000
        InitialHealth = 10000
    End
    
    Behavior = DeletionUpdate ModuleTag_DeletionUpdate ; Not LifetimeUpdate because I can't die
        MinLifetime        = 2100 ;1000
        MaxLifetime        = 2100 ;1000
    End    
    
    Behavior = BannerCarrierUpdate BannerCarrierUpdateModuleTag
        IdleSpawnRate            = 2200                            ; spawn a new member every n seconds when idle (in miliseconds). Greater than lifetime
        UnitSpawnFX              = FX_BannerCarrierSpawnUnit        ; name of particle FX to use when the BannerCarrier spawns a new unit        
        ReplenishNearbyHorde     = Yes
        ReplenishAllNearbyHordes = Yes
        ScanHordeDistance        = 999999
    End
End
